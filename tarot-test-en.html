<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÆ Tarot √ó MBTI Personality Deep Analysis</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
        .header { text-align: center; color: #fff; margin: 24px 0; }
        .header h1 { margin: 0 0 8px; font-size: 32px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .header p { font-size: 16px; opacity: 0.9; }
        
        .card { 
            background: rgba(255,255,255,0.05); 
            border-radius: 20px; 
            padding: 24px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.3); 
            margin-bottom: 20px; 
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); gap: 20px; }
        .btn { 
            display:inline-block; 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color:#fff; 
            border:none; 
            padding:12px 24px; 
            border-radius:25px; 
            cursor:pointer; 
            font-weight:600; 
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: linear-gradient(135deg, #4a5568, #2d3748); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .muted { color:#a0aec0; font-size:14px; }
        label { font-weight:600; display:block; margin:12px 0 8px; color: #e2e8f0; }
        input, select { 
            width:100%; 
            padding:12px; 
            border-radius:12px; 
            border:1px solid rgba(255,255,255,0.2); 
            background: rgba(255,255,255,0.1);
            color: #e8e8e8;
            font-size: 14px;
        }
        input:focus, select:focus { 
            outline: none; 
            border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .pill { 
            display:inline-block; 
            padding:8px 16px; 
            border-radius:20px; 
            background:rgba(102, 126, 234, 0.2); 
            color:#a0aec0; 
            font-weight:600; 
            font-size:12px; 
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        
        .kpi { font-size: 28px; font-weight:800; color:#667eea; }
        .q { 
            border: 1px solid rgba(255,255,255,0.1); 
            border-radius:16px; 
            padding:20px; 
            margin-bottom:20px; 
            background: rgba(255,255,255,0.03);
        }
        .opt { margin:12px 0; }
        .opt input { width:auto; margin-right:12px; }
        .opt label { 
            display: flex; 
            align-items: center; 
            cursor: pointer; 
            padding: 12px; 
            border-radius: 12px; 
            transition: all 0.3s ease;
        }
        .opt label:hover { background: rgba(255,255,255,0.05); }
        .opt input:checked + span { color: #667eea; font-weight: 600; }
        
        .result { 
            margin-top: 16px; 
            padding: 16px 20px; 
            border-left: 4px solid #48bb78; 
            background: rgba(72, 187, 120, 0.1); 
            color: #9ae6b4; 
            border-radius: 12px; 
        }
        
        .section-title { margin: 0 0 16px; color: #e2e8f0; font-size: 20px; }
        .hidden { display: none; }
        
        .tarot-card {
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .tarot-card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.4); }
        .tarot-card.selected { border-color: #667eea; box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
        .tarot-card img { width: 80px; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 12px; }
        .tarot-card h4 { margin: 8px 0; color: #e2e8f0; }
        .tarot-card p { font-size: 12px; color: #a0aec0; margin: 0; }
        
        .mbti-dimension { 
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); 
            border-left: 4px solid #667eea; 
        }
        .tarot-insight { 
            background: linear-gradient(135deg, rgba(72, 187, 120, 0.1), rgba(56, 178, 172, 0.1)); 
            border-left: 4px solid #48bb78; 
        }
        .integration { 
            background: linear-gradient(135deg, rgba(237, 137, 54, 0.1), rgba(245, 101, 101, 0.1)); 
            border-left: 4px solid #ed8936; 
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .tarot-spread {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .spread-position {
            text-align: center;
            padding: 16px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .spread-position h5 { margin: 8px 0; color: #e2e8f0; }
        
        .back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #e2e8f0;
            margin-right: 12px;
        }
        .back-btn:hover { background: rgba(255,255,255,0.15); }
        
        .feature-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }
        .feature-status.active {
            background: rgba(72, 187, 120, 0.2);
            color: #9ae6b4;
            border: 1px solid rgba(72, 187, 120, 0.3);
        }
        .feature-status.coming-soon {
            background: rgba(237, 137, 54, 0.2);
            color: #fbd38d;
            border: 1px solid rgba(237, 137, 54, 0.3);
        }
        
        .date-picker {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2d3748;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            z-index: 1000;
            border: 1px solid rgba(255,255,255,0.1);
            min-width: 300px;
        }
        
        .date-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .date-picker-nav {
            background: none;
            border: none;
            color: #e2e8f0;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }
        
        .date-picker-nav:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .date-picker-title {
            font-size: 18px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .date-picker-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .date-picker-day-header {
            text-align: center;
            padding: 8px;
            font-weight: 600;
            color: #a0aec0;
            font-size: 12px;
        }
        
        .date-picker-day {
            text-align: center;
            padding: 12px 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: #e2e8f0;
        }
        
        .date-picker-day:hover {
            background: rgba(102, 126, 234, 0.3);
        }
        
        .date-picker-day.selected {
            background: #667eea;
            color: white;
        }
        
        .date-picker-day.other-month {
            color: #4a5568;
        }
        
        .date-picker-day.today {
            border: 2px solid #667eea;
        }
        
        .date-picker-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        
        @media (max-width: 768px) {
            .container { padding: 16px; }
            .header h1 { font-size: 24px; }
            .grid { grid-template-columns: 1fr; }
            .tarot-spread { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üîÆ Tarot √ó MBTI Personality Deep Analysis</h1>
            <p class="muted">Combining mystical tarot cards with MBTI theory to explore your inner world and personality code</p>
        </div>
    </div>

    <div class="container">
        <!-- Basic Information Input -->
        <div class="card">
            <div class="grid">
                <div>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                        <h3 class="section-title">üîÆ Basic Information</h3>
                        <button type="button" class="btn btn-secondary" onclick="toggleBasicInfo()" style="font-size:12px;padding:6px 12px">
                            <span id="toggleIcon">üëÅÔ∏è</span> <span id="toggleText">Hide</span>
                        </button>
                    </div>
                    <div id="basicInfoContent">
                        <label for="bDate">Birth Date</label>
                        <input type="text" id="bDate" placeholder="YYYY-MM-DD" readonly>
                        <button type="button" class="btn btn-secondary" onclick="openDatePicker()" style="margin-top:8px;width:100%">Select Date</button>
                        <label for="bTime">Birth Time (24-hour format)</label>
                        <input type="time" id="bTime" value="12:00">
                        <label for="name">Name (Optional)</label>
                        <input type="text" id="name" placeholder="Enter your name">
                        <div style="margin-top:20px">
                            <button class="btn" type="button" onclick="startTarotTest()">Start Tarot Test</button>
                            <button class="btn btn-secondary" type="button" onclick="location.href='index.html'" style="margin-left:12px">Back to Home</button>
                        </div>
                        <p class="muted" style="margin-top:12px">Based on classic tarot works such as "You Are Already Tarot", "Tarot Sunflower Treasure", "78 Degrees of Wisdom", combined with MBTI theory for personality deep analysis.</p>
                    </div>
                </div>
                <div>
                    <h3 class="section-title">üé¥ Test Instructions</h3>
                    <div class="pill">Test Process</div>
                    <div class="muted" style="margin-top:8px">
                        1. Basic information collection<br>
                        2. MBTI personality test<br>
                        3. Tarot card selection<br>
                        4. Fusion analysis results
                    </div>
                    <div style="height:16px"></div>
                    <div class="pill">Tarot Spread</div>
                    <div class="muted" style="margin-top:8px">
                        Using Celtic Cross spread to reveal:<br>
                        ‚Ä¢ Current situation<br>
                        ‚Ä¢ Inner traits<br>
                        ‚Ä¢ Potential challenges<br>
                        ‚Ä¢ Development suggestions
                    </div>
                </div>
            </div>
        </div>

        <!-- MBTI Test Section -->
        <div class="card hidden" id="mbtiSection">
            <h3 class="section-title">üß† MBTI Four Dimensions Test</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="mbtiProgress"></div>
            </div>
            <div id="mbtiQuestions"></div>
            <div style="margin-top:20px">
                <button class="btn back-btn" type="button" onclick="previousSection('basicSection')">Back</button>
                <button class="btn" type="button" onclick="nextSection('tarotSection')" id="mbtiNextBtn" disabled="">Next: Tarot Card Selection</button>
            </div>
        </div>

        <!-- Tarot Card Selection Section -->
        <div class="card hidden" id="tarotSection">
            <h3 class="section-title">üé¥ Tarot Card Selection</h3>
            <p class="muted">Please select tarot cards that resonate with your inner self. We will use the Celtic Cross spread for interpretation.</p>
            
            <div class="tarot-spread">
                <div class="spread-position">
                    <h5>üéØ Center Card - Current Situation</h5>
                    <div id="centerCard" class="tarot-card" onclick="selectCard('center', this)">
                        <div style="width:80px;height:120px;background:linear-gradient(135deg,#2d3748,#4a5568);border-radius:8px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;">
                            <span style="font-size:24px;">üé¥</span>
                        </div>
                        <h4>Select Center Card</h4>
                        <p>Represents your current state</p>
                    </div>
                </div>
                
                <div class="spread-position">
                    <h5>üîÑ Cross Card - Inner Traits</h5>
                    <div id="crossCard" class="tarot-card" onclick="selectCard('cross', this)">
                        <div style="width:80px;height:120px;background:linear-gradient(135deg,#2d3748,#4a5568);border-radius:8px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;">
                            <span style="font-size:24px;">üé¥</span>
                        </div>
                        <h4>Select Cross Card</h4>
                        <p>Represents your inner traits</p>
                    </div>
                </div>
                
                <div class="spread-position">
                    <h5>üåü Base Card - Potential Challenges</h5>
                    <div id="baseCard" class="tarot-card" onclick="selectCard('base', this)">
                        <div style="width:80px;height:120px;background:linear-gradient(135deg,#2d3748,#4a5568);border-radius:8px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;">
                            <span style="font-size:24px;">üé¥</span>
                        </div>
                        <h4>Select Base Card</h4>
                        <p>Represents potential challenges</p>
                    </div>
                </div>
                
                <div class="spread-position">
                    <h5>üîÆ Future Card - Development Advice</h5>
                    <div id="futureCard" class="tarot-card" onclick="selectCard('future', this)">
                        <div style="width:80px;height:120px;background:linear-gradient(135deg,#2d3748,#4a5568);border-radius:8px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;">
                            <span style="font-size:24px;">üé¥</span>
                        </div>
                        <h4>Select Future Card</h4>
                        <p>Represents development advice</p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:20px">
                <button class="btn back-btn" type="button" onclick="previousSection('mbtiSection')">Back</button>
                <button class="btn" type="button" onclick="generateResults()" id="tarotNextBtn" disabled="">Generate Analysis Results</button>
            </div>
        </div>

        <!-- Results Analysis Section -->
        <div class="card hidden" id="resultsSection">
            <h3 class="section-title">üåü Tarot √ó MBTI Fusion Analysis</h3>
            
            <!-- MBTI Type Display -->
            <div class="card mbti-dimension" style="margin-bottom:20px">
                <div class="pill">Your MBTI Type</div>
                <div id="mbtiType" class="kpi" style="font-size:24px; margin-top:8px"></div>
                <div id="mbtiDescription" class="muted" style="margin-top:8px"></div>
            </div>
            
            <!-- Tarot Card Interpretation -->
            <div class="grid">
                <div class="card tarot-insight">
                    <div class="pill">üéØ Center Card Interpretation</div>
                    <div id="centerInterpretation" class="muted" style="margin-top:8px"></div>
                </div>
                <div class="card tarot-insight">
                    <div class="pill">üîÑ Cross Card Interpretation</div>
                    <div id="crossInterpretation" class="muted" style="margin-top:8px"></div>
                </div>
                <div class="card tarot-insight">
                    <div class="pill">üåü Base Card Interpretation</div>
                    <div id="baseInterpretation" class="muted" style="margin-top:8px"></div>
                </div>
                <div class="card tarot-insight">
                    <div class="pill">üîÆ Future Card Interpretation</div>
                    <div id="futureInterpretation" class="muted" style="margin-top:8px"></div>
                </div>
            </div>
            
            <!-- Fusion Analysis -->
            <div class="card integration" style="margin-top:20px">
                <div class="pill">üåü Tarot √ó MBTI Fusion Analysis</div>
                <div id="fusionAnalysis" class="muted" style="margin-top:12px"></div>
            </div>
            
            <!-- Life Advice -->
            <div class="card integration" style="margin-top:20px">
                <div class="pill">üí° Life Development Advice</div>
                <div id="lifeAdvice" class="muted" style="margin-top:12px"></div>
            </div>
            
            <div style="margin-top:20px">
                <button class="btn back-btn" type="button" onclick="previousSection('tarotSection')">Back</button>
                <button class="btn" type="button" onclick="location.href='index.html'">Back to Home</button>
                <button class="btn btn-secondary" type="button" onclick="restartTest()">Restart Test</button>
            </div>
        </div>
    </div>

    <!-- Custom Date Picker Modal -->
    <div id="datePickerModal" class="overlay hidden">
        <div class="date-picker">
            <div class="date-picker-header">
                <button class="date-picker-nav" onclick="previousMonth()">‚Äπ</button>
                <div class="date-picker-title" id="datePickerTitle">January 2024</div>
                <button class="date-picker-nav" onclick="nextMonth()">‚Ä∫</button>
            </div>
            <div class="date-picker-grid" id="datePickerGrid">
                <!-- Days will be populated by JavaScript -->
            </div>
            <div class="date-picker-actions">
                <button class="btn btn-secondary" onclick="closeDatePicker()">Cancel</button>
                <button class="btn" onclick="confirmDateSelection()">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Tarot card data - based on classic tarot theory
        const TAROT_CARDS = {
            // Major Arcana
            'The Fool': { 
                element: 'Air', 
                mbti: ['ENFP', 'INFP'], 
                meaning: 'New beginnings, adventurous spirit, innocence',
                advice: 'Keep an open mind and bravely try new things'
            },
            'The Magician': { 
                element: 'Air', 
                mbti: ['ENTP', 'INTJ'], 
                meaning: 'Creativity, skills, willpower',
                advice: 'Utilize your talents and focus on goal achievement'
            },
            'The High Priestess': { 
                element: 'Water', 
                mbti: ['INFJ', 'INTJ'], 
                meaning: 'Intuition, wisdom, mystery',
                advice: 'Listen to your inner voice and trust your intuition'
            },
            'The Empress': { 
                element: 'Earth', 
                mbti: ['ESFJ', 'ISFJ'], 
                meaning: 'Abundance, motherhood, creativity',
                advice: 'Cultivate creativity and focus on family and relationships'
            },
            'The Emperor': { 
                element: 'Fire', 
                mbti: ['ESTJ', 'ENTJ'], 
                meaning: 'Authority, leadership, stability',
                advice: 'Take responsibility and establish order and structure'
            },
            'The Hierophant': { 
                element: 'Earth', 
                mbti: ['ENFJ', 'INFJ'], 
                meaning: 'Tradition, education, spiritual guidance',
                advice: 'Seek wisdom and pass on knowledge and values'
            },
            'The Lovers': { 
                element: 'Air', 
                mbti: ['ENFP', 'ESFP'], 
                meaning: 'Love, choice, harmony',
                advice: 'Make important choices and balance reason with emotion'
            },
            'The Chariot': { 
                element: 'Fire', 
                mbti: ['ESTP', 'ENTP'], 
                meaning: 'Victory, willpower, control',
                advice: 'Stay focused and overcome obstacles'
            },
            'Strength': { 
                element: 'Fire', 
                mbti: ['ESFP', 'ISFP'], 
                meaning: 'Courage, patience, inner strength',
                advice: 'Cultivate inner strength and maintain patience'
            },
            'The Hermit': { 
                element: 'Earth', 
                mbti: ['INTP', 'ISTP'], 
                meaning: 'Wisdom, solitude, guidance',
                advice: 'Seek inner wisdom and provide guidance to others'
            },
            'Wheel of Fortune': { 
                element: 'Fire', 
                mbti: ['ENFP', 'ENTP'], 
                meaning: 'Change, fate, turning points',
                advice: 'Adapt to changes and seize opportunities'
            },
            'Justice': { 
                element: 'Air', 
                mbti: ['ISTJ', 'ESTJ'], 
                meaning: 'Balance, fairness, truth',
                advice: 'Maintain fairness and seek truth'
            },
            'The Hanged Man': { 
                element: 'Water', 
                mbti: ['INFP', 'INFJ'], 
                meaning: 'Sacrifice, new perspective, pause',
                advice: 'Look at problems from a different angle and accept pauses'
            },
            'Death': { 
                element: 'Water', 
                mbti: ['INTJ', 'ISTJ'], 
                meaning: 'End, transformation, rebirth',
                advice: 'Accept endings and embrace new beginnings'
            },
            'Temperance': { 
                element: 'Fire', 
                mbti: ['ISFJ', 'ESFJ'], 
                meaning: 'Balance, moderation, harmony',
                advice: 'Maintain balance and proceed with moderation'
            },
            'The Devil': { 
                element: 'Earth', 
                mbti: ['ESTP', 'ISTP'], 
                meaning: 'Bondage, desire, materialism',
                advice: 'Identify bondage and transcend material desires'
            },
            'The Tower': { 
                element: 'Fire', 
                mbti: ['ENTJ', 'ESTJ'], 
                meaning: 'Sudden change, revelation, chaos',
                advice: 'Accept changes and learn from chaos'
            },
            'The Star': { 
                element: 'Air', 
                mbti: ['INFP', 'ENFP'], 
                meaning: 'Hope, inspiration, confidence',
                advice: 'Maintain hope and believe in your inspiration'
            },
            'The Moon': { 
                element: 'Water', 
                mbti: ['INFJ', 'ISFJ'], 
                meaning: 'Intuition, fantasy, fear',
                advice: 'Face fears and trust intuition'
            },
            'The Sun': { 
                element: 'Fire', 
                mbti: ['ESFP', 'ENFP'], 
                meaning: 'Joy, success, vitality',
                advice: 'Stay optimistic and share joy'
            },
            'Judgement': { 
                element: 'Fire', 
                mbti: ['ENTJ', 'INTJ'], 
                meaning: 'Rebirth, inner calling, release',
                advice: 'Listen to your inner calling and release the old self'
            },
            'The World': { 
                element: 'Earth', 
                mbti: ['ISFP', 'ISTP'], 
                meaning: 'Completion, harmony, fulfillment',
                advice: 'Celebrate achievements and maintain harmony'
            }
        };

        // MBTI test questions
        const MBTI_QUESTIONS = [
            { id: 1, dimension: 'EI', question: 'In social situations, you tend to:', 
              options: [
                  { text: 'Actively talk to others and meet new friends', score: { E: 1 } },
                  { text: 'Have quiet conversations with familiar people or observe alone', score: { I: 1 } }
              ] },
            { id: 2, dimension: 'EI', question: 'When you need to recharge, you:', 
              options: [
                  { text: 'Go out with friends for activities', score: { E: 1 } },
                  { text: 'Stay alone and enjoy solitude', score: { I: 1 } }
              ] },
            { id: 3, dimension: 'SN', question: 'You focus more on:', 
              options: [
                  { text: 'Concrete facts and details', score: { S: 1 } },
                  { text: 'Possibilities and future visions', score: { N: 1 } }
              ] },
            { id: 4, dimension: 'SN', question: 'When solving problems, you prefer:', 
              options: [
                  { text: 'Using existing methods and experience', score: { S: 1 } },
                  { text: 'Trying new innovative methods', score: { N: 1 } }
              ] },
            { id: 5, dimension: 'TF', question: 'When making decisions, you value more:', 
              options: [
                  { text: 'Logical analysis and objective facts', score: { T: 1 } },
                  { text: 'Personal values and others\' feelings', score: { F: 1 } }
              ] },
            { id: 6, dimension: 'TF', question: 'When handling conflicts, you:', 
              options: [
                  { text: 'Seek fair and reasonable solutions', score: { T: 1 } },
                  { text: 'Consider everyone\'s feelings and seek harmony', score: { F: 1 } }
              ] },
            { id: 7, dimension: 'JP', question: 'You prefer:', 
              options: [
                  { text: 'Making plans and following them', score: { J: 1 } },
                  { text: 'Maintaining flexibility and adapting to situations', score: { P: 1 } }
              ] },
            { id: 8, dimension: 'JP', question: 'Facing deadlines, you usually:', 
              options: [
                  { text: 'Complete early to avoid pressure', score: { J: 1 } },
                  { text: 'Complete efficiently at the last moment', score: { P: 1 } }
              ] }
        ];

        let currentSection = 'basicSection';
        let mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        let selectedCards = {};
        let mbtiType = '';
        
        // Date picker variables
        let currentDate = new Date();
        let selectedDate = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        
        // Toggle basic info visibility
        function toggleBasicInfo() {
            const content = document.getElementById('basicInfoContent');
            const toggleIcon = document.getElementById('toggleIcon');
            const toggleText = document.getElementById('toggleText');
            
            if (content.style.display === 'none') {
                // Show content
                content.style.display = 'block';
                toggleIcon.textContent = 'üëÅÔ∏è';
                toggleText.textContent = 'Hide';
            } else {
                // Hide content
                content.style.display = 'none';
                toggleIcon.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
                toggleText.textContent = 'Show';
            }
        }

        // Date picker functions
        function openDatePicker() {
            document.getElementById('datePickerModal').classList.remove('hidden');
            renderDatePicker();
        }
        
        function closeDatePicker() {
            document.getElementById('datePickerModal').classList.add('hidden');
        }
        
        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderDatePicker();
        }
        
        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderDatePicker();
        }
        
        function renderDatePicker() {
            const title = document.getElementById('datePickerTitle');
            const grid = document.getElementById('datePickerGrid');
            
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            
            title.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            let html = `
                <div class="date-picker-day-header">Sun</div>
                <div class="date-picker-day-header">Mon</div>
                <div class="date-picker-day-header">Tue</div>
                <div class="date-picker-day-header">Wed</div>
                <div class="date-picker-day-header">Thu</div>
                <div class="date-picker-day-header">Fri</div>
                <div class="date-picker-day-header">Sat</div>
            `;
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = date.getMonth() === currentMonth;
                const isToday = date.toDateString() === new Date().toDateString();
                const isSelected = selectedDate && date.toDateString() === selectedDate.toDateString();
                
                let classes = 'date-picker-day';
                if (!isCurrentMonth) classes += ' other-month';
                if (isToday) classes += ' today';
                if (isSelected) classes += ' selected';
                
                html += `<div class="${classes}" onclick="selectDate(${date.getTime()})">${date.getDate()}</div>`;
            }
            
            grid.innerHTML = html;
        }
        
        function selectDate(timestamp) {
            selectedDate = new Date(timestamp);
            renderDatePicker();
        }
        
        function confirmDateSelection() {
            if (selectedDate) {
                const year = selectedDate.getFullYear();
                const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const day = String(selectedDate.getDate()).padStart(2, '0');
                document.getElementById('bDate').value = `${year}-${month}-${day}`;
            }
            closeDatePicker();
        }
        
        function startTarotTest() {
            const date = document.getElementById('bDate').value;
            const time = document.getElementById('bTime').value;
            const name = document.getElementById('name').value;
            
            if (!date || !time) {
                alert('Please fill in your birth date and time');
                return;
            }
            
            // Redirect to MBTI test page with user information
            const url = `mbti-test.html?birthDate=${encodeURIComponent(date)}&birthTime=${encodeURIComponent(time)}&name=${encodeURIComponent(name)}`;
            window.location.href = url;
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('[id$="Section"]').forEach(el => el.classList.add('hidden'));
            // Show target section
            document.getElementById(sectionId).classList.remove('hidden');
            currentSection = sectionId;
        }

        function previousSection(targetSection) {
            showSection(targetSection);
        }

        function nextSection(targetSection) {
            showSection(targetSection);
        }

        function renderMBTIQuestions() {
            const container = document.getElementById('mbtiQuestions');
            container.innerHTML = '';
            
            MBTI_QUESTIONS.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'q';
                questionDiv.innerHTML = `
                    <div style="font-weight:700; margin-bottom:12px">${index + 1}. ${q.question}</div>
                    ${q.options.map((opt, optIndex) => `
                        <div class="opt">
                            <label>
                                <input type="radio" name="q${q.id}" value="${optIndex}" onchange="updateMBTIProgress()">
                                <span>${opt.text}</span>
                            </label>
                        </div>
                    `).join('')}
                `;
                container.appendChild(questionDiv);
            });
            
            updateMBTIProgress();
        }

        function updateMBTIProgress() {
            const totalQuestions = MBTI_QUESTIONS.length;
            const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
            const progress = (answeredQuestions / totalQuestions) * 100;
            
            document.getElementById('mbtiProgress').style.width = progress + '%';
            
            // Check if can proceed to next step
            const nextBtn = document.getElementById('mbtiNextBtn');
            if (answeredQuestions === totalQuestions) {
                nextBtn.disabled = false;
                calculateMBTI();
            } else {
                nextBtn.disabled = true;
            }
        }

        function calculateMBTI() {
            // Reset scores
            mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            
            // Calculate scores
            MBTI_QUESTIONS.forEach(q => {
                const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
                if (selected) {
                    const option = q.options[parseInt(selected.value)];
                    Object.entries(option.score).forEach(([dimension, score]) => {
                        mbtiScores[dimension] += score;
                    });
                }
            });
            
            // Determine type
            mbtiType = '';
            mbtiType += mbtiScores.E >= mbtiScores.I ? 'E' : 'I';
            mbtiType += mbtiScores.S >= mbtiScores.N ? 'S' : 'N';
            mbtiType += mbtiScores.T >= mbtiScores.F ? 'T' : 'F';
            mbtiType += mbtiScores.J >= mbtiScores.P ? 'J' : 'P';
        }

        function selectCard(position, element) {
            // Remove selection from other cards in same position
            document.querySelectorAll(`#${position}Card`).forEach(card => card.classList.remove('selected'));
            
            // Add selection
            element.classList.add('selected');
            
            // Randomly select a tarot card
            const cardNames = Object.keys(TAROT_CARDS);
            const randomCard = cardNames[Math.floor(Math.random() * cardNames.length)];
            selectedCards[position] = randomCard;
            
            // Update display
            element.innerHTML = `
                <div style="width:80px;height:120px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:8px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;">
                    <span style="font-size:24px;">üé¥</span>
                </div>
                <h4>${randomCard}</h4>
                <p>${TAROT_CARDS[randomCard].meaning}</p>
            `;
            
            // Check if all cards are selected
            checkAllCardsSelected();
        }

        function checkAllCardsSelected() {
            const allSelected = ['center', 'cross', 'base', 'future'].every(pos => selectedCards[pos]);
            const nextBtn = document.getElementById('tarotNextBtn');
            nextBtn.disabled = !allSelected;
        }

        function generateResults() {
            showSection('resultsSection');
            
            // Get MBTI type from global variable or calculate it
            const finalMbtiType = window.mbtiType || mbtiType;
            
            // Display MBTI type
            document.getElementById('mbtiType').textContent = finalMbtiType;
            document.getElementById('mbtiDescription').textContent = getMBTIDescription(finalMbtiType);
            
            // Display tarot card interpretation
            document.getElementById('centerInterpretation').innerHTML = getCardInterpretation('center', selectedCards.center);
            document.getElementById('crossInterpretation').innerHTML = getCardInterpretation('cross', selectedCards.cross);
            document.getElementById('baseInterpretation').innerHTML = getCardInterpretation('base', selectedCards.base);
            document.getElementById('futureInterpretation').innerHTML = getCardInterpretation('future', selectedCards.future);
            
            // Generate fusion analysis
            document.getElementById('fusionAnalysis').innerHTML = generateFusionAnalysis();
            
            // Generate life advice
            document.getElementById('lifeAdvice').innerHTML = generateLifeAdvice();
        }

        function getMBTIDescription(type) {
            const descriptions = {
                'INTJ': 'Architect - Imaginative and strategic thinkers',
                'INTP': 'Logician - Innovative inventors',
                'ENTJ': 'Commander - Bold, imaginative leaders',
                'ENTP': 'Debater - Smart and curious thinkers',
                'INFJ': 'Advocate - Quiet and mystical, inspiring',
                'INFP': 'Mediator - Poetic, kind altruists',
                'ENFJ': 'Protagonist - Charismatic and inspiring leaders',
                'ENFP': 'Campaigner - Enthusiastic, creative, sociable',
                'ISTJ': 'Logistician - Practical and fact-loving',
                'ISFJ': 'Defender - Very dedicated and warm guardians',
                'ESTJ': 'Executive - Excellent managers, unstoppable',
                'ESFJ': 'Consul - Very caring and attentive',
                'ISTP': 'Virtuoso - Bold and practical experimenters',
                'ISFP': 'Adventurer - Flexible and charming artists',
                'ESTP': 'Entrepreneur - Smart, energetic, very understanding',
                'ESFP': 'Entertainer - Spontaneous, energetic performers'
            };
            return descriptions[type] || 'Unique personality type';
        }

        function getCardInterpretation(position, cardName) {
            const card = TAROT_CARDS[cardName];
            const positionMeanings = {
                'center': 'Represents your current state and focus',
                'cross': 'Represents your inner traits and core abilities',
                'base': 'Represents potential challenges you need to face',
                'future': 'Represents your development direction and advice'
            };
            
            return `
                <strong>${cardName}</strong><br>
                <em>${positionMeanings[position]}</em><br>
                <strong>Meaning:</strong> ${card.meaning}<br>
                <strong>Advice:</strong> ${card.advice}
            `;
        }

        function generateFusionAnalysis() {
            const centerCard = TAROT_CARDS[selectedCards.center];
            const crossCard = TAROT_CARDS[selectedCards.cross];
            const baseCard = TAROT_CARDS[selectedCards.base];
            const futureCard = TAROT_CARDS[selectedCards.future];
            
            // Analyze element and MBTI correlation
            const elementAnalysis = analyzeElementMBTI();
            
            return `
                <strong>Tarot Element Analysis:</strong><br>
                Center Card (${centerCard.element}) + Cross Card (${crossCard.element}) + Base Card (${baseCard.element}) + Future Card (${futureCard.element})<br><br>
                
                <strong>MBTI Type Characteristics:</strong><br>
                ${mbtiType} Type: ${getMBTIDescription(mbtiType)}<br><br>
                
                <strong>Fusion Interpretation:</strong><br>
                Your ${mbtiType} personality traits combined with the ${elementAnalysis} elemental energy revealed by tarot cards form a unique personality combination.
                Currently you are in a state of ${centerCard.meaning}, possessing inner traits of ${crossCard.meaning},
                need to face challenges of ${baseCard.meaning}, and will develop towards the direction of ${futureCard.meaning} in the future.
            `;
        }

        function analyzeElementMBTI() {
            const elements = ['center', 'cross', 'base', 'future'].map(pos => TAROT_CARDS[selectedCards[pos]].element);
            const elementCounts = elements.reduce((acc, element) => {
                acc[element] = (acc[element] || 0) + 1;
                return acc;
            }, {});
            
            const dominantElement = Object.entries(elementCounts).reduce((a, b) => a[1] > b[1] ? a : b)[0];
            
            const elementMBTI = {
                'Fire': 'Passionate and action-oriented, suitable for extroverted personalities',
                'Earth': 'Steady and practical, suitable for judging personalities',
                'Air': 'Flexible and innovative, suitable for perceiving personalities',
                'Water': 'Emotional and intuitive, suitable for feeling personalities'
            };
            
            return dominantElement + ' (' + elementMBTI[dominantElement] + ')';
        }

        function generateLifeAdvice() {
            const centerCard = TAROT_CARDS[selectedCards.center];
            const crossCard = TAROT_CARDS[selectedCards.cross];
            const baseCard = TAROT_CARDS[selectedCards.base];
            const futureCard = TAROT_CARDS[selectedCards.future];
            
            return `
                <strong>Based on your MBTI type and tarot interpretation, we suggest you:</strong><br><br>
                
                <strong>1. Current Stage (${centerCard.meaning}):</strong><br>
                ${centerCard.advice}<br><br>
                
                <strong>2. Leverage Strengths (${crossCard.meaning}):</strong><br>
                ${crossCard.advice}<br><br>
                
                <strong>3. Face Challenges (${baseCard.meaning}):</strong><br>
                ${baseCard.advice}<br><br>
                
                <strong>4. Development Direction (${futureCard.meaning}):</strong><br>
                ${futureCard.advice}<br><br>
                
                <strong>Overall Advice:</strong><br>
                Combining your ${mbtiType} personality traits, maintain your individuality while learning to balance various energies.
                In the current stage, you should ${centerCard.advice.toLowerCase()}, leverage your ${crossCard.meaning} advantages,
                bravely face challenges of ${baseCard.meaning}, and move towards the goal of ${futureCard.meaning}.
            `;
        }

        function restartTest() {
            // Reset all states
            mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            selectedCards = {};
            mbtiType = '';
            
            // Reset form
            document.getElementById('bDate').value = '';
            document.getElementById('bTime').value = '12:00';
            document.getElementById('name').value = '';
            
            // Reset progress bar
            document.getElementById('mbtiProgress').style.width = '0%';
            
            // Reset button states
            document.getElementById('mbtiNextBtn').disabled = true;
            document.getElementById('tarotNextBtn').disabled = true;
            
            // Reset tarot card selection
            ['center', 'cross', 'base', 'future'].forEach(pos => {
                const card = document.getElementById(pos + 'Card');
                card.classList.remove('selected');
                card.innerHTML = `
                    <div style="width:80px;height:120px;background:linear-gradient(135deg,#2d3748,#4a5568);border-radius:8px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;">
                        <span style="font-size:24px;">üé¥</span>
                    </div>
                    <h4>Select ${pos === 'center' ? 'Center' : pos === 'cross' ? 'Cross' : pos === 'base' ? 'Base' : 'Future'} Card</h4>
                    <p>Represents ${pos === 'center' ? 'your current state' : pos === 'cross' ? 'your inner traits' : pos === 'base' ? 'potential challenges' : 'development advice'}</p>
                `;
            });
            
            // Return to basic information section
            showSection('basicSection');
        }

        // Initialize after page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set default time to current time
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            document.getElementById('bTime').value = timeString;
            
            // Set today's date as placeholder
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('bDate').placeholder = todayString;
            
            // Check if returning from MBTI test
            const urlParams = new URLSearchParams(window.location.search);
            const mbtiType = urlParams.get('mbtiType');
            const birthDate = urlParams.get('birthDate');
            const birthTime = urlParams.get('birthTime');
            const name = urlParams.get('name');
            
            if (mbtiType && birthDate && birthTime) {
                console.log('Returning from MBTI test with type:', mbtiType);
                
                // Pre-fill the form with returned data
                document.getElementById('bDate').value = birthDate;
                document.getElementById('bTime').value = birthTime;
                if (name) {
                    document.getElementById('name').value = name;
                }
                
                // Store MBTI type globally
                window.mbtiType = mbtiType;
                
                // Show tarot section directly
                showSection('tarotSection');
            }
        });
    </script>
</body>
</html>
