<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdSense Fallback æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .console-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .test-section {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #f9fafb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ AdSense Fallback æµ‹è¯•é¡µé¢</h1>
        <p>è¿™ä¸ªé¡µé¢ä½¿ç”¨æµ‹è¯•é…ç½®ï¼Œä¼šè§¦å‘ fallback æ’å±å¹¿å‘Šï¼ˆå› ä¸º Slot ID æ˜¯å ä½ç¬¦ï¼‰</p>
        
        <div id="status" class="status info">å‡†å¤‡æµ‹è¯• fallback åŠŸèƒ½...</div>
        
        <div class="test-section">
            <h2>æµ‹è¯• 1: æ¨¡æ‹Ÿå®Œæˆæµ‹è¯•</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¨¡æ‹Ÿç”¨æˆ·å®Œæˆæµ‹è¯•ï¼Œåº”è¯¥ä¼šæ˜¾ç¤º fallback æ’å±å¹¿å‘Šï¼š</p>
            <button class="btn" onclick="simulateTestComplete()">æ¨¡æ‹Ÿå®Œæˆæµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h2>æµ‹è¯• 2: ç›´æ¥æµ‹è¯•è§†é¢‘å¹¿å‘Š</h2>
            <p>ç›´æ¥æµ‹è¯•è§†é¢‘å¹¿å‘ŠåŠŸèƒ½ï¼š</p>
            <button class="btn" onclick="testVideoAdDirect()">æµ‹è¯•è§†é¢‘å¹¿å‘Š</button>
        </div>
        
        <div class="test-section">
            <h2>æµ‹è¯• 3: æµ‹è¯•åŒæ„æ¡</h2>
            <p>æµ‹è¯•åŒæ„æ¡åŠŸèƒ½ï¼š</p>
            <button class="btn" onclick="testConsent()">æµ‹è¯•åŒæ„æ¡</button>
        </div>
        
        <div>
            <button class="btn" onclick="checkConfig()">æ£€æŸ¥é…ç½®</button>
            <button class="btn" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        </div>
        
        <div id="console-output" class="console-output">
            <div>AdSense Fallback æµ‹è¯•é¡µé¢å·²åŠ è½½</div>
            <div>ä½¿ç”¨æµ‹è¯•é…ç½®ï¼ŒSlot ID ä¸ºå ä½ç¬¦ï¼Œä¼šè§¦å‘ fallback</div>
        </div>
    </div>

    <!-- åŠ è½½æµ‹è¯•é…ç½®å’Œè„šæœ¬ -->
    <script src="ad-config-test.js"></script>
    <script src="ads-manager.js"></script>
    
    <script>
        // é‡å†™ console.log ä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const consoleOutput = document.getElementById('console-output');
        const statusElement = document.getElementById('status');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.innerHTML += `<div>${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        function updateStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function checkConfig() {
            console.log('ğŸ” æ£€æŸ¥æµ‹è¯•é…ç½®...');
            
            // æ£€æŸ¥é…ç½®å¯¹è±¡
            const adConfigExists = typeof window.AD_CONFIG !== 'undefined';
            console.log('AD_CONFIG å­˜åœ¨:', adConfigExists ? 'âœ…' : 'âŒ');
            
            const adManagerExists = typeof window.adManager !== 'undefined';
            console.log('adManager å­˜åœ¨:', adManagerExists ? 'âœ…' : 'âŒ');
            
            if (adConfigExists) {
                console.log('å¹¿å‘Šé…ç½®:', window.AD_CONFIG);
                console.log('å¹¿å‘Šå¯ç”¨çŠ¶æ€:', window.AD_CONFIG.googleAdsense?.enabled);
                console.log('å‘å¸ƒå•†ID:', window.AD_CONFIG.googleAdsense?.publisherId);
                console.log('è§†é¢‘å¹¿å‘ŠSlot ID:', window.AD_CONFIG.googleAdsense?.adSlots?.video?.slotId);
                console.log('è§†é¢‘å¹¿å‘Šæ—¶é•¿:', window.AD_CONFIG.adStrategy?.videoAdDuration);
            }
            
            if (adConfigExists && adManagerExists) {
                updateStatus('æµ‹è¯•é…ç½®æ£€æŸ¥é€šè¿‡ï¼', 'success');
            } else {
                updateStatus('æµ‹è¯•é…ç½®æ£€æŸ¥å¤±è´¥', 'error');
            }
        }

        async function simulateTestComplete() {
            console.log('ğŸ¯ æ¨¡æ‹Ÿå®Œæˆæµ‹è¯•...');
            
            if (!window.adManager) {
                console.log('âŒ adManager ä¸å­˜åœ¨');
                updateStatus('adManager ä¸å­˜åœ¨', 'error');
                return;
            }
            
            try {
                updateStatus('æ­£åœ¨æ˜¾ç¤ºå¹¿å‘Š...', 'info');
                console.log('è°ƒç”¨ createVideoAd()...');
                
                // æ¨¡æ‹Ÿ showResults() å‡½æ•°ä¸­çš„å¹¿å‘Šè°ƒç”¨
                await window.adManager.createVideoAd();
                
                console.log('âœ… å¹¿å‘Šæ’­æ”¾å®Œæˆï¼Œç°åœ¨æ˜¾ç¤ºç»“æœ');
                updateStatus('å¹¿å‘Šæ’­æ”¾å®Œæˆï¼Œæ˜¾ç¤ºç»“æœ', 'success');
                
                // æ¨¡æ‹Ÿæ˜¾ç¤ºç»“æœ
                setTimeout(() => {
                    console.log('ğŸ“Š æ˜¾ç¤º MBTI æµ‹è¯•ç»“æœ...');
                    console.log('ç»“æœ: INFP - è°ƒåœè€…');
                }, 1000);
                
            } catch (error) {
                console.log('âŒ å¹¿å‘Šæµ‹è¯•å¤±è´¥:', error);
                updateStatus('å¹¿å‘Šæµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function testVideoAdDirect() {
            console.log('ğŸ¬ ç›´æ¥æµ‹è¯•è§†é¢‘å¹¿å‘Š...');
            
            if (!window.adManager) {
                console.log('âŒ adManager ä¸å­˜åœ¨');
                updateStatus('adManager ä¸å­˜åœ¨', 'error');
                return;
            }
            
            try {
                updateStatus('æ­£åœ¨åŠ è½½è§†é¢‘å¹¿å‘Š...', 'info');
                await window.adManager.createVideoAd();
                console.log('âœ… è§†é¢‘å¹¿å‘Šæµ‹è¯•å®Œæˆ');
                updateStatus('è§†é¢‘å¹¿å‘Šæµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                console.log('âŒ è§†é¢‘å¹¿å‘Šæµ‹è¯•å¤±è´¥:', error);
                updateStatus('è§†é¢‘å¹¿å‘Šæµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        function testConsent() {
            console.log('ğŸ§ª æµ‹è¯•åŒæ„æ¡...');
            
            // æ¸…é™¤ç°æœ‰åŒæ„çŠ¶æ€
            localStorage.removeItem('adsConsent');
            
            // é‡æ–°åˆå§‹åŒ–åŒæ„æ¡
            if (window.adManager) {
                window.adManager.setupConsent(() => {
                    console.log('åŒæ„æ¡æ˜¾ç¤ºå®Œæˆ');
                });
                updateStatus('åŒæ„æ¡å·²æ˜¾ç¤º', 'info');
            } else {
                console.log('âŒ adManager ä¸å­˜åœ¨');
                updateStatus('adManager ä¸å­˜åœ¨', 'error');
            }
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
            updateStatus('æ§åˆ¶å°å·²æ¸…ç©º', 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… AdSense Fallback æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“‹ ä½¿ç”¨è¯´æ˜:');
            console.log('1. ç‚¹å‡»"æ¨¡æ‹Ÿå®Œæˆæµ‹è¯•"æµ‹è¯•å®Œæ•´æµç¨‹');
            console.log('2. ç‚¹å‡»"æµ‹è¯•è§†é¢‘å¹¿å‘Š"ç›´æ¥æµ‹è¯•å¹¿å‘Š');
            console.log('3. ç‚¹å‡»"æµ‹è¯•åŒæ„æ¡"æµ‹è¯•åŒæ„åŠŸèƒ½');
            console.log('4. ç”±äºä½¿ç”¨å ä½ç¬¦ Slot IDï¼Œä¼šè§¦å‘ fallback æ’å±');
            
            // è‡ªåŠ¨æ£€æŸ¥é…ç½®
            setTimeout(checkConfig, 1000);
        });
    </script>
</body>
</html>
