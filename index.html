<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI人格测试 - 探索你的性格类型</title>
    
    <!-- 广告相关已禁用 -->
    <!--
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4198974976257818" crossorigin="anonymous"></script>
    <script src="ads-config.js"></script>
    -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* 登录页面样式 */
        .login-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            box-sizing: border-box;
            /* 确保内容始终居中 */
            min-height: 100vh;
            min-width: 100vw;
        }

        .register-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            box-sizing: border-box;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            /* 确保在flex容器中完美居中 */
            align-self: center;
            justify-self: center;
            /* 响应式设计 */
            box-sizing: border-box;
        }

        /* 移动设备优化 */
        @media (max-width: 768px) {
            .login-card {
                margin: 20px;
                padding: 30px;
                max-width: calc(100% - 40px);
            }
            
            .login-section {
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 25px;
                margin: 15px;
                max-width: calc(100% - 30px);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .login-header h1 {
            font-size: 2rem;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .login-header p {
            color: #718096;
            font-size: 1rem;
        }

        .login-form {
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: #718096;
            font-size: 0.9rem;
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
        }

        .forgot-password {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .login-btn {
            width: 100%;
            margin-bottom: 20px;
        }

        .divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e2e8f0;
        }

        .divider span {
            background: rgba(255, 255, 255, 0.95);
            padding: 0 15px;
            color: #718096;
            font-size: 0.9rem;
        }

        .google-btn {
            width: 100%;
            background: white;
            color: #333;
            border: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .google-btn:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .google-icon {
            width: 20px;
            height: 20px;
        }

        .register-link {
            text-align: center;
        }

        .register-link p {
            color: #718096;
            margin: 0;
        }

        .register-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .register-link a:hover {
            text-decoration: underline;
        }

        .terms-link {
            color: #667eea;
            text-decoration: none;
        }

        .terms-link:hover {
            text-decoration: underline;
        }

        /* 用户信息样式 */
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .user-info span {
            color: white;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .logout-btn {
            padding: 8px 20px;
            font-size: 0.9rem;
        }

        /* Google登录弹窗样式 */
        .google-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .google-modal-content {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .google-modal-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .google-modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.2rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #e9ecef;
            color: #333;
        }

        .google-modal-body {
            padding: 20px;
        }

        .google-login-options {
            margin-bottom: 20px;
        }

        .google-account-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .google-account-item:hover {
            border-color: #4285f4;
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.1);
        }

        .google-avatar {
            width: 40px;
            height: 40px;
            background: #4285f4;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .google-account-info {
            flex: 1;
        }

        .google-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 2px;
        }

        .google-email {
            font-size: 0.9rem;
            color: #666;
        }

        .google-add-account {
            text-align: center;
        }

        .google-add-account .btn {
            width: 100%;
            background: white;
            color: #333;
            border: 2px solid #e9ecef;
        }

        .google-add-account .btn:hover {
            border-color: #4285f4;
            background: #f8f9fa;
        }

        /* 关闭覆盖层按钮样式 */
        .close-overlay-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-overlay-btn:hover {
            background: #e9ecef;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .welcome-section {
            text-align: center;
        }

        .welcome-section h2 {
            font-size: 2.5rem;
            color: #4a5568;
            margin-bottom: 20px;
        }

        .welcome-section p {
            font-size: 1.1rem;
            color: #718096;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.6);
        }

                .test-section.hidden {
            display: none;
        }
        
        .test-header {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .test-stage-display {
            text-align: center;
        }
        
        .stage-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .question-container {
            text-align: center;
        }

        .question-text {
            font-size: 1.5rem;
            color: #2d3748;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .option-btn {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            color: #4a5568;
            text-align: left;
        }

        .option-btn:hover {
            border-color: #667eea;
            background: #f7fafc;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .option-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }

        /* 选项按钮选择动画 */
        .option-btn.selecting {
            animation: selectPulse 0.5s ease-in-out;
        }

        @keyframes selectPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1.02); }
        }

        /* 选择反馈动画 */
        @keyframes feedbackFade {
            0% { 
                opacity: 0; 
                transform: translateY(10px) scale(0.8); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(0) scale(1.1); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-10px) scale(1); 
            }
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }
        .result-section {
            text-align: center;
        }
        .result-section.hidden {
            display: none;
        }

        .result-section h2 {
            font-size: 2.5rem;
            color: #4a5568;
            margin-bottom: 20px;
        }

        .personality-type {
            font-size: 4rem;
            font-weight: 700;
            color: #667eea;
            margin: 30px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dimensions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .dimension {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .dimension h4 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .dimension-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .dimension-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            transition: width 1s ease;
        }

        .description {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: left;
            line-height: 1.6;
        }

        .description h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .description p {
            color: #718096;
            margin-bottom: 15px;
        }

        .hidden {
            display: none;
        }

        /* MBTI介绍页面样式 */
        .mbti-content {
            text-align: left;
        }

        .mbti-content h3 {
            color: #4a5568;
            font-size: 1.8rem;
            margin: 40px 0 20px;
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .dimension-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .dimension-card h4 {
            color: #2d3748;
            font-size: 1.4rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .dimension-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .dimension-side {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }

        .dimension-side h5 {
            color: #4a5568;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .dimension-side ul {
            list-style: none;
            padding: 0;
        }

        .dimension-side li {
            color: #718096;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .dimension-side li:before {
            content: "•";
            color: #667eea;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .type-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .type-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .type-card h4 {
            color: #2d3748;
            font-size: 1.2rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .type-card p {
            color: #718096;
            font-size: 0.95rem;
            line-height: 1.5;
            text-align: center;
        }

        .tips-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .tip-item {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #f093fb;
        }

        .tip-item h4 {
            color: #2d3748;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .tip-item p {
            color: #718096;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 25px;
            }
            
            .question-text {
                font-size: 1.3rem;
            }
            
            .personality-type {
                font-size: 3rem;
            }
            .dimension-details {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .types-grid {
                grid-template-columns: 1fr;
            }
            
            .tips-content {
                grid-template-columns: 1fr;
            }
        }

        /* Google注册弹窗样式 */
        .google-register-options {
            margin-bottom: 20px;
        }

        .google-register-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 15px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .google-register-item:hover {
            border-color: #4285f4;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.1);
        }

        .google-register-icon {
            font-size: 2rem;
            margin-right: 15px;
            width: 50px;
            text-align: center;
        }

        .google-register-info {
            flex: 1;
            margin-right: 15px;
        }

        .google-register-info h4 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 1.1rem;
        }

        .google-register-info p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .google-register-item .btn {
            padding: 8px 16px;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .google-help {
            text-align: center;
            padding: 15px;
            background: #e8f4fd;
            border-radius: 8px;
            border-left: 4px solid #4285f4;
        }

        .google-help p {
            margin: 0;
            color: #1976d2;
            font-size: 0.9rem;
        }

        /* 主要按钮样式 */
        .btn-primary {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.6);
        }

        /* 广告页面样式 */
        .ad-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            box-sizing: border-box;
            min-height: 100vh;
            min-width: 100vw;
        }

        .ad-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            max-width: 600px;
            width: 100%;
            min-height: 70vh;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            margin: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

                .ad-header h2 {
            color: #2d3748;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .ad-header p {
            color: #718096;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }
        
        .ad-header {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

                .ad-content {
            margin-bottom: 30px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            justify-content: center;
        }
        
        .ad-video-placeholder {
            margin-bottom: 30px;
            width: 100%;
            max-width: 400px;
        }
        
        .ad-video-frame {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            width: 100%;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Google AdSense 广告样式 */
        .google-adsense-ad {
            width: 100%;
            height: 100%;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
        }

        /* AdSense广告单元样式 */
        .adsense-ad-unit {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .adsense-ad-unit ins.adsbygoogle {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ad-loading {
            text-align: center;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fallback-ad {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            animation: adSlideIn 0.5s ease;
        }

        @keyframes adSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fallback-ad .ad-video-player {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
            position: relative;
        }

        .ad-header {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ad-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .ad-sponsor {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .ad-content-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .ad-icon {
            font-size: 4rem;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .ad-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .ad-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .ad-features {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }

        .feature {
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .ad-footer {
            position: absolute;
            bottom: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ad-duration {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .ad-action {
            background: rgba(255, 255, 255, 0.25);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ad-action:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }

        /* 广告配置面板样式 */
        .ad-config-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 0;
            max-width: 400px;
            width: 90%;
            z-index: 1000;
            animation: configSlideIn 0.3s ease;
        }

        @keyframes configSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .ad-config-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ad-config-header h4 {
            margin: 0;
            font-size: 1.2rem;
        }

        .close-config-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .close-config-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .ad-config-content {
            padding: 20px;
        }

        .config-item {
            margin-bottom: 15px;
        }

        .config-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .config-item select,
        .config-item input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .config-item select:focus,
        .config-item input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .config-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .config-info p {
            margin: 0 0 10px 0;
            font-weight: 500;
            color: #333;
        }

        .config-info ul {
            margin: 0;
            padding-left: 20px;
            color: #666;
        }

        .config-info li {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .ad-info {
            text-align: center;
            width: 100%;
            max-width: 500px;
        }

        .ad-progress {
            margin-bottom: 25px;
            width: 100%;
            text-align: center;
        }

        .ad-progress .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .ad-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            color: #4a5568;
            font-weight: 500;
        }

                .ad-benefits {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            width: 100%;
            text-align: center;
        }
        
        .ad-benefits h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .ad-benefits ul {
            list-style: none;
            padding: 0;
            display: inline-block;
            text-align: left;
        }
        
        .ad-benefits li {
            color: #4a5568;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        
        .ad-benefits li:before {
            content: "✓";
            color: #10b981;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

                .ad-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            width: 100%;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .ad-actions .btn {
            min-width: 120px;
            margin: 0 5px;
        }

        /* 测试进度条样式 */
        .test-progress-info {
            margin-top: 15px;
            text-align: center;
        }
        
        .progress-badge {
            display: block;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .test-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 auto;
            max-width: 300px;
        }
        
        .test-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .test-stage-indicator {
            margin-top: 12px;
        }
        
        .stage-text {
            display: inline-block;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* 问题解释样式 */
        .question-explanation {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            border-left: 4px solid #2196f3;
            animation: explanationSlideIn 0.5s ease;
        }

        /* 问题图文样式 */
        .question-emoji {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 20px;
            animation: emojiFloat 3s ease-in-out infinite;
        }

        @keyframes emojiFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .question-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 12px;
            margin: 0 auto 20px;
            display: block;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .question-image:hover {
            transform: scale(1.05);
        }

        .question-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 20px;
            color: #667eea;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.5;
            text-align: center;
        }

        .cross-test-hint {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #fff;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(255, 154, 158, 0.3);
            animation: crossTestPulse 2s ease-in-out infinite;
        }

        .cross-test-detail {
            font-size: 0.85rem;
            margin-top: 8px;
            opacity: 0.9;
            line-height: 1.3;
            font-weight: 400;
        }

        @keyframes crossTestPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .question-scenario {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.4;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .scenario-icon {
            font-size: 1.1rem;
            margin-right: 8px;
        }

        @keyframes explanationSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .explanation-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-icon {
            font-size: 1.2rem;
            color: #2196f3;
        }

        .explanation-text {
            color: #1565c0;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        /* 维度进度样式 */
        .dimension-progress {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .progress-label {
            color: #4a5568;
            font-weight: 500;
        }

        .progress-value {
            color: #667eea;
            font-weight: 600;
        }

        /* 交叉测试关系图样式 */
        .cross-test-relationship {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .relationship-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            text-align: center;
            margin-bottom: 15px;
        }

        .relationship-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .relationship-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .relationship-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.02);
        }

        .dimension-pair {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status {
            font-size: 1.1rem;
        }

        /* 忘记密码页面样式 */
        .forgot-password-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }

        .verification-code-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .verification-code-group input {
            flex: 1;
        }

        .send-code-btn {
            white-space: nowrap;
            padding: 12px 16px;
            font-size: 0.9rem;
        }

        .send-code-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .password-strength {
            margin-top: 8px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }

        .password-strength::before {
            content: '';
            display: block;
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .password-strength.weak::before {
            width: 25%;
            background: #e53e3e;
        }

        .password-strength.fair::before {
            width: 50%;
            background: #d69e2e;
        }

        .password-strength.good::before {
            width: 75%;
            background: #38a169;
        }

        .password-strength.strong::before {
            width: 100%;
            background: #2f855a;
        }

        .forgot-password-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .forgot-password-options .btn {
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        /* 倒计时样式 */
        .countdown {
            color: #718096;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* 成功提示样式 */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin-bottom: 20px;
            text-align: center;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin-bottom: 20px;
            text-align: center;
        }

        /* 互动式页脚样式 */
        .footer {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: white;
            margin-top: 60px;
            padding: 0;
            border-radius: 25px 25px 0 0;
            box-shadow: 0 -15px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .footer-content.interactive {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
        }

        /* 页脚头部 */
        .footer-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }

        .company-intro h3 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .company-intro p {
            font-size: 1.1rem;
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .interactive-stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .stat-counter {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .stat-counter:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .stat-counter .counter {
            display: block;
            font-size: 2.5rem;
            font-weight: 800;
            color: #fbbf24;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .stat-counter .unit {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fbbf24;
        }

        .stat-counter .label {
            display: block;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 8px;
            font-weight: 500;
        }

        /* 页脚主体 */
        .footer-body {
            padding: 40px 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            background: rgba(255, 255, 255, 0.02);
        }

        .footer-section.interactive h4 {
            color: #f7fafc;
            font-size: 1.2rem;
            margin-bottom: 25px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            position: relative;
        }

        .footer-section.interactive h4::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: #fbbf24;
            transition: width 0.3s ease;
        }

        .footer-section.interactive:hover h4::after {
            width: 100%;
        }

        /* 联系方式 */
        .contact-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .contact-method {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .contact-method:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(10px);
            border-color: #667eea;
        }

        .contact-method .icon {
            font-size: 1.5rem;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .contact-method .text {
            color: #e2e8f0;
            font-weight: 500;
        }

        .contact-method .tooltip {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .contact-method:hover .tooltip {
            opacity: 1;
        }

        /* 快速反馈 */
        .feedback-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .feedback-btn {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .feedback-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .feedback-btn[data-type="praise"]:hover {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .feedback-btn[data-type="suggestion"]:hover {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .feedback-btn[data-type="bug"]:hover {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .feedback-btn .icon {
            font-size: 1.3rem;
            margin-right: 12px;
        }

        /* 快速链接 */
        .quick-links {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quick-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #e2e8f0;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quick-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(10px);
            border-color: #667eea;
            color: white;
        }

        .quick-link .icon {
            font-size: 1.3rem;
            margin-right: 12px;
            width: 25px;
            text-align: center;
        }

        /* 页脚底部 */
        .footer-bottom {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-info p {
            color: #a0aec0;
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .footer-controls {
            display: flex;
            gap: 15px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e2e8f0;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .footer-header {
                flex-direction: column;
                text-align: center;
                padding: 30px 20px;
            }
            
            .interactive-stats {
                justify-content: center;
            }
            
            .footer-body {
                grid-template-columns: 1fr;
                padding: 30px 20px;
                gap: 30px;
            }
            
            .footer-bottom {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .stat-counter {
                min-width: 100px;
                padding: 15px;
            }
            
            .stat-counter .counter {
                font-size: 2rem;
            }
        }

        /* 二维码弹窗样式 */
        .qr-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }

        .qr-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .qr-modal-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .qr-modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.2rem;
        }

        .qr-modal-body {
            padding: 30px;
            text-align: center;
        }

        .qr-placeholder {
            margin-bottom: 25px;
        }

        .qr-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .qr-placeholder p {
            color: #4a5568;
            margin: 8px 0;
        }

        .qr-info {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .qr-info p {
            color: #4a5568;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        /* Toast提示样式 */
        .toast {
            animation: toastSlideIn 0.3s ease;
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* 阅读提醒弹窗样式 */
        .reminder-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1001;
        }

        .reminder-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: reminderSlideIn 0.3s ease;
        }

        @keyframes reminderSlideIn {
            from {
                transform: scale(0.8) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .reminder-modal-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            padding: 20px;
            text-align: center;
        }

        .reminder-modal-header h3 {
            margin: 0;
            color: white;
            font-size: 1.3rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .reminder-modal-body {
            padding: 30px;
            text-align: center;
        }

        .reminder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: reminderPulse 2s infinite;
        }

        @keyframes reminderPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .reminder-modal-body h4 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .reminder-modal-body p {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .reminder-modal-body ul {
            text-align: left;
            display: inline-block;
            margin: 20px 0;
        }

        .reminder-modal-body li {
            color: #4a5568;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .reminder-modal-body li:before {
            content: "⚠️";
            position: absolute;
            left: 0;
            color: #f59e0b;
        }

        .reminder-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .reminder-actions .btn {
            min-width: 120px;
            padding: 12px 24px;
        }

        /* 弹窗样式 */
        .policy-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }

        .policy-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .policy-modal-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .policy-modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.3rem;
        }

        .policy-modal-body {
            padding: 30px;
        }

        /* 反馈弹窗样式 */
        .feedback-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .feedback-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .feedback-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .feedback-modal-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .feedback-modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.3rem;
        }

        .feedback-modal-body {
            padding: 30px;
        }

        .feedback-form-modal .form-group {
            margin-bottom: 20px;
        }

        .feedback-form-modal label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }

        .feedback-form-modal input,
        .feedback-form-modal select,
        .feedback-form-modal textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
        }

        .feedback-form-modal input:focus,
        .feedback-form-modal select:focus,
        .feedback-form-modal textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .feedback-form-modal textarea {
            resize: vertical;
            min-height: 100px;
        }

        .feedback-form-modal .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-form-modal .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .feedback-form-modal .btn:active {
            transform: translateY(0);
        }

        /* 头部布局样式 */
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
        }

        .header-content {
            flex: 1;
        }

        .user-info {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-shrink: 0;
        }

        .user-info .btn {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 6px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* 功能栏目样式 */
        .features-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            margin: 30px 0;
            border-radius: 16px;
            color: white;
            text-align: center;
        }

        .features-section h2 {
            margin-bottom: 15px;
            font-size: 2rem;
            font-weight: 600;
        }

        .features-section p {
            margin-bottom: 30px;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .feature-card h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .feature-card p {
            margin-bottom: 15px;
            font-size: 0.95rem;
            opacity: 0.9;
            line-height: 1.5;
        }

        .feature-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .feature-status.active {
            background: #28a745;
            color: white;
        }

        .feature-status.coming-soon {
            background: #ffc107;
            color: #212529;
        }

        /* 功能弹窗样式 */
        .feature-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }

        .feature-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .feature-modal-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .feature-modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.3rem;
        }

        .feature-modal-body {
            padding: 30px;
            text-align: center;
        }

        .feature-modal-body p {
            margin-bottom: 20px;
            color: #4a5568;
            line-height: 1.6;
        }

        /* 星座+MBTI融合测试弹窗样式 */
        .zodiac-mbti-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1000;
        }

        .zodiac-mbti-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .zodiac-mbti-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .zodiac-mbti-modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* 星座+MBTI弹窗的关闭按钮特殊样式 */
        .zodiac-mbti-modal-header .close-btn {
            color: white !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border: 2px solid rgba(255, 255, 255, 0.4) !important;
            font-size: 2rem !important;
            font-weight: bold !important;
            width: 40px !important;
            height: 40px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }

        .zodiac-mbti-modal-header .close-btn:hover {
            background: rgba(255, 255, 255, 0.3) !important;
            border-color: rgba(255, 255, 255, 0.6) !important;
            transform: scale(1.1) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
        }

        .zodiac-mbti-modal-header .close-btn:active {
            transform: scale(0.95) !important;
        }

        .zodiac-mbti-modal-body {
            padding: 30px;
        }

        .zodiac-mbti-modal .test-section {
            margin-bottom: 30px;
        }

        .zodiac-mbti-modal .test-section h4 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .zodiac-mbti-modal .form-group {
            margin-bottom: 20px;
        }

        .zodiac-mbti-modal .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }

        .zodiac-mbti-modal .form-group input,
        .zodiac-mbti-modal .form-group select,
        .zodiac-mbti-modal .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }

        .zodiac-mbti-modal .form-group input:focus,
        .zodiac-mbti-modal .form-group select:focus,
        .zodiac-mbti-modal .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .zodiac-mbti-modal .question-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .zodiac-mbti-modal .question-card h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
        }

        .zodiac-mbti-modal .question-card p {
            margin-bottom: 15px;
            color: #555;
            line-height: 1.6;
        }

        .zodiac-mbti-modal .options-list {
            list-style: none;
            padding: 0;
        }

        .zodiac-mbti-modal .option-item {
            margin-bottom: 12px;
        }

        .zodiac-mbti-modal .option-radio {
            margin-right: 10px;
        }

        .zodiac-mbti-modal .option-label {
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            display: block;
        }

        .zodiac-mbti-modal .option-label:hover {
            background-color: #e3f2fd;
        }

        .zodiac-mbti-modal .progress-bar {
            width: 100%;
            height: 8px;
            background: #e1e5e9;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .zodiac-mbti-modal .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .zodiac-mbti-modal .fusion-type {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .zodiac-mbti-modal .fusion-type h2 {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .zodiac-mbti-modal .fusion-type p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .zodiac-mbti-modal .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .zodiac-mbti-modal .report-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid #667eea;
        }

        .zodiac-mbti-modal .report-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .zodiac-mbti-modal .report-card ul {
            list-style: none;
            padding-left: 0;
        }

        .zodiac-mbti-modal .report-card li {
            padding: 8px 0;
            border-bottom: 1px solid #e1e5e9;
        }

        .zodiac-mbti-modal .report-card li:last-child {
            border-bottom: none;
        }

        .zodiac-mbti-modal .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .zodiac-mbti-modal .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .zodiac-mbti-modal-content {
                max-width: 95%;
                margin: 10px;
            }
            
            .zodiac-mbti-modal .report-grid {
                grid-template-columns: 1fr;
            }
        }

        .feature-status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .feature-status-badge.active {
            background: #28a745;
            color: white;
        }

        .feature-status-badge.coming-soon {
            background: #ffc107;
            color: #212529;
        }

        .feature-actions {
            margin-top: 20px;
        }

        .feature-actions .btn {
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .user-info {
                margin-top: 15px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
                padding: 0 10px;
            }
            
            .feature-card {
                padding: 20px;
            }
        }

        /* 政策弹窗按钮样式 */
        .policy-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .policy-actions-top {
            margin-top: 0;
            margin-bottom: 25px;
            padding-top: 0;
            padding-bottom: 20px;
            border-top: none;
            border-bottom: 1px solid #e9ecef;
        }

        .policy-actions .btn {
            min-width: 120px;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .policy-actions .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
        }

        .policy-actions .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .policy-actions .btn-primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .policy-actions .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .policy-actions .btn-primary:hover::before {
            left: 100%;
        }

        .policy-actions .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .policy-actions .btn-primary:active {
            transform: translateY(-1px);
        }

        .feedback-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .feedback-actions .btn {
            min-width: 120px;
            padding: 12px 24px;
        }

        /* 点赞弹窗样式 */
        .praise-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1001;
        }

        .praise-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: praiseSlideIn 0.3s ease;
        }

        @keyframes praiseSlideIn {
            from {
                transform: scale(0.8) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .praise-modal-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 20px;
            text-align: center;
        }

        .praise-modal-header h3 {
            margin: 0;
            color: white;
            font-size: 1.3rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .praise-modal-body {
            padding: 30px;
        }

        .praise-intro {
            text-align: center;
            margin-bottom: 30px;
        }

        .praise-intro p {
            color: #4a5568;
            font-size: 1.1rem;
            margin: 0;
        }

        .praise-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .praise-option {
            display: flex;
            align-items: center;
            padding: 20px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .praise-option:hover {
            background: #edf2f7;
            border-color: #10b981;
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2);
        }

        .praise-option:active {
            transform: scale(0.98);
        }

        .praise-icon {
            font-size: 1.5rem;
            margin-right: 20px;
            min-width: 80px;
            text-align: center;
        }

        .praise-text {
            flex: 1;
        }

        .praise-text h4 {
            color: #2d3748;
            margin: 0 0 8px 0;
            font-size: 1.2rem;
        }

        .praise-text p {
            color: #718096;
            margin: 0;
            line-height: 1.5;
        }

        .praise-arrow {
            font-size: 1.5rem;
            color: #10b981;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .praise-option:hover .praise-arrow {
            opacity: 1;
        }

        .praise-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .praise-actions .btn {
            min-width: 120px;
            padding: 12px 24px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .praise-modal-content {
                margin: 20px;
                max-width: calc(100% - 40px);
            }
            
            .praise-option {
                padding: 15px;
            }
            
            .praise-icon {
                font-size: 1.2rem;
                margin-right: 15px;
                min-width: 60px;
            }
            
            .praise-text h4 {
                font-size: 1.1rem;
            }
            
            .praise-text p {
                font-size: 0.9rem;
            }
        }

        /* 手机号注册弹窗样式 */
        .phone-register-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1001;
        }

        .phone-register-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: phoneSlideIn 0.3s ease;
        }

        @keyframes phoneSlideIn {
            from {
                transform: scale(0.8) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .phone-register-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            text-align: center;
        }

        .phone-register-header h3 {
            margin: 0;
            color: white;
            font-size: 1.3rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .phone-register-body {
            padding: 30px;
        }

        .verification-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .verification-info p {
            margin: 5px 0;
            color: #0369a1;
        }

        .countdown-text {
            font-weight: 600;
            color: #dc2626;
        }

        .verification-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .verification-input-group input {
            flex: 1;
        }

        .verification-input-group .btn {
            white-space: nowrap;
            padding: 12px 16px;
            font-size: 0.9rem;
        }

        .verification-input-group .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .phone-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .phone-actions .btn {
            min-width: 120px;
            padding: 12px 24px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .phone-register-content {
                margin: 20px;
                max-width: calc(100% - 40px);
            }
            
            .verification-input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .phone-actions {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .policy-modal-body h4 {
            color: #2d3748;
            margin: 25px 0 15px;
            font-size: 1.1rem;
        }

        .policy-modal-body h4:first-child {
            margin-top: 0;
        }

        .policy-modal-body p {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .policy-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .policy-actions .btn {
            min-width: 120px;
            padding: 12px 24px;
        }

        .policy-actions .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
            border: 1px solid #cbd5e0;
        }

        .policy-actions .btn-secondary:hover {
            background: #cbd5e0;
            border-color: #a0aec0;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .footer-bottom-content {
                flex-direction: column;
                text-align: center;
            }
            
            .footer-stats {
                justify-content: center;
            }
            
            .social-links {
                justify-content: center;
            }
            
            .feedback-modal-content,
            .policy-modal-content {
                margin: 20px;
                max-width: calc(100% - 40px);
            }
        }
    </style>
    <style>
        /* 强制隐藏所有广告/投放相关区域 */
        .ad-section,
        .ad-config-panel,
        .google-adsense-ad,
        ins.adsbygoogle { display: none !important; visibility: hidden !important; }
    </style>
</head>
<body>
    <div class="container">
        <!-- 主标题 -->
        <div class="header" id="mainHeader">
            <div class="header-top">
                <div class="header-content">
            <h1>🧠 MBTI人格测试</h1>
            <p>探索你的性格类型，了解真实的自己</p>
                </div>
            <div class="user-info" id="userInfoSection">
                <button class="btn btn-secondary" onclick="showLogin()">登录</button>
                <button class="btn" onclick="showRegister()">注册</button>
            </div>
            <div class="user-info hidden" id="loggedInSection">
                <span id="userDisplayName">欢迎回来！</span>
                <button class="btn btn-secondary logout-btn" onclick="logout()">退出登录</button>
                </div>
            </div>
        </div>

        <!-- 功能栏目区域 -->
        <div class="features-section" id="featuresSection">
            <h2>🌟 探索更多神秘学测试</h2>
            <p>除了MBTI人格测试，我们还有更多有趣的测试等你来体验</p>
            
            <div class="features-grid">
                <div class="feature-card" onclick="showMBTIWelcome()">
                    <div class="feature-icon">🧠</div>
                    <h3>专业MBTI测试</h3>
                    <p>基于荣格理论的16种人格类型专业测试，快速准确</p>
                    <div class="feature-status active">开始测试</div>
                </div>
                
                <div class="feature-card" id="zodiacMbtiExperienceCard" onclick="location.href='zodiac-mbti-fusion.html'">
                    <div class="feature-icon">♈</div>
                    <h3>趣味星座测试</h3>
                    <p>轻松有趣的星座性格测试，探索你的星座特质</p>
                    <div class="feature-status active">开始测试</div>
                </div>
                

                
                <div class="feature-card" onclick="location.href='bazi-test.html'">
                    <div class="feature-icon">📅</div>
                    <h3>八字算命</h3>
                    <p>传统命理学，解读你的命运密码</p>
                    <div class="feature-status active">开始测试</div>
                </div>
                
                <div class="feature-card" onclick="location.href='tarot-test.html'">
                    <div class="feature-icon">🔮</div>
                    <h3>塔罗牌测试</h3>
                    <p>神秘的塔罗牌，揭示你的内心世界</p>
                    <div class="feature-status active">开始测试</div>
                </div>
                
                <div class="feature-card" onclick="showFeatureInfo('numerology')">
                    <div class="feature-icon">🔢</div>
                    <h3>数字命理</h3>
                    <p>通过数字解读你的性格和命运</p>
                    <div class="feature-status active">开始测试</div>
                </div>
                
                <div class="feature-card" onclick="showFeatureInfo('chinese-zodiac')">
                    <div class="feature-icon">🐉</div>
                    <h3>生肖测试</h3>
                    <p>十二生肖性格特征深度解析</p>
                    <div class="feature-status active">开始测试</div>
                </div>
            </div>
        </div>

        <!-- 星座+MBTI融合测试弹窗 -->
        <div class="zodiac-mbti-modal hidden" id="zodiacMBTIModal">
            <div class="zodiac-mbti-modal-content">
                <div class="zodiac-mbti-modal-header">
                    <h3>🌟 趣味星座测试</h3>
                    <button class="close-btn" onclick="closeZodiacMBTIModal()">&times;</button>
                    <!-- 调试按钮 -->
                    <button class="btn" onclick="closeZodiacMBTIModal()" style="background: #ff6b6b; margin-left: 10px; padding: 8px 16px; font-size: 0.9rem;">关闭弹窗</button>
                    <button class="btn" onclick="debugHomePageElements()" style="background: #4ecdc4; margin-left: 10px; padding: 8px 16px; font-size: 0.9rem;">调试首页</button>
                </div>
                <div class="zodiac-mbti-modal-body">
                    <!-- 基础信息收集 -->
                    <div class="test-section" id="basicInfoSection">
                        <h4>📅 基础信息收集</h4>
                        <div class="form-group">
                            <label for="birthDate">出生日期</label>
                            <input type="date" id="birthDate" required>
                        </div>
                        <div class="form-group">
                            <label for="birthTime">出生时间（精确到分钟）</label>
                            <input type="time" id="birthTime" required>
                        </div>
                        <div class="form-group">
                            <label for="birthPlace">出生地点</label>
                            <input type="text" id="birthPlace" placeholder="例如：北京、上海、广州" required>
                        </div>
                        <button class="btn" onclick="startZodiacTest()" id="startTestBtn">开始测试</button>
                        <p style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 10px;">
                            💡 点击此按钮将保存您的出生信息并开始测试
                        </p>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn" onclick="testDataSave()" style="background: #4ecdc4; padding: 8px 16px; font-size: 0.9rem;">测试数据保存</button>
                        </div>
                    </div>

                    <!-- MBTI测试部分 -->
                    <div class="test-section hidden" id="mbtiSection">
                        <h4>🧠 MBTI性格测试</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="mbtiProgress"></div>
                        </div>
                        <div id="mbtiQuestions"></div>
                        <button class="btn btn-secondary" onclick="previousZodiacSection('basicInfoSection')">返回</button>
                        <button class="btn" onclick="nextZodiacSection('zodiacSection')" id="mbtiNextBtn" disabled>下一步</button>
                    </div>

                    <!-- 星座特质测试 -->
                    <div class="test-section hidden" id="zodiacSection">
                        <h4>♈ 星座特质测试</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="zodiacProgress"></div>
                        </div>
                        <div id="zodiacQuestions"></div>
                        <button class="btn btn-secondary" onclick="previousZodiacSection('mbtiSection')">返回</button>
                        <button class="btn" onclick="nextZodiacSection('fusionSection')" id="zodiacNextBtn" disabled>下一步</button>
                    </div>

                    <!-- 融合验证测试 -->
                    <div class="test-section hidden" id="fusionSection">
                        <h4>🔄 融合验证测试</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="fusionProgress"></div>
                        </div>
                        <div id="fusionQuestions"></div>
                        <button class="btn btn-secondary" onclick="previousZodiacSection('zodiacSection')">返回</button>
                        <button class="btn" onclick="generateZodiacResults()" id="fusionNextBtn" disabled>生成结果</button>
                    </div>

                    <!-- 结果展示 -->
                    <div class="test-section hidden" id="zodiacResultSection">
                        <h4>🎯 你的融合测试结果</h4>
                        <div id="zodiacFusionResult"></div>
                        <div id="zodiacDetailedReport"></div>
                        <button class="btn btn-secondary" onclick="restartZodiacTest()">重新测试</button>
                        <button class="btn" onclick="shareZodiacResults()">分享结果</button>
                    </div>

                    <!-- 加载状态 -->
                    <div class="loading hidden" id="zodiacLoadingSection">
                        <div class="spinner"></div>
                        <p>正在分析你的星座特质和MBTI偏好...</p>
                    </div>
                </div>
            </div>
        </div>





        <!-- 登录页面 -->
        <div class="login-section hidden" id="loginSection">
            <div class="login-card">
                <div class="login-header">
                    <h1>🔐 登录MBTI测试</h1>
                    <p>请登录后开始你的性格探索之旅</p>
                    <button class="close-overlay-btn" onclick="closeLogin()">&times;</button>
                </div>
                
                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="username">用户名</label>
                        <input type="text" id="username" name="username" placeholder="请输入用户名" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">密码</label>
                        <input type="password" id="password" name="password" placeholder="请输入密码" required>
                    </div>
                    
                    <div class="form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="rememberMe">
                            <span class="checkmark"></span>
                            记住我
                        </label>
                        <a href="#" class="forgot-password" onclick="showForgotPassword()">忘记密码？</a>
                    </div>
                    
                    <button type="submit" class="btn login-btn">登录</button>
                </form>
                
                <div class="divider">
                    <span>或</span>
                </div>
                
                <button class="btn google-btn" onclick="googleLogin()">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    使用Google账号登录
                </button>
                
                <div class="register-link">
                    <p>还没有账号？ <a href="#" onclick="showRegister()">立即注册</a></p>
                </div>
            </div>
        </div>

        <!-- 注册页面 -->
        <div class="register-section hidden" id="registerSection">
            <div class="login-card">
                <div class="login-header">
                    <h1>📝 注册账号</h1>
                    <p>创建你的MBTI测试账号</p>
                    <button class="close-overlay-btn" onclick="closeRegister()">&times;</button>
                </div>
                
                <form class="login-form" id="registerForm">
                    <div class="form-group">
                        <label for="regUsername">用户名</label>
                        <input type="text" id="regUsername" name="username" placeholder="请输入用户名" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="regEmail">邮箱</label>
                        <input type="email" id="regEmail" name="email" placeholder="请输入邮箱" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="regPassword">密码</label>
                        <input type="password" id="regPassword" name="password" placeholder="请输入密码" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="regConfirmPassword">确认密码</label>
                        <input type="password" id="regConfirmPassword" name="confirmPassword" placeholder="请再次输入密码" required>
                    </div>
                    
                    <div class="form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="agreeTerms" required>
                            <span class="checkmark"></span>
                            我同意 <a href="#" class="terms-link">服务条款</a> 和 <a href="#" class="terms-link">隐私政策</a>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn login-btn">注册</button>
                </form>
                
                <div class="divider">
                    <span>或</span>
                </div>
                
                <button class="btn google-btn" onclick="googleLogin()">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    使用Google账号注册
                </button>
                
                <div class="register-link">
                    <p>已有账号？ <a href="#" onclick="showLogin()">立即登录</a></p>
                </div>
            </div>
        </div>

        <!-- MBTI介绍部分 -->
        <div class="card mbti-info-section hidden" id="mbtiInfoSection">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2>🧠 MBTI人格类型理论详解</h2>
                <button class="btn btn-secondary" onclick="hideMBTIInfo()" style="margin-top: 20px;">返回测试</button>
            </div>
            
            <div class="mbti-content">
                <div class="dimension-explanation">
                    <h3>📊 四个核心维度</h3>
                    
                    <div class="dimension-card">
                        <h4>1. 能量方向 (E - I)</h4>
                        <div class="dimension-details">
                            <div class="dimension-side">
                                <h5>外向 (E - Extraversion)</h5>
                                <ul>
                                    <li>从外部世界获取能量</li>
                                    <li>喜欢社交和互动</li>
                                    <li>行动导向，喜欢表达</li>
                                    <li>在人群中感到充满活力</li>
                                    <li>喜欢多样性和刺激</li>
                                </ul>
                            </div>
                            <div class="dimension-side">
                                <h5>内向 (I - Introversion)</h5>
                                <ul>
                                    <li>从内心世界获取能量</li>
                                    <li>喜欢独处和深度思考</li>
                                    <li>思考导向，喜欢倾听</li>
                                    <li>在安静环境中恢复精力</li>
                                    <li>喜欢专注和深度</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="dimension-card">
                        <h4>2. 信息接收 (S - N)</h4>
                        <div class="dimension-details">
                            <div class="dimension-side">
                                <h5>感觉 (S - Sensing)</h5>
                                <ul>
                                    <li>关注具体事实和细节</li>
                                    <li>相信经验和传统</li>
                                    <li>喜欢实际和可验证的信息</li>
                                    <li>活在当下，关注现实</li>
                                    <li>喜欢循序渐进的方法</li>
                                </ul>
                            </div>
                            <div class="dimension-side">
                                <h5>直觉 (N - Intuition)</h5>
                                <ul>
                                    <li>关注可能性和未来</li>
                                    <li>相信创新和改变</li>
                                    <li>喜欢理论和概念</li>
                                    <li>关注整体和模式</li>
                                    <li>喜欢跳跃式思维</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="dimension-card">
                        <h4>3. 决策方式 (T - F)</h4>
                        <div class="dimension-details">
                            <div class="dimension-side">
                                <h5>思考 (T - Thinking)</h5>
                                <ul>
                                    <li>基于逻辑和客观分析</li>
                                    <li>追求公平和一致性</li>
                                    <li>重视真理和准确性</li>
                                    <li>分析问题，寻找解决方案</li>
                                    <li>可能显得直接和坦率</li>
                                </ul>
                            </div>
                            <div class="dimension-side">
                                <h5>情感 (F - Feeling)</h5>
                                <ul>
                                    <li>基于价值观和感受</li>
                                    <li>追求和谐和关系</li>
                                    <li>重视人情和同理心</li>
                                    <li>考虑对他人的影响</li>
                                    <li>可能显得温和和关心</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="dimension-card">
                        <h4>4. 生活方式 (J - P)</h4>
                        <div class="dimension-details">
                            <div class="dimension-side">
                                <h5>判断 (J - Judging)</h5>
                                <ul>
                                    <li>喜欢计划和结构</li>
                                    <li>按时完成任务</li>
                                    <li>喜欢明确的期望</li>
                                    <li>做决定后坚持执行</li>
                                    <li>喜欢控制和确定性</li>
                                </ul>
                            </div>
                            <div class="dimension-side">
                                <h5>感知 (P - Perceiving)</h5>
                                <ul>
                                    <li>喜欢灵活和选择</li>
                                    <li>保持开放和适应性</li>
                                    <li>喜欢探索和发现</li>
                                    <li>延迟决定，收集信息</li>
                                    <li>喜欢自发和自由</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="personality-types">
                    <h3>🌟 16种性格类型概览</h3>
                    <div class="types-grid">
                        <div class="type-card">
                            <h4>INTJ - 建筑师</h4>
                            <p>富有想象力和战略性的思考者，一切都要经过深思熟虑</p>
                        </div>
                        <div class="type-card">
                            <h4>INTP - 逻辑学家</h4>
                            <p>创新的发明家，对知识有着不可抑制的渴望</p>
                        </div>
                        <div class="type-card">
                            <h4>ENTJ - 指挥官</h4>
                            <p>大胆、富有想象力的强领导者，总是能找到或创造解决方案</p>
                        </div>
                        <div class="type-card">
                            <h4>ENTP - 辩论家</h4>
                            <p>聪明好奇的思想家，不会放过任何智力挑战</p>
                        </div>
                        <div class="type-card">
                            <h4>INFJ - 提倡者</h4>
                            <p>安静而神秘，同时鼓舞人心且不知疲倦的理想主义者</p>
                        </div>
                        <div class="type-card">
                            <h4>INFP - 调停者</h4>
                            <p>诗意、善良的利他主义者，总是热情地为正当理由而战</p>
                        </div>
                        <div class="type-card">
                            <h4>ENFJ - 主人公</h4>
                            <p>富有魅力和鼓舞人心的领导者，有着与生俱来的领导能力</p>
                        </div>
                        <div class="type-card">
                            <h4>ENFP - 竞选者</h4>
                            <p>热情、有创造力、社交能力强的人，能够找到与他人联系的可能性</p>
                        </div>
                        <div class="type-card">
                            <h4>ISTJ - 物流师</h4>
                            <p>实际且注重事实的可靠个体，其可靠性不容置疑</p>
                        </div>
                        <div class="type-card">
                            <h4>ISFJ - 守卫者</h4>
                            <p>非常专注和温暖的守护者，时刻准备保护所爱之人</p>
                        </div>
                        <div class="type-card">
                            <h4>ESTJ - 总经理</h4>
                            <p>出色的管理者，在管理事情或人员方面无与伦比</p>
                        </div>
                        <div class="type-card">
                            <h4>ESFJ - 执政官</h4>
                            <p>极其关心他人的感受，以热情和友善著称</p>
                        </div>
                        <div class="type-card">
                            <h4>ISTP - 鉴赏家</h4>
                            <p>大胆而实用的实验家，擅长使用各种工具</p>
                        </div>
                        <div class="type-card">
                            <h4>ISFP - 探险家</h4>
                            <p>灵活且有魅力的艺术家，随时准备探索和体验新事物</p>
                        </div>
                        <div class="type-card">
                            <h4>ESTP - 企业家</h4>
                            <p>聪明、精力充沛且非常善于感知的人，真正享受生活的刺激</p>
                        </div>
                        <div class="type-card">
                            <h4>ESFP - 表演者</h4>
                            <p>自发的、精力充沛且热情的表演者，他们的生活永远不会无聊</p>
                        </div>
                    </div>
                </div>

                <div class="mbti-tips">
                    <h3>💡 MBTI使用建议</h3>
                    <div class="tips-content">
                        <div class="tip-item">
                            <h4>理解而非标签</h4>
                            <p>MBTI是一种工具，帮助你更好地理解自己和他人，而不是给人贴标签。每个人都是独特的个体。</p>
                        </div>
                        <div class="tip-item">
                            <h4>发展而非限制</h4>
                            <p>了解自己的偏好可以帮助你发挥优势，同时也可以有意识地发展其他方面的能力。</p>
                        </div>
                        <div class="tip-item">
                            <h4>沟通和理解</h4>
                            <p>理解不同的性格类型可以帮助你更好地与他人沟通，建立更和谐的关系。</p>
                        </div>
                        <div class="tip-item">
                            <h4>职业发展</h4>
                            <p>了解自己的性格类型可以为职业选择和发展方向提供参考，但不应作为唯一依据。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 测试部分 -->
        <div class="card test-section hidden" id="testSection">
            <div class="test-header">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="test-stage-display">
                    <span class="stage-badge" id="currentStageBadge">🌱 性格基础探索</span>
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-text" id="questionText"></div>
                <div class="options-container" id="optionsContainer"></div>
            </div>
            
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">上一题</button>
                <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>下一题</button>
            </div>
        </div>

        <!-- 结果部分 -->
        <div class="card result-section hidden" id="resultSection">
            <h2>🎉 测试完成！</h2>
            <div class="personality-type" id="personalityType"></div>
            
            <div class="dimensions" id="dimensionsContainer"></div>
            
            <div class="description">
                <h3>你的性格类型分析</h3>
                <div id="typeDescription"></div>
            </div>
            
            <button class="btn btn-secondary" onclick="restartTest()" style="margin-top: 30px;">重新测试</button>
        </div>

        <!-- 广告页面 -->
        <div class="ad-section hidden" id="adSection">
            <div class="ad-container">
                <div class="ad-header">
                    <h2>📺 观看广告继续测试</h2>
                    <p>为了支持免费测试服务，请观看以下广告后继续答题</p>
                    <div class="test-progress-info">
                        <span class="progress-badge">测试进度: 第 <span id="currentQuestionNumber"></span> 题 / 共 10 题</span>
                        <div class="test-progress-bar">
                            <div class="test-progress-fill" id="testProgressFill"></div>
                        </div>
                        <div class="test-stage-indicator">
                            <span class="stage-text" id="testStageText"></span>
                        </div>
                    </div>
                </div>
                
                <div class="ad-content">
                    <div class="ad-video-placeholder">
                        <div class="ad-video-frame">
                            <!-- Google AdSense 广告容器 -->
                            <div id="google-adsense-container" class="google-adsense-ad">
                                <div class="ad-loading">
                                    <div class="loading-spinner"></div>
                                    <p>正在加载Google AdSense广告...</p>
                                </div>
                                
                                <!-- 测试页面广告单元 -->
                                <div id="test-page-ad" class="adsense-ad-unit" style="display: none;">
                                    <ins class="adsbygoogle"
                                         style="display:block"
                                         data-ad-client="ca-pub-4198974976257818"
                                         data-ad-slot="1234567890"
                                         data-ad-format="auto"
                                         data-full-width-responsive="true">
                                    </ins>
                                </div>
                                
                                <!-- 结果页面广告单元 -->
                                <div id="result-page-ad" class="adsense-ad-unit" style="display: none;">
                                    <ins class="adsbygoogle"
                                         style="display:block"
                                         data-ad-client="ca-pub-4198974976257818"
                                         data-ad-slot="1234567890"
                                         data-ad-format="auto"
                                         data-full-width-responsive="true">
                                    </ins>
                                </div>
                            </div>
                            
                            <!-- 备用广告内容 -->
                            <div id="fallback-ad" class="fallback-ad" style="display: none;">
                                <div class="ad-video-player">
                                    <div class="ad-header">
                                        <div class="ad-badge">推荐</div>
                                        <div class="ad-sponsor">MBTI测试</div>
                                </div>
                                    <div class="ad-content-main">
                                        <div class="ad-icon">🧠</div>
                                        <div class="ad-title">MBTI性格测试结果解锁</div>
                                        <div class="ad-subtitle">了解你的真实性格类型</div>
                                        <div class="ad-features">
                                            <span class="feature">✨ 专业分析</span>
                                            <span class="feature">📊 详细报告</span>
                                            <span class="feature">🎯 职业建议</span>
                                        </div>
                                    </div>
                                    <div class="ad-footer">
                                        <div class="ad-duration">⏱️ 15秒</div>
                                        <div class="ad-action">观看解锁</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ad-info">
                        <div class="ad-progress">
                            <div class="progress-bar">
                                <div class="ad-progress-fill" id="adProgressFill"></div>
                            </div>
                            <div class="progress-text">
                                <span id="adCountdown">15</span>秒后解锁结果
                            </div>
                        </div>
                        
                        <div class="ad-benefits">
                            <h3>观看广告的好处：</h3>
                            <ul>
                                <li>✅ 继续完成MBTI测试</li>
                                <li>✅ 获得完整性格分析结果</li>
                                <li>✅ 支持我们继续提供免费服务</li>
                                <li>✅ 无任何隐藏费用</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="ad-actions">
                    <button class="btn btn-secondary" onclick="skipAd()">跳过广告</button>
                    <button class="btn" onclick="watchAd()" id="watchAdBtn">开始观看</button>
                    <button class="btn btn-info" onclick="toggleAdConfig()" style="margin-top: 10px; font-size: 0.9rem;">广告配置</button>
                    <button class="btn btn-success" onclick="testAdSense()" style="margin-top: 10px; font-size: 0.9rem;">测试AdSense</button>
                    <button class="btn btn-warning" onclick="debugTest()" style="margin-top: 10px; font-size: 0.9rem;">调试测试</button>
                    <button class="btn btn-primary" onclick="testQuestionDisplay()" style="margin-top: 10px; font-size: 0.9rem;">测试问题显示</button>
                </div>

                <!-- 广告配置面板 -->
                <div id="adConfigPanel" class="ad-config-panel" style="display: none;">
                    <div class="ad-config-header">
                        <h4>🔧 广告配置</h4>
                        <button class="close-config-btn" onclick="toggleAdConfig()">&times;</button>
            </div>
                    <div class="ad-config-content">
                        <div class="config-item">
                            <label>Google AdSense:</label>
                            <select id="adSenseEnabled" onchange="updateAdConfig()">
                                <option value="false">使用备用广告</option>
                                <option value="true">启用AdSense</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label>发布商ID:</label>
                            <input type="text" id="adClientId" placeholder="ca-pub-XXXXXXXXXX" onchange="updateAdConfig()">
                        </div>
                        <div class="config-item">
                            <label>广告位ID:</label>
                            <input type="text" id="adSlotId" placeholder="XXXXXXXXXX" onchange="updateAdConfig()">
                        </div>
                                        <div class="config-info">
                    <p><strong>说明：</strong></p>
                    <ul>
                        <li>• 备用广告：无需配置，直接显示</li>
                        <li>• AdSense：需要Google AdSense账号和广告位</li>
                        <li>• 配置后需要刷新页面生效</li>
                    </ul>
                    
                    <div class="adsense-status" style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 6px;">
                        <p><strong>AdSense状态：</strong></p>
                        <ul>
                            <li>• 脚本加载：<span id="scriptStatus">检查中...</span></li>
                            <li>• 发布商ID：<span id="publisherStatus">已配置</span></li>
                            <li>• 广告位ID：<span id="slotStatus">需要配置</span></li>
                            <li>• 连接状态：<span id="connectionStatus">测试中...</span></li>
                        </ul>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 忘记密码页面 -->
        <div class="forgot-password-section hidden" id="forgotPasswordSection">
            <div class="login-card">
                <div class="login-header">
                    <h1>🔑 忘记密码</h1>
                    <p>请输入你的邮箱地址，我们将发送重置链接</p>
                    <button class="close-overlay-btn" onclick="closeForgotPassword()">&times;</button>
                </div>
                
                <!-- 第一步：邮箱输入 -->
                <div id="forgotPasswordStep1">
                    <div class="form-group">
                        <label for="resetEmail">邮箱地址</label>
                        <input type="email" id="resetEmail" name="email" placeholder="请输入注册时使用的邮箱" required>
                    </div>
                    
                    <button type="button" class="btn login-btn" onclick="sendResetEmail()">发送重置链接</button>
                    
                    <div class="forgot-password-options">
                        <button class="btn btn-secondary" onclick="showLogin()">返回登录</button>
                        <button class="btn btn-secondary" onclick="showRegister()">注册新账号</button>
                    </div>
                </div>
                
                <!-- 第二步：验证码和新密码 -->
                <div id="forgotPasswordStep2" style="display: none;">
                    <div class="form-group">
                        <label for="resetCode">验证码</label>
                        <div class="verification-code-group">
                            <input type="text" id="resetCode" name="code" placeholder="请输入6位验证码" maxlength="6" required>
                            <button type="button" class="btn btn-secondary send-code-btn" onclick="sendVerificationCode()">
                                重新发送
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">新密码</label>
                        <input type="password" id="newPassword" name="password" placeholder="请输入新密码" required>
                        <div class="password-strength" id="passwordStrength"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmNewPassword">确认新密码</label>
                        <input type="password" id="confirmNewPassword" name="confirmPassword" placeholder="请再次输入新密码" required>
                    </div>
                    
                    <button type="submit" class="btn login-btn" onclick="resetPassword()">重置密码</button>
                    
                    <div class="forgot-password-options">
                        <button class="btn btn-secondary" onclick="backToStep1()">返回上一步</button>
                        <button class="btn btn-secondary" onclick="showLogin()">返回登录</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 页脚部分 -->
        <footer class="footer">
            <div class="footer-content interactive">
                <div class="footer-header">
                    <div class="company-intro">
                        <h3>🧠 MBTI人格测试平台</h3>
                        <p>专业 · 准确 · 便捷</p>
                    </div>
                    <div class="interactive-stats">
                        <div class="stat-counter" data-target="100">
                            <span class="counter">0</span>
                            <span class="unit">+</span>
                            <span class="label">人测试</span>
                        </div>
                        <div class="stat-counter" data-target="99.99">
                            <span class="counter">0</span>
                            <span class="unit">%</span>
                            <span class="label">精准</span>
                        </div>
                    </div>
                </div>
                
                <div class="footer-body">
                    <div class="footer-section interactive">
                        <h4>📞 联系我们</h4>
                        <div class="contact-methods">
                            <div class="contact-method" onclick="copyToClipboard('contact@mbti-test.com')">
                                <span class="icon">📧</span>
                                <span class="text">复制邮箱</span>
                                <span class="tooltip">点击复制</span>
                            </div>
                            <div class="contact-method" onclick="copyToClipboard('400-123-4567')">
                                <span class="icon">📱</span>
                                <span class="text">复制电话</span>
                                <span class="tooltip">点击复制</span>
                            </div>
                            <div class="contact-method" onclick="showQRCode()">
                                <span class="icon">💬</span>
                                <span class="text">微信二维码</span>
                                <span class="tooltip">查看二维码</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="footer-section interactive">
                        <h4>💬 快速反馈</h4>
                        <div class="feedback-buttons">
                            <button class="feedback-btn" data-type="praise" onclick="showPraiseOptions()">
                                <span class="icon">👍</span>
                                <span class="text">很好用</span>
                            </button>
                            <button class="feedback-btn" data-type="improvement" onclick="quickFeedback('improvement')">
                                <span class="icon">🚀</span>
                                <span class="text">功能改进</span>
                            </button>
                            <button class="feedback-btn" data-type="bug" onclick="quickFeedback('bug')">
                                <span class="icon">🐛</span>
                                <span class="text">问题反馈</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="footer-section interactive">
                        <h4>🔗 快速链接</h4>
                        <div class="quick-links">
                            <a href="#" class="quick-link" onclick="showMBTIInfo()">
                                <span class="icon">📚</span>
                                <span class="text">MBTI介绍</span>
                            </a>
                            <a href="#" class="quick-link" onclick="showPrivacyPolicy()">
                                <span class="icon">🔒</span>
                                <span class="text">隐私政策</span>
                            </a>
                            <a href="#" class="quick-link" onclick="showTermsOfService()">
                                <span class="icon">📋</span>
                                <span class="text">服务条款</span>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-info">
                        <p>&copy; 2024 MBTI人格测试</p>
                        <p>基于荣格类型学理论，仅供娱乐和参考使用</p>
                    </div>
                    <div class="footer-controls">
                        <button class="control-btn" onclick="backToTop()">⬆️ 返回顶部</button>
                        <button class="control-btn" onclick="toggleTheme()">🌙 切换主题</button>
                    </div>
                </div>
            </div>
        </footer>

        <!-- 留言反馈弹窗 -->
        <div class="feedback-modal hidden" id="feedbackModal">
            <div class="feedback-modal-content">
                <div class="feedback-modal-header">
                    <h3>💬 留言反馈</h3>
                    <button class="close-btn" onclick="closeFeedbackModal()">&times;</button>
                </div>
                <div class="feedback-modal-body">
                    <form class="feedback-form-modal" id="feedbackFormModal" onsubmit="handleFeedbackSubmit(event)">
                        <div class="form-group">
                            <label for="modalFeedbackName">姓名</label>
                            <input type="text" id="modalFeedbackName" name="name" placeholder="请输入您的姓名" required>
                        </div>
                        <div class="form-group">
                            <label for="modalFeedbackEmail">邮箱</label>
                            <input type="email" id="modalFeedbackEmail" name="email" placeholder="请输入您的邮箱" required>
                        </div>
                        <div class="form-group">
                            <label for="modalFeedbackType">反馈类型</label>
                            <select id="modalFeedbackType" name="type" required>
                                <option value="">请选择反馈类型</option>
                                <option value="praise">表扬</option>
                                <option value="improvement">功能改进</option>
                                <option value="bug">问题反馈</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modalFeedbackMessage">留言内容</label>
                            <textarea id="modalFeedbackMessage" name="message" placeholder="请详细描述您的意见或建议..." rows="5" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="modalAgreePrivacy" name="agreePrivacy" required>
                                <span class="checkmark"></span>
                                我同意 <a href="#" onclick="showPrivacyPolicy()">隐私政策</a>
                            </label>
                        </div>
                        <button type="submit" class="btn">提交反馈</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- 隐私政策弹窗 -->
        <div class="policy-modal hidden" id="privacyPolicyModal">
            <div class="policy-modal-content">
                <div class="policy-modal-header">
                    <h3>🔒 隐私政策</h3>
                    <button class="close-btn" onclick="closePolicyModal()">&times;</button>
                </div>
                <div class="policy-modal-body">
                    <div class="policy-actions policy-actions-top">
                        <button class="btn btn-secondary" onclick="closePolicyModal()">关闭</button>
                        <button class="btn btn-primary" onclick="acknowledgePrivacyPolicy()">我已知晓</button>
                    </div>
                    
                    <h4>信息收集</h4>
                    <p>我们仅收集测试过程中必要的个人信息，包括测试答案和基本用户信息。</p>
                    
                    <h4>信息使用</h4>
                    <p>收集的信息仅用于提供MBTI测试服务和改进用户体验，不会用于其他商业目的。</p>
                    
                    <h4>信息保护</h4>
                    <p>我们采用行业标准的安全措施保护您的个人信息，防止未经授权的访问、使用或泄露。</p>
                    
                    <h4>信息共享</h4>
                    <p>我们不会向第三方出售、交易或转让您的个人信息，除非获得您的明确同意。</p>
                    
                    <h4>Cookie使用</h4>
                    <p>我们使用Cookie来改善网站功能和用户体验，您可以在浏览器设置中禁用Cookie。</p>
                </div>
            </div>
        </div>

        <!-- 服务条款弹窗 -->
        <div class="policy-modal hidden" id="termsModal">
            <div class="policy-modal-content">
                <div class="policy-modal-header">
                    <h3>📋 服务条款</h3>
                    <button class="close-btn" onclick="closeTermsModal()">&times;</button>
                </div>
                <div class="policy-modal-body">
                    <div class="policy-actions policy-actions-top">
                        <button class="btn btn-secondary" onclick="showReadReminder()">取消</button>
                        <button class="btn btn-primary" onclick="acknowledgeTerms()">我已知晓并同意</button>
                    </div>
                    
                    <h4>服务说明</h4>
                    <p>本网站提供免费的MBTI人格测试服务，测试结果仅供娱乐和参考使用。</p>
                    
                    <h4>用户责任</h4>
                    <p>用户应确保提供的信息真实准确，不得恶意破坏网站功能或影响其他用户使用。</p>
                    
                    <h4>免责声明</h4>
                    <p>测试结果仅供参考，不构成专业心理建议。如有需要，请咨询专业心理咨询师。</p>
                    
                    <h4>服务变更</h4>
                    <p>我们保留随时修改或终止服务的权利，恕不另行通知。</p>
                    
                    <h4>法律适用</h4>
                    <p>本服务条款受中华人民共和国法律管辖，如有争议，以中文版本为准。</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // MBTI测试题目 - 渐进式深度 + 多维度交叉验证 + 图文增强
        const questions = [
            // ===== 第一层：基础偏好测试 =====
            {
                id: 1,
                level: 1,
                question: "在社交场合中，你通常：",
                options: ["A. 主动与他人交谈，享受成为焦点", "B. 倾向于观察他人，在熟悉的环境中才活跃"],
                dimension: "EI",
                category: "social_energy",
                weight: 1.0,
                explanation: "这个问题测试你如何获取社交能量",
                image: "🌐",
                visualType: "emoji",
                crossTest: ["EI", "SN"],
                scenario: "想象你参加一个朋友的聚会，房间里有很多陌生人..."
            },
            {
                id: 2,
                level: 1,
                question: "你更倾向于：",
                options: ["A. 关注具体细节和现实情况", "B. 思考可能性和未来趋势"],
                dimension: "SN",
                category: "information_processing",
                weight: 1.0,
                explanation: "这个问题测试你如何接收和处理信息",
                image: "🔍",
                visualType: "emoji",
                crossTest: ["SN", "JP"],
                scenario: "当你需要做决定时，你会更关注..."
            },
            {
                id: 3,
                level: 1,
                question: "当你需要做决定时，你更依赖：",
                options: ["A. 逻辑分析和客观事实", "B. 个人价值观和感受"],
                dimension: "TF",
                category: "decision_making",
                weight: 1.0,
                explanation: "这个问题测试你的决策方式",
                image: "⚖️",
                visualType: "emoji",
                crossTest: ["TF", "SN"],
                scenario: "面对一个重要的选择，你会..."
            },
            {
                id: 4,
                level: 1,
                question: "你更喜欢的工作环境是：",
                options: ["A. 有明确的结构和计划", "B. 灵活多变，可以随机应变"],
                dimension: "JP",
                category: "lifestyle_preference",
                weight: 1.0,
                explanation: "这个问题测试你的生活方式偏好",
                image: "🏢",
                visualType: "emoji",
                crossTest: ["JP", "EI"],
                scenario: "想象你的理想工作环境..."
            },

            // ===== 第二层：具体行为测试 =====
            {
                id: 5,
                level: 2,
                question: "在团队会议中，你通常：",
                options: ["A. 积极发言，分享想法和观点", "B. 仔细倾听，在适当时机提出建议"],
                dimension: "EI",
                category: "team_communication",
                weight: 1.2,
                explanation: "基于你的社交偏好，测试团队中的具体表现",
                requires: "EI",
                image: "👥",
                visualType: "emoji",
                crossTest: ["EI", "TF"],
                scenario: "想象你参加一个重要的团队会议，讨论新项目方案...",
                visualHint: "会议场景，有人积极发言，有人认真倾听"
            },
            {
                id: 6,
                level: 2,
                question: "学习新技能时，你更喜欢：",
                options: ["A. 通过实际操作和练习来掌握", "B. 先理解概念和原理，再付诸实践"],
                dimension: "SN",
                category: "learning_style",
                weight: 1.2,
                explanation: "基于你的信息处理方式，测试具体的学习偏好",
                requires: "SN",
                image: "📚",
                visualType: "emoji",
                crossTest: ["SN", "JP"],
                scenario: "想象你要学习一门新的编程语言，你会选择哪种方式？",
                visualHint: "学习场景，有人直接动手，有人先看书"
            },
            {
                id: 7,
                level: 2,
                question: "面对朋友的情感问题时，你会：",
                options: ["A. 分析问题的逻辑，帮助找到解决方案", "B. 倾听感受，提供情感支持和安慰"],
                dimension: "TF",
                category: "emotional_support",
                weight: 1.2,
                explanation: "基于你的决策方式，测试情感支持的具体表现",
                requires: "TF"
            },
            {
                id: 8,
                level: 2,
                question: "处理工作任务时，你倾向于：",
                options: ["A. 制定详细计划，按步骤执行", "B. 保持灵活性，根据情况调整策略"],
                dimension: "JP",
                category: "work_organization",
                weight: 1.2,
                explanation: "基于你的生活方式偏好，测试工作组织方式",
                requires: "JP"
            },

            // ===== 第三层：深度分析测试 =====
            {
                id: 9,
                level: 3,
                question: "当需要创新解决方案时，你会：",
                options: ["A. 基于现有经验和成功案例进行改进", "B. 跳出框架，探索全新的可能性"],
                dimension: "SN",
                category: "innovation_approach",
                weight: 1.5,
                explanation: "深度测试你的创新思维模式",
                requires: ["SN", "TF"]
            },
            {
                id: 10,
                level: 3,
                question: "在压力情况下，你更依赖：",
                options: ["A. 系统性的分析和规划", "B. 直觉和快速判断"],
                dimension: "SN",
                category: "stress_response",
                weight: 1.5,
                explanation: "测试压力下的决策偏好",
                requires: ["SN", "JP"]
            },
            {
                id: 11,
                level: 3,
                question: "处理人际关系冲突时，你优先考虑：",
                options: ["A. 公平和原则的维护", "B. 关系的和谐和长期发展"],
                dimension: "TF",
                category: "conflict_resolution",
                weight: 1.5,
                explanation: "深度测试你的价值观和冲突处理方式",
                requires: ["TF", "EI"]
            },
            {
                id: 12,
                level: 3,
                question: "面对变化和不确定性时，你会：",
                options: ["A. 寻求稳定和控制，制定应对计划", "B. 保持开放和适应，享受变化带来的机会"],
                dimension: "JP",
                category: "change_adaptation",
                weight: 1.5,
                explanation: "测试你对变化的适应能力",
                requires: ["JP", "SN"]
            },

            // ===== 第四层：交叉验证测试 =====
            {
                id: 13,
                level: 4,
                question: "在团队领导中，你更擅长：",
                options: ["A. 制定明确目标，监督执行过程", "B. 激发团队创意，营造开放氛围"],
                dimension: "JP",
                category: "leadership_style",
                weight: 2.0,
                explanation: "交叉验证你的领导风格偏好",
                requires: ["JP", "EI", "TF"]
            },
            {
                id: 14,
                level: 4,
                question: "解决问题时，你的思维过程是：",
                options: ["A. 逐步分析，确保每个环节都准确", "B. 整体把握，快速识别关键要素"],
                dimension: "SN",
                category: "problem_solving",
                weight: 2.0,
                explanation: "交叉验证你的问题解决方式",
                requires: ["SN", "TF", "JP"]
            },
            {
                id: 15,
                level: 4,
                question: "在个人发展中，你更重视：",
                options: ["A. 技能的提升和成就的获得", "B. 内在的成长和关系的建立"],
                dimension: "TF",
                category: "personal_growth",
                weight: 2.0,
                explanation: "交叉验证你的个人发展价值观",
                requires: ["TF", "EI", "SN"]
            },
            {
                id: 16,
                level: 4,
                question: "面对复杂项目时，你的工作方式是：",
                options: ["A. 系统规划，分阶段推进", "B. 灵活调整，抓住关键时机"],
                dimension: "JP",
                category: "project_management",
                weight: 2.0,
                explanation: "交叉验证你的项目管理风格",
                requires: ["JP", "SN", "EI"]
            },

            // ===== 第五层：综合验证测试 =====
            {
                id: 17,
                level: 5,
                question: "在重要决策中，你的决策模式是：",
                options: ["A. 收集充分信息，分析利弊，制定详细计划", "B. 相信直觉判断，保持灵活性，根据情况调整"],
                dimension: "JP",
                category: "problem_solving",
                weight: 2.5,
                explanation: "综合验证你的决策模式",
                requires: ["JP", "SN", "TF", "EI"]
            },
            {
                id: 18,
                level: 5,
                question: "你的理想工作环境应该具备：",
                options: ["A. 清晰的结构、明确的目标、稳定的流程", "B. 创新的氛围、灵活的安排、变化的机会"],
                dimension: "JP",
                category: "ideal_workplace",
                weight: 2.5,
                explanation: "综合验证你的工作环境偏好",
                requires: ["JP", "SN", "EI", "TF"]
            },
            {
                id: 19,
                level: 5,
                question: "在人际关系中，你更看重：",
                options: ["A. 真诚的交流、共同的目标、相互的尊重", "B. 情感的连接、个性的表达、自由的氛围"],
                dimension: "TF",
                category: "relationship_values",
                weight: 2.5,
                explanation: "综合验证你的人际关系价值观",
                requires: ["TF", "EI", "SN", "JP"]
            },
            {
                id: 20,
                level: 5,
                question: "你的生活哲学更倾向于：",
                options: ["A. 通过规划和努力实现目标，创造有序的生活", "B. 保持开放和适应，享受生活的多样性和可能性"],
                dimension: "JP",
                category: "life_philosophy",
                weight: 2.5,
                explanation: "综合验证你的生活哲学",
                requires: ["JP", "SN", "TF", "EI"]
            },

            // ===== 文献建模扩展：基础偏好（心理类型/天生不同） =====
            {
                id: 21,
                level: 1,
                question: "初到新环境时，你通常：",
                options: ["A. 主动尝试融入，快速建立连接", "B. 先观察整体氛围，择机参与"],
                dimension: "EI",
                category: "social_energy",
                weight: 1.0,
                explanation: "态度(E/I)偏好（荣格《心理类型》）",
                source: "心理类型",
                facet: "态度(E/I)"
            },
            {
                id: 22,
                level: 1,
                question: "做方案时你更看重：",
                options: ["A. 可验证的数据与既有经验", "B. 潜在模式与未来可能"],
                dimension: "SN",
                category: "information_processing",
                weight: 1.0,
                explanation: "功能(S/N)偏好（荣格《心理类型》）",
                source: "心理类型",
                facet: "功能(S/N)"
            },
            {
                id: 23,
                level: 1,
                question: "面对分歧你更倾向于：",
                options: ["A. 回到标准与证据，理清是非", "B. 考量双方感受，顾及关系"],
                dimension: "TF",
                category: "decision_making",
                weight: 1.0,
                explanation: "功能(T/F)偏好（荣格《心理类型》）",
                source: "心理类型",
                facet: "功能(T/F)"
            },
            {
                id: 24,
                level: 1,
                question: "你的时间观更像：",
                options: ["A. 先定计划再推进，按部就班", "B. 先启动探索，再逐步成形"],
                dimension: "JP",
                category: "lifestyle_preference",
                weight: 1.0,
                explanation: "取向(J/P)偏好（MBTI框架）",
                source: "天生不同/请理解我",
                facet: "取向(J/P)"
            },

            // ===== 文献建模扩展：具体行为（请理解我/类型与沟通） =====
            {
                id: 25,
                level: 2,
                question: "沟通时你更常：",
                options: ["A. 直陈要点，追求效率与清晰", "B. 先建立氛围，循序渐进表达"],
                dimension: "EI",
                category: "team_communication",
                weight: 1.2,
                explanation: "沟通取向（《类型与沟通》《请理解我》）",
                source: "类型与沟通",
                facet: "表达/倾听"
            },
            {
                id: 26,
                level: 2,
                question: "学习路径选择时你更看重：",
                options: ["A. 可复用的范式与最佳实践", "B. 原理框架与模型推演"],
                dimension: "SN",
                category: "learning_style",
                weight: 1.2,
                explanation: "经验(S) vs 直觉(N)的学习偏好（《请理解我》）",
                source: "请理解我",
                facet: "学习方式"
            },
            {
                id: 27,
                level: 2,
                question: "反馈他人时你更：",
                options: ["A. 指出问题与改进建议", "B. 先肯定再提出感受与期望"],
                dimension: "TF",
                category: "emotional_support",
                weight: 1.2,
                explanation: "决策与人际权衡（《类型与沟通》）",
                source: "类型与沟通",
                facet: "反馈风格"
            },
            {
                id: 28,
                level: 2,
                question: "面对不确定任务你通常：",
                options: ["A. 快速澄清目标，划分阶段推进", "B. 保持开放探索，多方案并行试错"],
                dimension: "JP",
                category: "work_organization",
                weight: 1.2,
                explanation: "结构(J) vs 机动(P)（《请理解我》）",
                source: "请理解我",
                facet: "组织风格"
            },

            // ===== 文献建模扩展：深度功能偏好（心理类型/认知功能） =====
            {
                id: 29,
                level: 3,
                question: "面向未来的思考中你更：",
                options: ["A. 从当下数据外推趋势（Se/Te倾向）", "B. 由直觉洞见回推路径（Ni/Ne倾向）"],
                dimension: "SN",
                category: "innovation_approach",
                weight: 1.5,
                explanation: "感知/直觉的功能取向（荣格功能）",
                source: "心理类型",
                facet: "功能取向"
            },
            {
                id: 30,
                level: 3,
                question: "评估方案优先级时你侧重：",
                options: ["A. 客观标准、一致性与可复现（Ti/Te）", "B. 价值契合、影响关系与人群（Fi/Fe）"],
                dimension: "TF",
                category: "conflict_resolution",
                weight: 1.5,
                explanation: "思考/情感的功能取向（荣格功能）",
                source: "心理类型",
                facet: "功能取向"
            },
            {
                id: 31,
                level: 3,
                question: "推进复杂议题时你更：",
                options: ["A. 锁定目标与路径，减少变量（J）", "B. 保留探索窗口，动态适配（P）"],
                dimension: "JP",
                category: "change_adaptation",
                weight: 1.5,
                explanation: "取向(J/P)在复杂性情境下的表现",
                source: "天生不同",
                facet: "复杂性管理"
            },
            {
                id: 32,
                level: 3,
                question: "社交展示中你更：",
                options: ["A. 以任务/目标驱动互动（E-任务型）", "B. 以关系/氛围驱动互动（I-关系型）"],
                dimension: "EI",
                category: "stress_response",
                weight: 1.5,
                explanation: "E/I在目标与关系之间的侧重",
                source: "类型与沟通",
                facet: "社交取向"
            },

            // ===== 文献建模扩展：交叉验证（类型与亲密关系/就业宝典） =====
            {
                id: 33,
                level: 4,
                question: "亲密关系中你更看重：",
                options: ["A. 共同目标、角色分工与稳定性", "B. 情感连接、表达自由与理解"],
                dimension: "TF",
                category: "relationship_values",
                weight: 2.0,
                explanation: "伴侣期望的价值取向（《类型与亲密关系》）",
                source: "类型与亲密关系",
                facet: "伴侣期望"
            },
            {
                id: 34,
                level: 4,
                question: "职业场景里更适配你的是：",
                options: ["A. 规则明确、流程稳定的岗位（SJ/NT偏好）", "B. 创意驱动、变化快速的岗位（SP/NF偏好）"],
                dimension: "JP",
                category: "ideal_workplace",
                weight: 2.0,
                explanation: "凯尔西气质与职业匹配（《就业宝典》）",
                source: "就业宝典",
                facet: "气质与职业"
            },
            {
                id: 35,
                level: 4,
                question: "信息获取更偏好：",
                options: ["A. 一手事实、可测量指标（S）", "B. 模式识别、隐含意义（N）"],
                dimension: "SN",
                category: "problem_solving",
                weight: 2.0,
                explanation: "感觉/直觉在知识摄入的差异",
                source: "心理类型",
                facet: "信息偏好"
            },
            {
                id: 36,
                level: 4,
                question: "团队协作时更关注：",
                options: ["A. 角色清晰、进度与产出", "B. 心理安全、关系与动力"],
                dimension: "EI",
                category: "leadership_style",
                weight: 2.0,
                explanation: "外向/内向在团队目标中的侧重",
                source: "类型与沟通",
                facet: "团队关注点"
            },

            // ===== 文献建模扩展：综合验证（了不起的16型人格/学术论文） =====
            {
                id: 37,
                level: 5,
                question: "遇到价值冲突时你更可能：",
                options: ["A. 坚持原则并优化规则（T/NT气质）", "B. 协调关系并寻求共识（F/NF气质）"],
                dimension: "TF",
                category: "life_philosophy",
                weight: 2.5,
                explanation: "价值系统取向（《了不起的16型人格》《学术论文综述》）",
                source: "学术论文/16型人格",
                facet: "价值取向"
            },
            {
                id: 38,
                level: 5,
                question: "长期学习策略你更：",
                options: ["A. 以目标为导向，阶段性复盘与固化", "B. 以兴趣为驱动，广度探索与联结"],
                dimension: "JP",
                category: "personal_growth",
                weight: 2.5,
                explanation: "J/P在元学习中的差异（文献综合）",
                source: "学术论文",
                facet: "元学习"
            },
            {
                id: 39,
                level: 5,
                question: "复杂问题求解你更：",
                options: ["A. 自底向上汇总证据（S/T）", "B. 自顶向下设定假说（N/T或N/F）"],
                dimension: "SN",
                category: "problem_solving",
                weight: 2.5,
                explanation: "S/N在推理路径上的差异（学术综述）",
                source: "学术论文",
                facet: "推理路径"
            },
            {
                id: 40,
                level: 5,
                question: "人际决策你更：",
                options: ["A. 依据角色/规则保持一致性（T/J）", "B. 依据情境/人心灵活调整（F/P）"],
                dimension: "TF",
                category: "relationship_values",
                weight: 2.5,
                explanation: "T/F与J/P的交互（文献综合）",
                source: "类型与亲密关系/学术论文",
                facet: "人际决策"
            }
        ];

        // 性格类型描述
        const typeDescriptions = {
            "INTJ": "建筑师 - 富有想象力和战略性的思考者，一切都要经过深思熟虑。",
            "INTP": "逻辑学家 - 创新的发明家，对知识有着不可抑制的渴望。",
            "ENTJ": "指挥官 - 大胆、富有想象力的强领导者，总是能找到或创造解决方案。",
            "ENTP": "辩论家 - 聪明好奇的思想家，不会放过任何智力挑战。",
            "INFJ": "提倡者 - 安静而神秘，同时鼓舞人心且不知疲倦的理想主义者。",
            "INFP": "调停者 - 诗意、善良的利他主义者，总是热情地为正当理由而战。",
            "ENFJ": "主人公 - 富有魅力和鼓舞人心的领导者，有着与生俱来的领导能力。",
            "ENFP": "竞选者 - 热情、有创造力、社交能力强的人，能够找到与他人联系的可能性。",
            "ISTJ": "物流师 - 实际且注重事实的可靠个体，其可靠性不容置疑。",
            "ISFJ": "守卫者 - 非常专注和温暖的守护者，时刻准备保护所爱之人。",
            "ESTJ": "总经理 - 出色的管理者，在管理事情或人员方面无与伦比。",
            "ESFJ": "执政官 - 极其关心他人的感受，以热情和友善著称。",
            "ISTP": "鉴赏家 - 大胆而实用的实验家，擅长使用各种工具。",
            "ISFP": "探险家 - 灵活且有魅力的艺术家，随时准备探索和体验新事物。",
            "ESTP": "企业家 - 聪明、精力充沛且非常善于感知的人，真正享受生活的刺激。",
            "ESFP": "表演者 - 自发的、精力充沛且热情的表演者，他们的生活永远不会无聊。"
        };

        let currentQuestion = 0;
        let answers = [];
        let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        let currentUser = null;
        let questionSequence = []; // 动态问题序列
        let dimensionProgress = { EI: 0, SN: 0, TF: 0, JP: 0 }; // 各维度进度
        let testLevel = 1; // 当前测试层级

        // Google AdSense 配置
        window.googleAdConfig = {
            clientId: 'ca-pub-4198974976257818', // 你的真实发布商ID
            slotId: '1234567890', // 需要替换为你的广告位ID
            enabled: true, // 启用AdSense
            adFormat: 'auto', // 自动格式
            responsive: true // 响应式支持
        };

        // 页面状态管理
        const PAGE_STATES = {
            HOME: 'home',
            TEST: 'test',
            AD: 'ad',
            RESULT: 'result',
            LOGIN: 'login',
            REGISTER: 'register',
            FORGOT_PASSWORD: 'forgot-password',
            MBTI_INFO: 'mbti-info'
        };

        let currentPage = PAGE_STATES.HOME;
        let pageHistory = [];

        // 页面加载时初始化
        window.onload = function() {
            initializeNavigation();
            checkLoginStatus();
        };

        // 初始化导航系统
        function initializeNavigation() {
            // 设置初始页面为功能卡片区域
            showFeaturesSection();
            
            // 监听浏览器后退按钮
            window.addEventListener('popstate', function(event) {
                if (event.state && event.state.page) {
                    navigateToPage(event.state.page, false);
                }
            });
        }

        // 导航到指定页面
        function navigateToPage(page, addToHistory = true) {
            console.log(`导航到页面: ${page}`);
            
            // 保存当前页面到历史记录
            if (addToHistory && currentPage !== page) {
                pageHistory.push(currentPage);
                // 更新浏览器历史
                window.history.pushState({ page: page }, '', `#${page}`);
            }
            
            // 更新当前页面状态
            currentPage = page;
            
            // 隐藏所有页面
            hideAllPages();
            
            // 显示目标页面
            showPage(page);
            
            console.log(`页面切换完成: ${page}`);
        }

        // 隐藏所有页面
        function hideAllPages() {
            const pages = [
                'testSection', 'adSection', 'resultSection',
                'loginSection', 'registerSection', 'forgotPasswordSection',
                'mbtiInfoSection'
            ];
            
            pages.forEach(pageId => {
                const element = document.getElementById(pageId);
                if (element) {
                    element.classList.add('hidden');
                    element.style.display = 'none';
                }
            });
        }

        // 显示指定页面
        function showPage(page) {
            let targetElement = null;
            
            switch (page) {
                case PAGE_STATES.HOME:
                    // 首页现在直接显示功能卡片区域
                    targetElement = document.getElementById('featuresSection');
                    break;
                case PAGE_STATES.TEST:
                    targetElement = document.getElementById('testSection');
                    break;
                case PAGE_STATES.AD:
                    targetElement = document.getElementById('adSection');
                    break;
                case PAGE_STATES.RESULT:
                    targetElement = document.getElementById('resultSection');
                    break;
                case PAGE_STATES.LOGIN:
                    targetElement = document.getElementById('loginSection');
                    break;
                case PAGE_STATES.REGISTER:
                    targetElement = document.getElementById('registerSection');
                    break;
                case PAGE_STATES.FORGOT_PASSWORD:
                    targetElement = document.getElementById('forgotPasswordSection');
                    break;
                case PAGE_STATES.MBTI_INFO:
                    targetElement = document.getElementById('mbtiInfoSection');
                    break;
            }
            
            if (targetElement) {
                targetElement.classList.remove('hidden');
                targetElement.style.display = 'block';
                console.log(`显示页面: ${page}`);
                
                // 如果是广告页面，初始化广告
                if (page === PAGE_STATES.AD) {
                    setTimeout(() => {
                        initAdPage();
                    }, 100);
                }
            } else {
                console.error(`找不到页面元素: ${page}`);
            }
        }

        // 返回上一页
        function goBack() {
            if (pageHistory.length > 0) {
                const previousPage = pageHistory.pop();
                navigateToPage(previousPage, false);
            } else {
                navigateToPage(PAGE_STATES.HOME, false);
            }
        }

        // 检查登录状态
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('mbti_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showLoggedInState();
            } else {
                showGuestState();
            }
        }

        // 显示已登录状态
        function showLoggedInState() {
            document.getElementById('userInfoSection').classList.add('hidden');
            document.getElementById('loggedInSection').classList.remove('hidden');
            
            // 更新用户显示名称
            if (currentUser) {
                document.getElementById('userDisplayName').textContent = `欢迎回来，${currentUser.username}！`;
            }
        }

        // 显示访客状态
        function showGuestState() {
            document.getElementById('loggedInSection').classList.add('hidden');
            document.getElementById('userInfoSection').classList.remove('hidden');
        }

        // 显示登录页面
        function showLoginPage() {
            navigateToPage(PAGE_STATES.LOGIN);
        }

        // 显示主内容
        function showMainContent() {
            navigateToPage(PAGE_STATES.HOME);
            // 更新登录状态
            showLoggedInState();
        }

        // 显示注册页面
        function showRegister() {
            navigateToPage(PAGE_STATES.REGISTER);
        }

        // 显示登录页面
        function showLogin() {
            navigateToPage(PAGE_STATES.LOGIN);
        }

        // 处理登录表单提交
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // 简单的登录验证（实际应用中应该连接后端API）
                if (username && password) {
                    currentUser = { username: username, email: username + '@example.com' };
                    localStorage.setItem('mbti_user', JSON.stringify(currentUser));
                    showMainContent();
                } else {
                    alert('请输入用户名和密码');
                }
            });
        }

        // 处理注册表单提交
        const registerForm = document.getElementById('registerForm');
        if (registerForm) {
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('regUsername').value;
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;
                
                if (!agreeTerms) {
                    alert('请同意服务条款和隐私政策');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('两次输入的密码不一致');
                    return;
                }
                
                if (username && email && password) {
                    currentUser = { username: username, email: email };
                    localStorage.setItem('mbti_user', JSON.stringify(currentUser));
                    showMainContent();
                } else {
                    alert('请填写所有必填字段');
                }
            });
        }

        // Google登录（改进版）
        function googleLogin() {
            // 显示Google登录弹窗
            showGoogleLoginModal();
        }

        // 显示Google登录弹窗
        function showGoogleLoginModal() {
            const modal = document.createElement('div');
            modal.className = 'google-modal';
            modal.innerHTML = `
                <div class="google-modal-content">
                    <div class="google-modal-header">
                        <h3>🔐 Google账号登录</h3>
                        <button class="close-btn" onclick="closeGoogleModal()">&times;</button>
                    </div>
                    <div class="google-modal-body">
                        <div class="google-login-options">
                            <div class="google-account-item" onclick="selectGoogleAccount('user1@gmail.com', '张三')">
                                <div class="google-avatar">张</div>
                                <div class="google-account-info">
                                    <div class="google-name">张三</div>
                                    <div class="google-email">user1@gmail.com</div>
                                </div>
                            </div>
                            <div class="google-account-item" onclick="selectGoogleAccount('user2@gmail.com', '李四')">
                                <div class="google-avatar">李</div>
                                <div class="google-account-info">
                                    <div class="google-name">李四</div>
                                    <div class="google-email">user2@gmail.com</div>
                                </div>
                            </div>
                            <div class="google-account-item" onclick="selectGoogleAccount('user3@gmail.com', '王五')">
                                <div class="google-avatar">王</div>
                                <div class="google-account-info">
                                    <div class="google-name">王五</div>
                                    <div class="google-email">user3@gmail.com</div>
                                </div>
                            </div>
                        </div>
                        <div class="google-add-account">
                            <button class="btn btn-secondary" onclick="addNewGoogleAccount()">
                                <svg class="google-icon" viewBox="0 0 24 24">
                                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                                </svg>
                                使用其他Google账号
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 关闭Google登录弹窗
        function closeGoogleModal() {
            const modal = document.querySelector('.google-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 选择Google账号
        function selectGoogleAccount(email, name) {
            const googleUser = {
                username: name,
                email: email,
                loginMethod: 'Google'
            };
            
            currentUser = googleUser;
            localStorage.setItem('mbti_user', JSON.stringify(currentUser));
            closeGoogleModal();
            showMainContent();
        }

        // 添加新的Google账号
        function addNewGoogleAccount() {
            // 显示Google注册选项弹窗
            showGoogleRegisterModal();
        }

        // 显示Google注册弹窗
        function showGoogleRegisterModal() {
            const modal = document.createElement('div');
            modal.className = 'google-modal';
            modal.innerHTML = `
                <div class="google-modal-content">
                    <div class="google-modal-header">
                        <h3>🔐 Google账号注册</h3>
                        <button class="close-btn" onclick="closeGoogleModal()">&times;</button>
                    </div>
                    <div class="google-modal-body">
                        <div class="google-register-options">
                            <div class="google-register-item">
                                <div class="google-register-icon">📧</div>
                                <div class="google-register-info">
                                    <h4>创建新的Google账号</h4>
                                    <p>注册新的Gmail邮箱和Google账号</p>
                                </div>
                                <button class="btn btn-primary" onclick="openGoogleRegister()">
                                    前往注册
                                </button>
                            </div>
                            
                            <div class="google-register-item">
                                <div class="google-register-icon">🔑</div>
                                <div class="google-register-info">
                                    <h4>已有Google账号</h4>
                                    <p>使用现有的Gmail邮箱登录</p>
                                </div>
                                <button class="btn btn-secondary" onclick="showGoogleLoginModal()">
                                    返回登录
                                </button>
                            </div>
                            
                            <div class="google-register-item">
                                <div class="google-register-icon">📱</div>
                                <div class="google-register-info">
                                    <h4>手机号注册</h4>
                                    <p>使用手机号创建Google账号</p>
                                </div>
                                <button class="btn btn-secondary" onclick="phoneRegister()">
                                    手机注册
                                </button>
                            </div>
                        </div>
                        
                        <div class="google-help">
                            <p>💡 提示：注册完成后，请使用新账号登录</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 打开Google注册页面
        function openGoogleRegister() {
            // 在新窗口打开Google注册页面
            const googleRegisterUrl = 'https://accounts.google.com/signup';
            window.open(googleRegisterUrl, '_blank', 'width=800,height=600');
            
            // 显示提示信息
            alert('已打开Google注册页面，请在新窗口中完成注册。注册完成后，请返回此页面使用新账号登录。');
            
            // 关闭当前弹窗
            closeGoogleModal();
        }

        // 手机号注册
        function phoneRegister() {
            // 显示手机号注册弹窗
            showPhoneRegisterModal();
        }

        // 显示手机号注册弹窗
        function showPhoneRegisterModal() {
            const modal = document.createElement('div');
            modal.className = 'phone-register-modal';
            modal.innerHTML = `
                <div class="phone-register-content">
                    <div class="phone-register-header">
                        <h3>📱 手机号注册</h3>
                        <button class="close-btn" onclick="closePhoneRegisterModal()">&times;</button>
                    </div>
                    <div class="phone-register-body">
                        <!-- 第一步：手机号输入 -->
                        <div id="phoneStep1">
                            <div class="form-group">
                                <label for="phoneNumber">手机号码</label>
                                <input type="tel" id="phoneNumber" placeholder="请输入11位手机号码" maxlength="11" required>
                            </div>
                            <div class="form-group">
                                <label for="userName">姓名</label>
                                <input type="text" id="userName" placeholder="请输入您的姓名" required>
                            </div>
                            <button class="btn" onclick="sendPhoneVerification()">发送验证码</button>
                        </div>
                        
                        <!-- 第二步：验证码验证 -->
                        <div id="phoneStep2" style="display: none;">
                            <div class="verification-info">
                                <p>验证码已发送至 <span id="displayPhone"></span></p>
                                <p class="countdown-text">倒计时：<span id="phoneCountdown">60</span>秒</p>
                            </div>
                            <div class="form-group">
                                <label for="phoneVerificationCode">验证码</label>
                                <div class="verification-input-group">
                                    <input type="text" id="phoneVerificationCode" placeholder="请输入6位验证码" maxlength="6" required>
                                    <button type="button" class="btn btn-secondary" id="resendCodeBtn" onclick="resendPhoneCode()" disabled>重新发送</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="phonePassword">设置密码</label>
                                <input type="password" id="phonePassword" placeholder="请设置登录密码（至少8位）" required>
                                <div class="password-strength" id="phonePasswordStrength"></div>
                            </div>
                            <div class="form-group">
                                <label for="phoneConfirmPassword">确认密码</label>
                                <input type="password" id="phoneConfirmPassword" placeholder="请再次输入密码" required>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="agreePhoneTerms" required>
                                    <span class="checkmark"></span>
                                    我同意 <a href="#" onclick="showTermsOfService()">服务条款</a> 和 <a href="#" onclick="showPrivacyPolicy()">隐私政策</a>
                                </label>
                            </div>
                            <div class="phone-actions">
                                <button class="btn btn-secondary" onclick="backToPhoneStep1()">返回上一步</button>
                                <button class="btn" onclick="verifyPhoneAndRegister()">完成注册</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 点击外部关闭弹窗
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // 关闭手机号注册弹窗
        function closePhoneRegisterModal() {
            const modal = document.querySelector('.phone-register-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 发送手机验证码
        function sendPhoneVerification() {
            const phone = document.getElementById('phoneNumber').value;
            const name = document.getElementById('userName').value;
            
            if (!phone || phone.length !== 11) {
                showToast('请输入有效的11位手机号码', 'error');
                return;
            }
            
            if (!name || name.trim().length < 2) {
                showToast('请输入至少2位姓名', 'error');
                return;
            }
            
            // 验证手机号格式
            if (!/^1[3-9]\d{9}$/.test(phone)) {
                showToast('请输入正确的手机号码格式', 'error');
                return;
            }
            
            // 模拟发送验证码
            showToast('验证码发送中...', 'info');
            
            // 生成6位随机验证码
            const verificationCode = Math.floor(100000 + Math.random() * 900000);
            localStorage.setItem('phone_verification_code', verificationCode.toString());
            localStorage.setItem('phone_number', phone);
            localStorage.setItem('phone_user_name', name);
            
            // 显示第二步
            document.getElementById('phoneStep1').style.display = 'none';
            document.getElementById('phoneStep2').style.display = 'block';
            document.getElementById('displayPhone').textContent = phone;
            
            // 开始倒计时
            startPhoneCountdown();
            
            // 显示验证码（实际应用中应该通过短信发送）
            setTimeout(() => {
                showToast(`验证码：${verificationCode}（实际应用中会通过短信发送）`, 'success');
            }, 1000);
        }

        // 开始手机验证码倒计时
        function startPhoneCountdown() {
            let countdown = 60;
            const countdownElement = document.getElementById('phoneCountdown');
            const resendBtn = document.getElementById('resendCodeBtn');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    resendBtn.disabled = false;
                    resendBtn.textContent = '重新发送';
                    countdownElement.textContent = '0';
                }
            }, 1000);
        }

        // 重新发送手机验证码
        function resendPhoneCode() {
            const phone = document.getElementById('phoneNumber').value;
            
            // 生成新的验证码
            const verificationCode = Math.floor(100000 + Math.random() * 900000);
            localStorage.setItem('phone_verification_code', verificationCode.toString());
            
            // 重新开始倒计时
            startPhoneCountdown();
            
            // 显示新验证码
            showToast(`新验证码：${verificationCode}（实际应用中会通过短信发送）`, 'success');
        }

        // 返回手机号注册第一步
        function backToPhoneStep1() {
            document.getElementById('phoneStep2').style.display = 'none';
            document.getElementById('phoneStep1').style.display = 'block';
        }

        // 验证手机号并完成注册
        function verifyPhoneAndRegister() {
            const code = document.getElementById('phoneVerificationCode').value;
            const password = document.getElementById('phonePassword').value;
            const confirmPassword = document.getElementById('phoneConfirmPassword').value;
            const agreeTerms = document.getElementById('agreePhoneTerms').checked;
            
            // 验证验证码
            const storedCode = localStorage.getItem('phone_verification_code');
            if (code !== storedCode) {
                showToast('验证码错误，请重新输入', 'error');
                return;
            }
            
            // 验证密码
            if (password.length < 8) {
                showToast('密码长度至少8位', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('两次输入的密码不一致', 'error');
                return;
            }
            
            if (!agreeTerms) {
                showToast('请同意服务条款和隐私政策', 'error');
                return;
            }
            
            // 获取存储的信息
            const phone = localStorage.getItem('phone_number');
            const name = localStorage.getItem('phone_user_name');
            const email = phone + '@phone.com';
            
            // 创建用户账号
            const phoneUser = {
                    username: name,
                    email: email,
                    phone: phone,
                password: password,
                loginMethod: 'Phone',
                registerDate: new Date().toISOString()
            };
            
            // 保存用户信息
            currentUser = phoneUser;
            localStorage.setItem('mbti_user', JSON.stringify(phoneUser));
            
            // 清理临时数据
            localStorage.removeItem('phone_verification_code');
            localStorage.removeItem('phone_number');
            localStorage.removeItem('phone_user_name');
            
            // 显示成功消息
            showToast('手机号注册成功！', 'success');
            
            // 关闭弹窗并跳转
            closePhoneRegisterModal();
                closeGoogleModal();
                showMainContent();
                
            console.log('手机号注册成功:', phoneUser);
        }

        // 退出登录
        function logout() {
            currentUser = null;
            localStorage.removeItem('mbti_user');
            showGuestState();
        }

        // 显示忘记密码页面
        function showForgotPassword() {
            navigateToPage(PAGE_STATES.FORGOT_PASSWORD);
        }

        // 关闭登录覆盖层
        function closeLogin() {
            goBack();
        }

        // 关闭注册覆盖层
        function closeRegister() {
            goBack();
        }

        // 发送验证码
        function sendVerificationCode() {
            const email = document.getElementById('resetEmail').value;
            if (!email) {
                alert('请先输入邮箱地址');
                return;
            }
            
            if (!email.includes('@')) {
                alert('请输入有效的邮箱地址');
                return;
            }
            
            // 模拟发送验证码
            const sendBtn = document.querySelector('.send-code-btn');
            sendBtn.disabled = true;
            sendBtn.textContent = '发送中...';
            
            // 模拟网络延迟
            setTimeout(() => {
                // 生成6位随机验证码
                const code = Math.floor(100000 + Math.random() * 900000);
                
                // 显示成功消息
                showMessage('验证码已发送到 ' + email + '\n验证码：' + code, 'success');
                
                // 开始倒计时
                startCountdown(sendBtn);
                
                // 存储验证码（实际应用中应该通过后端发送）
                localStorage.setItem('reset_code', code.toString());
                localStorage.setItem('reset_email', email);
            }, 1500);
        }

        // 开始倒计时
        function startCountdown(button) {
            let countdown = 60;
            const timer = setInterval(() => {
                button.textContent = `重新发送(${countdown}s)`;
                countdown--;
                
                if (countdown < 0) {
                    clearInterval(timer);
                    button.disabled = false;
                    button.textContent = '发送验证码';
                }
            }, 1000);
        }

        // 显示消息
        function showMessage(message, type) {
            // 移除之前的消息
            const existingMessage = document.querySelector('.success-message, .error-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            const form = document.getElementById('forgotPasswordForm');
            form.insertBefore(messageDiv, form.firstChild);
            
            // 5秒后自动移除消息
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // 检测密码强度
        function checkPasswordStrength(password) {
            let strength = 0;
            const strengthBar = document.getElementById('passwordStrength');
            
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            strengthBar.className = 'password-strength';
            
            if (strength <= 1) {
                strengthBar.classList.add('weak');
            } else if (strength <= 2) {
                strengthBar.classList.add('fair');
            } else if (strength <= 3) {
                strengthBar.classList.add('good');
            } else {
                strengthBar.classList.add('strong');
            }
        }

        // 处理忘记密码表单提交
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        if (forgotPasswordForm) {
            forgotPasswordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('resetEmail').value;
                const code = document.getElementById('resetCode').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                
                // 验证邮箱
                if (!email || !email.includes('@')) {
                    showMessage('请输入有效的邮箱地址', 'error');
                    return;
                }
                
                // 验证验证码
                const storedCode = localStorage.getItem('reset_code');
                const storedEmail = localStorage.getItem('reset_email');
                
                if (!storedCode || !storedEmail || storedEmail !== email) {
                    showMessage('请先发送验证码', 'error');
                    return;
                }
                
                if (code !== storedCode) {
                    showMessage('验证码错误，请重新输入', 'error');
                    return;
                }
                
                // 验证密码
                if (newPassword.length < 8) {
                    showMessage('密码长度至少8位', 'error');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showMessage('两次输入的密码不一致', 'error');
                    return;
                }
                
                // 模拟密码重置成功
                showMessage('密码重置成功！正在跳转到登录页面...', 'success');
                
                // 清除存储的验证码
                localStorage.removeItem('reset_code');
                localStorage.removeItem('reset_email');
                
                // 3秒后跳转到登录页面
                setTimeout(() => {
                    showLogin();
                }, 3000);
            });
        }

        // 监听新密码输入，检测密码强度
        const newPasswordInput = document.getElementById('newPassword');
        if (newPasswordInput) {
            newPasswordInput.addEventListener('input', function(e) {
                checkPasswordStrength(e.target.value);
            });
        }

        function startTest() {
            navigateToPage(PAGE_STATES.TEST);
            initializeTest();
            showQuestion();
        }

        // 初始化测试
        function initializeTest() {
            currentQuestion = 0;
            answers = [];
            scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            dimensionProgress = { EI: 0, SN: 0, TF: 0, JP: 0 };
            testLevel = 1;
            
            // 生成智能问题序列
            questionSequence = generateQuestionSequence();
        }

        // 生成智能问题序列
        function generateQuestionSequence() {
            const sequence = [];
            
            // 第一层：基础偏好测试（必须完成）
            const level1Questions = questions.filter(q => q.level === 1);
            sequence.push(...level1Questions);
            
            // 第二层：具体行为测试
            const level2Questions = questions.filter(q => q.level === 2);
            sequence.push(...level2Questions);
            
            // 第三层：深度分析测试
            const level3Questions = questions.filter(q => q.level === 3);
            sequence.push(...level3Questions);
            
            // 第四层：交叉验证测试
            const level4Questions = questions.filter(q => q.level === 4);
            sequence.push(...level4Questions);
            
            // 第五层：综合验证测试
            const level5Questions = questions.filter(q => q.level === 5);
            sequence.push(...level5Questions);
            
            return sequence;
        }

        // 智能选择下一个问题
        function selectNextQuestion() {
            console.log('selectNextQuestion被调用');
            console.log('当前问题序列长度:', questionSequence.length);
            console.log('当前测试层级:', testLevel);
            console.log('各维度进度:', dimensionProgress);
            
            // 如果当前问题序列为空，重新生成
            if (questionSequence.length === 0) {
                console.log('问题序列为空，重新生成');
                questionSequence = generateQuestionSequence();
            }
            
            // 根据当前进度和用户回答模式选择最合适的问题
            const nextQuestion = findOptimalQuestion();
            
            if (nextQuestion) {
                console.log('找到最优问题:', nextQuestion);
                currentQuestion = nextQuestion.id - 1; // 转换为索引
                return nextQuestion;
            } else {
                console.log('没有找到合适的问题');
                return null;
            }
        }

        // 找到最优的下一个问题
        function findOptimalQuestion() {
            console.log('findOptimalQuestion被调用');
            console.log('当前测试层级:', testLevel);
            console.log('已回答问题数:', answers.length);
            
            // 优先选择当前层级的问题
            let availableQuestions = questionSequence.filter(q => 
                q.level === testLevel && 
                !answers.find(a => a.questionId === q.id)
            );
            
            console.log('当前层级可用问题数:', availableQuestions.length);
            
            // 如果没有当前层级的问题，检查前置条件
            if (availableQuestions.length === 0) {
                console.log('当前层级没有可用问题，检查前置条件');
                availableQuestions = questionSequence.filter(q => 
                    !answers.find(a => a.questionId === q.id) &&
                    checkQuestionRequirements(q)
                );
                console.log('满足前置条件的问题数:', availableQuestions.length);
            }
            
            // 如果还是没有，选择任何未回答的问题
            if (availableQuestions.length === 0) {
                console.log('没有满足前置条件的问题，选择任何未回答的问题');
                availableQuestions = questionSequence.filter(q => 
                    !answers.find(a => a.questionId === q.id)
                );
                console.log('未回答的问题数:', availableQuestions.length);
            }
            
            // 根据维度进度和权重选择最优问题
            if (availableQuestions.length > 0) {
                console.log('找到可用问题，按优先级选择');
                return selectQuestionByPriority(availableQuestions);
            }
            
            console.log('没有找到任何可用问题');
            return null;
        }

        // 检查问题前置条件
        function checkQuestionRequirements(question) {
            if (!question.requires) return true;
            
            const requirements = Array.isArray(question.requires) ? question.requires : [question.requires];
            
            for (const req of requirements) {
                if (req === 'EI' && dimensionProgress.EI < 2) return false;
                if (req === 'SN' && dimensionProgress.SN < 2) return false;
                if (req === 'TF' && dimensionProgress.TF < 2) return false;
                if (req === 'JP' && dimensionProgress.JP < 2) return false;
            }
            
            return true;
        }

        // 根据优先级选择问题
        function selectQuestionByPriority(availableQuestions) {
            // 计算每个问题的优先级分数
            const questionScores = availableQuestions.map(q => {
                let score = q.weight;
                
                // 根据维度进度调整分数
                const dimension = q.dimension;
                if (dimension === 'EI') score += dimensionProgress.EI * 0.1;
                if (dimension === 'SN') score += dimensionProgress.SN * 0.1;
                if (dimension === 'TF') score += dimensionProgress.TF * 0.1;
                if (dimension === 'JP') score += dimensionProgress.JP * 0.1;
                
                return { question: q, score: score };
            });
            
            // 按分数排序，选择最高分的问题
            questionScores.sort((a, b) => b.score - a.score);
            return questionScores[0].question;
        }

        function showQuestion() {
            console.log('showQuestion被调用');
            console.log('当前已回答问题数:', answers.length);
            console.log('总问题数:', questions.length);
            
            // 智能选择下一个问题
            const nextQuestion = selectNextQuestion();
            
            if (!nextQuestion) {
                console.log('没有找到下一个问题，显示结果');
                // 所有问题都完成了
                showResults();
                return;
            }
            
            console.log('找到下一个问题:', nextQuestion);
            const question = nextQuestion;
            currentQuestion = question.id - 1;
            
            // 显示问题信息（包含图片和交叉测试提示）
            const questionTextElement = document.getElementById('questionText');
            if (questionTextElement) {
                console.log('开始构建问题显示...');
                console.log('问题对象:', question);
                
                // 清空之前的内容
                questionTextElement.innerHTML = '';
                
                // 添加问题图片
                const questionImage = getQuestionImage(question);
                console.log('问题图片HTML:', questionImage);
                if (questionImage) {
                    const imageDiv = document.createElement('div');
                    imageDiv.innerHTML = questionImage;
                    questionTextElement.appendChild(imageDiv);
                    console.log('图片已添加');
                }
                
                // 添加问题文本
                const questionTextDiv = document.createElement('div');
                questionTextDiv.className = 'question-text';
                questionTextDiv.textContent = question.question;
                questionTextElement.appendChild(questionTextDiv);
                console.log('问题文本已添加');
                
                // 添加交叉测试提示
                const crossTestHint = getCrossTestHint(question);
                console.log('交叉测试提示HTML:', crossTestHint);
                if (crossTestHint) {
                    const crossTestDiv = document.createElement('div');
                    crossTestDiv.innerHTML = crossTestHint;
                    questionTextElement.appendChild(crossTestDiv);
                    console.log('交叉测试提示已添加');
                }
                
                // 添加场景描述
                if (question.scenario) {
                    const scenarioDiv = document.createElement('div');
                    scenarioDiv.className = 'question-scenario';
                    scenarioDiv.innerHTML = `<span class="scenario-icon">🎭</span> ${question.scenario}`;
                    questionTextElement.appendChild(scenarioDiv);
                }
            } else {
                console.error('问题文本元素未找到');
            }
            
            // 显示问题层级和类别信息
            updateQuestionInfo(question);
            
            const optionsContainer = document.getElementById('optionsContainer');
            if (optionsContainer) {
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                    button.onclick = () => selectOption(index, question);
                optionsContainer.appendChild(button);
            });
            } else {
                console.error('选项容器未找到');
            }
            
            // 更新测试阶段显示
            updateTestStage();
            
            updateProgress();
            updateNavigationButtons();
            
            console.log('问题显示完成');
        }

        // 更新问题信息显示
        function updateQuestionInfo(question) {
            const stageBadge = document.getElementById('currentStageBadge');
            if (stageBadge) {
                const levelNames = {
                    1: "🌱 基础偏好探索",
                    2: "🔍 具体行为分析", 
                    3: "🎯 深度思维测试",
                    4: "🔄 交叉验证确认",
                    5: "✨ 综合能力评估"
                };
                
                const levelName = levelNames[question.level] || "测试进行中";
                const categoryName = getCategoryName(question.category);
                
                stageBadge.textContent = `${levelName} - ${categoryName}`;
            }
        }

        // 获取类别名称
        function getCategoryName(category) {
            const categoryNames = {
                'social_energy': '社交能量',
                'information_processing': '信息处理',
                'decision_making': '决策方式',
                'lifestyle_preference': '生活方式',
                'team_communication': '团队沟通',
                'learning_style': '学习方式',
                'emotional_support': '情感支持',
                'work_organization': '工作组织',
                'innovation_approach': '创新方式',
                'stress_response': '压力应对',
                'conflict_resolution': '冲突处理',
                'change_adaptation': '变化适应',
                'leadership_style': '领导风格',
                'problem_solving': '问题解决',
                'personal_growth': '个人发展',
                'project_management': '项目管理',
                'ideal_workplace': '理想工作环境',
                'relationship_values': '关系价值观',
                'life_philosophy': '生活哲学'
            };
            
            return categoryNames[category] || '性格测试';
        }

        // 获取问题图片
        function getQuestionImage(question) {
            if (question.image) {
                if (question.visualType === 'emoji') {
                    return `<div class="question-emoji">${question.image}</div>`;
                } else if (question.visualType === 'image') {
                    return `<img src="${question.image}" alt="问题插图" class="question-image">`;
                } else if (question.visualType === 'icon') {
                    return `<div class="question-icon">${question.image}</div>`;
                }
            }
            return '';
        }

        // 获取交叉测试提示
        function getCrossTestHint(question) {
            if (question.crossTest && question.crossTest.length > 1) {
                const dimensions = question.crossTest.map(d => {
                    const names = { 'EI': '内外向', 'SN': '感觉直觉', 'TF': '思考情感', 'JP': '判断感知' };
                    return names[d] || d;
                });
                
                // 获取交叉测试的详细说明
                const crossTestExplanation = getCrossTestExplanation(question.crossTest);
                
                return `
                    <div class="cross-test-hint">
                        🔄 交叉测试：${dimensions.join(' + ')}
                        <div class="cross-test-detail">${crossTestExplanation}</div>
                    </div>
                `;
            }
            return '';
        }

        // 获取交叉测试详细说明
        function getCrossTestExplanation(crossTest) {
            const explanations = {
                'EI+SN': '这个问题同时测试你的社交偏好和信息处理方式，帮助更准确地判断你的性格类型',
                'SN+TF': '结合你的信息接收方式和决策偏好，深入了解你的思维模式',
                'TF+JP': '测试你的价值观和生活方式的一致性，揭示你的核心特质',
                'JP+EI': '了解你的计划性和社交需求的平衡，展现你的生活态度',
                'SN+JP': '探索你的信息处理偏好如何影响你的生活方式选择',
                'EI+TF': '测试你的社交能量来源和决策方式的关联性'
            };
            
            const key = crossTest.join('+');
            return explanations[key] || '这个问题从多个维度测试你的性格特征，提高测试准确性';
        }

        function selectOption(optionIndex, question) {
            // 移除之前的选择
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                btn.classList.remove('selected');
                btn.classList.remove('selecting');
            });
            
            // 选择当前选项并添加选择动画
            const selectedButton = buttons[optionIndex];
            selectedButton.classList.add('selected', 'selecting');
            
            // 记录答案（包含问题ID和层级信息）
            const answer = {
                questionId: question.id,
                optionIndex: optionIndex,
                dimension: question.dimension,
                level: question.level,
                category: question.category,
                weight: question.weight
            };
            
            answers.push(answer);
            
            // 计算加权分数
            const isFirstOption = optionIndex === 0;
            const scoreIncrement = question.weight;
            
            if (question.dimension === 'EI') {
                scores[isFirstOption ? 'E' : 'I'] += scoreIncrement;
                dimensionProgress.EI++;
            } else if (question.dimension === 'SN') {
                scores[isFirstOption ? 'S' : 'N'] += scoreIncrement;
                dimensionProgress.SN++;
            } else if (question.dimension === 'TF') {
                scores[isFirstOption ? 'T' : 'F'] += scoreIncrement;
                dimensionProgress.TF++;
            } else if (question.dimension === 'JP') {
                scores[isFirstOption ? 'J' : 'P'] += scoreIncrement;
                dimensionProgress.JP++;
            }
            
            // 显示选择确认提示
            showSelectionFeedback(selectedButton);
            
            // 显示问题解释（可选）
            if (question.explanation) {
                showQuestionExplanation(question.explanation);
            }
            
            // 检查是否需要显示广告
            setTimeout(() => {
                if (shouldShowAd()) {
                    // 显示广告页面
                    navigateToPage(PAGE_STATES.AD);
                } else {
                    // 继续下一题
                    nextQuestion();
                }
            }, 1200); // 增加延迟，让用户看到解释
        }

        // 显示问题解释
        function showQuestionExplanation(explanation) {
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'question-explanation';
            explanationDiv.innerHTML = `
                <div class="explanation-content">
                    <span class="explanation-icon">💡</span>
                    <span class="explanation-text">${explanation}</span>
                </div>
            `;
            
            // 添加到问题下方
            const questionContainer = document.querySelector('.question-container');
            questionContainer.appendChild(explanationDiv);
            
            // 3秒后自动移除
            setTimeout(() => {
                if (explanationDiv.parentNode) {
                    explanationDiv.remove();
                }
            }, 3000);
        }

        // 显示选择确认反馈
        function showSelectionFeedback(button) {
            // 创建选择确认提示
            const feedback = document.createElement('div');
            feedback.className = 'selection-feedback';
            feedback.textContent = '✓ 已选择';
            feedback.style.cssText = `
                position: absolute;
                background: #10b981;
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 0.9rem;
                font-weight: 600;
                z-index: 10;
                animation: feedbackFade 0.8s ease-in-out;
                pointer-events: none;
            `;
            
            // 添加到按钮上
            button.style.position = 'relative';
            button.appendChild(feedback);
            
            // 动画结束后移除提示
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.remove();
                }
            }, 800);
        }

        function nextQuestion() {
            // 智能选择下一个问题
                showQuestion();
        }

        function previousQuestion() {
            if (answers.length > 0) {
                // 移除最后一个答案
                const lastAnswer = answers.pop();
                
                // 恢复分数
                const dimension = lastAnswer.dimension;
                const isFirstOption = lastAnswer.optionIndex === 0;
                const scoreDecrement = lastAnswer.weight;
                
                if (dimension === 'EI') {
                    scores[isFirstOption ? 'E' : 'I'] -= scoreDecrement;
                    dimensionProgress.EI--;
                } else if (dimension === 'SN') {
                    scores[isFirstOption ? 'S' : 'N'] -= scoreDecrement;
                    dimensionProgress.SN--;
                } else if (dimension === 'TF') {
                    scores[isFirstOption ? 'T' : 'F'] -= scoreDecrement;
                    dimensionProgress.TF--;
                } else if (dimension === 'JP') {
                    scores[isFirstOption ? 'J' : 'P'] -= scoreDecrement;
                    dimensionProgress.JP--;
                }
                
                // 重新显示上一题
                showQuestion();
            }
        }

        function updateProgress() {
            // 计算总体进度
            const totalQuestions = questions.length;
            const answeredQuestions = answers.length;
            const progress = (answeredQuestions / totalQuestions) * 100;
            
            document.getElementById('progressFill').style.width = progress + '%';
            
            // 更新各维度进度
            updateDimensionProgress();
        }

        // 更新各维度进度
        function updateDimensionProgress() {
            const progressInfo = document.querySelector('.test-progress-info');
            if (progressInfo) {
                const progressText = `
                    <div class="dimension-progress">
                        <div class="progress-item">
                            <span class="progress-label">EI进度:</span>
                            <span class="progress-value">${dimensionProgress.EI}/5</span>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">SN进度:</span>
                            <span class="progress-value">${dimensionProgress.SN}/5</span>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">TF进度:</span>
                            <span class="progress-value">${dimensionProgress.TF}/5</span>
                        </div>
                        <div class="progress-item">
                            <span class="progress-label">JP进度:</span>
                            <span class="progress-value">${dimensionProgress.JP}/5</span>
                        </div>
                    </div>
                    
                    <!-- 交叉测试关系图 -->
                    <div class="cross-test-relationship">
                        <div class="relationship-title">🔄 交叉测试关系</div>
                        <div class="relationship-grid">
                            <div class="relationship-item ${dimensionProgress.EI >= 2 && dimensionProgress.SN >= 2 ? 'active' : ''}">
                                <span class="dimension-pair">EI + SN</span>
                                <span class="status">${dimensionProgress.EI >= 2 && dimensionProgress.SN >= 2 ? '✅' : '⏳'}</span>
                            </div>
                            <div class="relationship-item ${dimensionProgress.SN >= 2 && dimensionProgress.TF >= 2 ? 'active' : ''}">
                                <span class="dimension-pair">SN + TF</span>
                                <span class="status">${dimensionProgress.SN >= 2 && dimensionProgress.TF >= 2 ? '✅' : '⏳'}</span>
                            </div>
                            <div class="relationship-item ${dimensionProgress.TF >= 2 && dimensionProgress.JP >= 2 ? 'active' : ''}">
                                <span class="dimension-pair">TF + JP</span>
                                <span class="status">${dimensionProgress.TF >= 2 && dimensionProgress.JP >= 2 ? '✅' : '⏳'}</span>
                            </div>
                            <div class="relationship-item ${dimensionProgress.JP >= 2 && dimensionProgress.EI >= 2 ? 'active' : ''}">
                                <span class="dimension-pair">JP + EI</span>
                                <span class="status">${dimensionProgress.JP >= 2 && dimensionProgress.EI >= 2 ? '✅' : '⏳'}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                progressInfo.innerHTML = progressText;
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = currentQuestion > 0 ? 'block' : 'none';
            nextBtn.disabled = true;
            
            // 恢复之前的选择
            if (answers[currentQuestion] !== undefined) {
                const buttons = document.querySelectorAll('.option-btn');
                buttons[answers[currentQuestion]].classList.add('selected');
                nextBtn.disabled = false;
            }
        }

        function showResults() {
            navigateToPage(PAGE_STATES.RESULT);
            
            // 计算性格类型
            const type = (scores.E > scores.I ? 'E' : 'I') +
                        (scores.S > scores.N ? 'S' : 'N') +
                        (scores.T > scores.F ? 'T' : 'F') +
                        (scores.J > scores.P ? 'J' : 'P');
            
            document.getElementById('personalityType').textContent = type;
            
            // 显示维度分析
            showDimensions();
            
            // 显示类型描述
            document.getElementById('typeDescription').innerHTML = `
                <p><strong>${type}</strong> - ${typeDescriptions[type] || '这是一个独特的性格类型组合。'}</p>
                <p>基于你的回答，我们分析了你在四个维度上的偏好：</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>外向(E) vs 内向(I)</strong>：你倾向于${scores.E > scores.I ? '外向' : '内向'}，得分为 ${scores.E.toFixed(1)}:${scores.I.toFixed(1)}</li>
                    <li><strong>感觉(S) vs 直觉(N)</strong>：你倾向于${scores.S > scores.N ? '感觉' : '直觉'}，得分为 ${scores.S.toFixed(1)}:${scores.N.toFixed(1)}</li>
                    <li><strong>思考(T) vs 情感(F)</strong>：你倾向于${scores.T > scores.F ? '思考' : '情感'}，得分为 ${scores.T.toFixed(1)}:${scores.F.toFixed(1)}</li>
                    <li><strong>判断(J) vs 感知(P)</strong>：你倾向于${scores.J > scores.P ? '判断' : '感知'}，得分为 ${scores.J.toFixed(1)}:${scores.P.toFixed(1)}</li>
                </ul>
                <p><strong>测试完成度：</strong>你完成了 ${answers.length} 道题目，涵盖了 ${Object.values(dimensionProgress).filter(p => p > 0).length} 个维度的深度测试。</p>
                <p><strong>测试层级：</strong>最高达到第 ${Math.max(...answers.map(a => a.level))} 层级，测试深度：${getTestDepthDescription(Math.max(...answers.map(a => a.level)))}</p>
            `;
        }

        // 获取测试深度描述
        function getTestDepthDescription(level) {
            const depthDescriptions = {
                1: "基础偏好探索",
                2: "具体行为分析",
                3: "深度思维测试", 
                4: "交叉验证确认",
                5: "综合能力评估"
            };
            
            return depthDescriptions[level] || "未知层级";
        }

        function showDimensions() {
            const container = document.getElementById('dimensionsContainer');
            container.innerHTML = '';
            
            const dimensions = [
                { name: '外向 (E)', score: scores.E, total: scores.E + scores.I, color: '#667eea' },
                { name: '内向 (I)', score: scores.I, total: scores.E + scores.I, color: '#764ba2' },
                { name: '感觉 (S)', score: scores.S, total: scores.S + scores.N, color: '#f093fb' },
                { name: '直觉 (N)', score: scores.N, total: scores.S + scores.N, color: '#f5576c' },
                { name: '思考 (T)', score: scores.T, total: scores.T + scores.F, color: '#4facfe' },
                { name: '情感 (F)', score: scores.F, total: scores.T + scores.F, color: '#00f2fe' },
                { name: '判断 (J)', score: scores.J, total: scores.J + scores.P, color: '#43e97b' },
                { name: '感知 (P)', score: scores.P, total: scores.J + scores.P, color: '#38f9d7' }
            ];
            
            dimensions.forEach(dim => {
                const percentage = dim.total > 0 ? (dim.score / dim.total) * 100 : 50;
                
                const div = document.createElement('div');
                div.className = 'dimension';
                div.innerHTML = `
                    <h4>${dim.name}</h4>
                    <div class="dimension-bar">
                        <div class="dimension-fill" style="width: ${percentage}%; background: ${dim.color}"></div>
                    </div>
                    <p>${dim.score} / ${dim.total} (${Math.round(percentage)}%)</p>
                `;
                container.appendChild(div);
            });
        }

        function restartTest() {
            currentQuestion = 0;
            answers = [];
            scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            
            navigateToPage(PAGE_STATES.HOME);
        }

        function showMBTIWelcome() {
            console.log('跳转到专业MBTI测试页面');
            // 直接跳转到MBTI测试页面
            window.location.href = 'mbti-quick-test.html';
        }



        function showFeaturesSection() {
            console.log('显示功能卡片区域');
            
            // 隐藏所有页面
            hideAllPages();
            
            // 显示功能卡片区域
            const featuresSection = document.getElementById('featuresSection');
            if (featuresSection) {
                featuresSection.style.display = 'block';
                console.log('功能卡片区域已显示');
            }
            
            // 确保功能卡片区域可见
            console.log('功能卡片区域状态:', {
                element: featuresSection,
                display: featuresSection ? featuresSection.style.display : 'N/A',
                classes: featuresSection ? featuresSection.className : 'N/A'
            });
        }

        function showMBTIInfo() {
            navigateToPage(PAGE_STATES.MBTI_INFO);
        }

        function hideMBTIInfo() {
            navigateToPage(PAGE_STATES.HOME);
        }

        // 关闭忘记密码页面
        function closeForgotPassword() {
            console.log('关闭忘记密码页面');
            
            try {
                // 重置忘记密码步骤
                resetForgotPasswordSteps();
                
                // 返回上一页（通常是登录页面）
                goBack();
                
                console.log('忘记密码页面已关闭');
            } catch (error) {
                console.error('关闭忘记密码页面时出错:', error);
                // 如果出错，直接返回首页
                navigateToPage(PAGE_STATES.HOME, false);
            }
        }

        // 调试函数：显示当前页面状态
        function showDebugInfo() {
            console.log('=== 页面状态调试信息 ===');
            console.log('当前页面:', currentPage);
            console.log('页面历史:', pageHistory);
            console.log('当前用户:', currentUser);
            
            // 检查所有页面元素的显示状态
            const pages = [
                { id: 'featuresSection', name: '功能卡片区域' },
                { id: 'testSection', name: '测试页' },
                { id: 'resultSection', name: '结果页' },
                { id: 'loginSection', name: '登录页' },
                { id: 'registerSection', name: '注册页' },
                { id: 'forgotPasswordSection', name: '忘记密码页' },
                { id: 'mbtiInfoSection', name: 'MBTI信息页' }
            ];
            
            pages.forEach(page => {
                const element = document.getElementById(page.id);
                if (element) {
                    const isHidden = element.classList.contains('hidden');
                    const displayStyle = element.style.display;
                    console.log(`${page.name} (${page.id}): hidden=${isHidden}, display=${displayStyle}`);
                } else {
                    console.log(`${page.name} (${page.id}): 元素不存在`);
                }
            });
            
            console.log('=== 调试信息结束 ===');
        }

        // 强制重置到首页（调试用）
        function forceGoHome() {
            console.log('强制返回首页');
            pageHistory = [];
            navigateToPage(PAGE_STATES.HOME, false);
        }

        // 判断是否应该显示广告
        function shouldShowAd() {
            // 在第3题、第6题、第9题后显示广告
            const adPositions = [3, 6, 9];
            return adPositions.includes(currentQuestion + 1); // +1 因为currentQuestion从0开始
        }

        // 观看广告
        function watchAd() {
            const watchBtn = document.getElementById('watchAdBtn');
            const progressFill = document.getElementById('adProgressFill');
            const countdown = document.getElementById('adCountdown');
            
            // 更新进度信息
            updateAdProgressInfo();
            
            // 禁用按钮
            watchBtn.disabled = true;
            watchBtn.textContent = '观看中...';
            
            // 立即显示备用广告（因为AdSense还没配置）
            showFallbackAd();
            
            let timeLeft = 15;
            const totalTime = 15;
            
            // 开始倒计时
            const timer = setInterval(() => {
                timeLeft--;
                const progress = ((totalTime - timeLeft) / totalTime) * 100;
                
                // 更新进度条
                progressFill.style.width = progress + '%';
                
                // 更新倒计时
                countdown.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    // 广告观看完成，继续测试
                    continueTest();
                }
            }, 1000);
        }

        // 加载Google AdSense广告
        function loadGoogleAd() {
            try {
                console.log('开始加载广告...');
                
                // 检查配置和AdSense是否可用
                if (window.googleAdConfig && window.googleAdConfig.enabled && 
                    typeof adsbygoogle !== 'undefined') {
                    // 有AdSense配置且启用，尝试加载真实广告
                    console.log('尝试加载Google AdSense广告...');
                    loadRealAdSense();
                } else {
                    // 没有配置或未启用，直接显示备用广告
                    console.log('Google AdSense未配置或未启用，显示备用广告');
                showFallbackAd();
                }
            } catch (error) {
                console.error('广告加载失败:', error);
                showFallbackAd();
            }
        }

        // 加载真实的Google AdSense广告
        function loadRealAdSense() {
            try {
                console.log('开始加载AdSense广告...');
                
                const adContainer = document.getElementById('google-adsense-container');
                if (!adContainer) {
                    console.error('广告容器未找到');
                    showFallbackAd();
                    return;
                }

                // 隐藏加载状态
                const loadingElement = document.querySelector('.ad-loading');
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
                
                // 根据当前页面选择广告单元
                let adUnitId = 'test-page-ad';
                if (currentPage === PAGE_STATES.RESULT) {
                    adUnitId = 'result-page-ad';
                }

                const adUnit = document.getElementById(adUnitId);
                if (adUnit) {
                    adUnit.style.display = 'block';
                    
                    // 执行AdSense代码
                    if (typeof adsbygoogle !== 'undefined') {
                        console.log('AdSense可用，开始加载广告...');
                        
                        // 为广告单元添加加载事件
                        const adIns = adUnit.querySelector('.adsbygoogle');
                        if (adIns) {
                            // 设置加载超时
                            setTimeout(() => {
                                checkAdLoaded(adUnit);
                            }, 3000); // 3秒超时
                            
                            // 手动触发AdSense
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    
                    trackAdImpression();
                        }
                } else {
                        throw new Error('AdSense代码不可用');
                }
                } else {
                    throw new Error('广告单元未找到');
                }
            } catch (error) {
                console.error('AdSense广告加载失败:', error);
                showFallbackAd();
            }
        }

        // 检查广告是否成功加载
        function checkAdLoaded(adUnit) {
            const adIns = adUnit.querySelector('.adsbygoogle');
            if (adIns) {
                // 检查广告是否有内容
                const hasContent = adIns.innerHTML.trim().length > 0;
                const hasIframe = adIns.querySelector('iframe');
                
                if (!hasContent && !hasIframe) {
                    console.log('AdSense广告加载超时，显示备用广告');
                    showFallbackAd();
                } else {
                    console.log('AdSense广告加载成功');
                }
            }
        }

        // 显示备用广告
        function showFallbackAd() {
            const fallbackAd = document.getElementById('fallback-ad');
            const googleAdContainer = document.getElementById('google-adsense-container');
            
            if (fallbackAd && googleAdContainer) {
                // 隐藏Google AdSense容器和加载状态
                googleAdContainer.style.display = 'none';
                
                // 显示备用广告
                fallbackAd.style.display = 'flex';
                
                // 添加动画效果
                fallbackAd.style.animation = 'adSlideIn 0.5s ease';
                
                // 自动开始倒计时
                startFallbackAdCountdown();
                
                console.log('备用广告已显示');
            }
        }

        // 开始备用广告倒计时
        function startFallbackAdCountdown() {
            let countdown = 15;
            const countdownElement = document.getElementById('adCountdown');
            const progressFill = document.getElementById('adProgressFill');
            
            if (!countdownElement || !progressFill) return;
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                // 更新进度条
                const progress = ((15 - countdown) / 15) * 100;
                progressFill.style.width = progress + '%';
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    // 广告观看完成
                    continueTest();
                }
            }, 1000);
        }

        // 跟踪广告展示
        function trackAdImpression() {
            // 这里可以添加Google Analytics或其他统计代码
            console.log('广告展示成功');
            
            // 发送广告展示事件到服务器（可选）
            if (typeof gtag !== 'undefined') {
                gtag('event', 'ad_impression', {
                    'event_category': 'advertising',
                    'event_label': 'mbti_test_ad'
                });
            }
        }

        // 更新广告页面的进度信息
        function updateAdProgressInfo() {
            const currentQuestionNumber = document.getElementById('currentQuestionNumber');
            const testProgressFill = document.getElementById('testProgressFill');
            const testStageText = document.getElementById('testStageText');
            
            if (currentQuestionNumber) {
                currentQuestionNumber.textContent = currentQuestion + 1;
            }
            
            if (testProgressFill) {
                const progress = ((currentQuestion + 1) / questions.length) * 100;
                testProgressFill.style.width = progress + '%';
            }
            
            if (testStageText) {
                const stage = getTestStage(currentQuestion);
                testStageText.textContent = stage;
            }
        }

        // 初始化广告页面
        function initAdPage() {
            // 确保备用广告准备好
            const fallbackAd = document.getElementById('fallback-ad');
            const googleAdContainer = document.getElementById('google-adsense-container');
            
            if (fallbackAd && googleAdContainer) {
                // 默认隐藏备用广告，等待用户点击观看
                fallbackAd.style.display = 'none';
                googleAdContainer.style.display = 'flex';
            }

            // 初始化配置面板
            initAdConfigPanel();
        }

        // 初始化广告配置面板
        function initAdConfigPanel() {
            const enabledSelect = document.getElementById('adSenseEnabled');
            const clientIdInput = document.getElementById('adClientId');
            const slotIdInput = document.getElementById('adSlotId');

            if (enabledSelect && clientIdInput && slotIdInput) {
                // 设置当前配置值
                enabledSelect.value = window.googleAdConfig.enabled.toString();
                clientIdInput.value = window.googleAdConfig.clientId;
                slotIdInput.value = window.googleAdConfig.slotId;
            }
            
            // 检查AdSense状态
            checkAdSenseStatus();
        }

        // 检查AdSense状态
        function checkAdSenseStatus() {
            // 检查脚本加载状态
            const scriptStatus = document.getElementById('scriptStatus');
            if (scriptStatus) {
                if (typeof adsbygoogle !== 'undefined') {
                    scriptStatus.textContent = '✅ 已加载';
                    scriptStatus.style.color = '#28a745';
                } else {
                    scriptStatus.textContent = '❌ 未加载';
                    scriptStatus.style.color = '#dc3545';
                }
            }
            
            // 检查发布商ID
            const publisherStatus = document.getElementById('publisherStatus');
            if (publisherStatus) {
                if (window.googleAdConfig.clientId && 
                    window.googleAdConfig.clientId !== 'ca-pub-1234567890123456') {
                    publisherStatus.textContent = '✅ 已配置';
                    publisherStatus.style.color = '#28a745';
                } else {
                    publisherStatus.textContent = '❌ 未配置';
                    publisherStatus.style.color = '#dc3545';
                }
            }
            
            // 检查广告位ID
            const slotStatus = document.getElementById('slotStatus');
            if (slotStatus) {
                if (window.googleAdConfig.slotId && 
                    window.googleAdConfig.slotId !== '1234567890') {
                    slotStatus.textContent = '✅ 已配置';
                    slotStatus.style.color = '#28a745';
                } else {
                    slotStatus.textContent = '❌ 需要配置';
                    slotStatus.style.color = '#ffc107';
                }
            }
            
            // 检查连接状态
            const connectionStatus = document.getElementById('connectionStatus');
            if (connectionStatus) {
                connectionStatus.textContent = '🔄 点击测试按钮检查';
                connectionStatus.style.color = '#17a2b8';
            }
        }

        // 切换广告配置面板
        function toggleAdConfig() {
            const configPanel = document.getElementById('adConfigPanel');
            if (configPanel) {
                configPanel.style.display = configPanel.style.display === 'none' ? 'block' : 'none';
            }
        }

        // 更新广告配置
        function updateAdConfig() {
            const enabledSelect = document.getElementById('adSenseEnabled');
            const clientIdInput = document.getElementById('adClientId');
            const slotIdInput = document.getElementById('adSlotId');

            if (enabledSelect && clientIdInput && slotIdInput) {
                window.googleAdConfig.enabled = enabledSelect.value === 'true';
                window.googleAdConfig.clientId = clientIdInput.value;
                window.googleAdConfig.slotId = slotIdInput.value;

                // 保存到localStorage
                localStorage.setItem('googleAdConfig', JSON.stringify(window.googleAdConfig));

                console.log('广告配置已更新:', window.googleAdConfig);
                
                // 显示提示
                showToast('广告配置已更新，刷新页面后生效', 'success');
            }
        }

        // 测试AdSense广告
        function testAdSense() {
            console.log('开始测试AdSense广告...');
            
            // 重置广告容器
            const adContainer = document.getElementById('google-adsense-container');
            if (adContainer) {
                // 隐藏所有广告单元
                const adUnits = adContainer.querySelectorAll('.adsense-ad-unit');
                adUnits.forEach(unit => unit.style.display = 'none');
                
                // 显示加载状态
                const loadingElement = document.querySelector('.ad-loading');
                if (loadingElement) {
                    loadingElement.style.display = 'flex';
                }
                
                // 延迟加载广告
                setTimeout(() => {
                    if (window.googleAdConfig.enabled) {
                        loadRealAdSense();
                    } else {
                        showFallbackAd();
                    }
                }, 1000);
            }
            
            showToast('AdSense测试已开始，请查看控制台日志', 'info');
        }

        // 调试测试功能
        function debugTest() {
            console.log('=== 测试调试信息 ===');
            console.log('当前页面状态:', currentPage);
            console.log('当前问题索引:', currentQuestion);
            console.log('已回答问题数:', answers.length);
            console.log('总问题数:', questions.length);
            console.log('问题序列长度:', questionSequence.length);
            console.log('各维度进度:', dimensionProgress);
            console.log('测试层级:', testLevel);
            
            // 检查页面元素
            const questionText = document.getElementById('questionText');
            const optionsContainer = document.getElementById('optionsContainer');
            const progressFill = document.getElementById('progressFill');
            
            console.log('问题文本元素:', questionText);
            console.log('选项容器元素:', optionsContainer);
            console.log('进度条元素:', progressFill);
            
            // 尝试手动显示问题
            if (answers.length < questions.length) {
                console.log('尝试手动显示下一个问题...');
                showQuestion();
            } else {
                console.log('所有问题已完成，显示结果...');
                showResults();
            }
            
            showToast('调试信息已输出到控制台', 'info');
        }

        // 测试问题显示功能
        function testQuestionDisplay() {
            console.log('=== 测试问题显示功能 ===');
            
            // 检查第一个问题
            const firstQuestion = questions[0];
            console.log('第一个问题:', firstQuestion);
            
            // 测试图片生成
            const questionImage = getQuestionImage(firstQuestion);
            console.log('生成的图片HTML:', questionImage);
            
            // 测试交叉测试提示
            const crossTestHint = getCrossTestHint(firstQuestion);
            console.log('生成的交叉测试提示:', crossTestHint);
            
            // 测试场景描述
            console.log('场景描述:', firstQuestion.scenario);
            
            // 手动构建问题显示
            const questionTextElement = document.getElementById('questionText');
            if (questionTextElement) {
                questionTextElement.innerHTML = '';
                
                // 添加图片
                if (questionImage) {
                    const imageDiv = document.createElement('div');
                    imageDiv.innerHTML = questionImage;
                    questionTextElement.appendChild(imageDiv);
                    console.log('图片已手动添加');
                }
                
                // 添加问题文本
                const questionTextDiv = document.createElement('div');
                questionTextDiv.className = 'question-text';
                questionTextDiv.textContent = firstQuestion.question;
                questionTextElement.appendChild(questionTextDiv);
                console.log('问题文本已手动添加');
                
                // 添加交叉测试提示
                if (crossTestHint) {
                    const crossTestDiv = document.createElement('div');
                    crossTestDiv.innerHTML = crossTestHint;
                    questionTextElement.appendChild(crossTestDiv);
                    console.log('交叉测试提示已手动添加');
                }
                
                // 添加场景描述
                if (firstQuestion.scenario) {
                    const scenarioDiv = document.createElement('div');
                    scenarioDiv.className = 'question-scenario';
                    scenarioDiv.innerHTML = `<span class="scenario-icon">🎭</span> ${firstQuestion.scenario}`;
                    questionTextElement.appendChild(scenarioDiv);
                    console.log('场景描述已手动添加');
                }
                
                showToast('问题显示测试完成，请查看页面和控制台', 'success');
            } else {
                console.error('问题文本元素未找到');
                showToast('问题文本元素未找到', 'error');
            }
        }

        // 获取测试阶段描述
        function getTestStage(questionIndex) {
            if (questionIndex < 3) {
                return '🌱 性格基础探索';
            } else if (questionIndex < 6) {
                return '🔍 深度性格分析';
            } else if (questionIndex < 9) {
                return '🎯 精准性格定位';
            } else {
                return '✨ 最终性格确认';
            }
        }

        // 更新测试阶段显示
        function updateTestStage() {
            const stageBadge = document.getElementById('currentStageBadge');
            if (stageBadge) {
                const stage = getTestStage(currentQuestion);
                stageBadge.textContent = stage;
            }
        }

        // 跳过广告
        function skipAd() {
            if (confirm('确定要跳过广告吗？跳过后将无法查看详细结果。')) {
                // 跳过广告，继续测试
                continueTest();
            }
        }

        // 继续测试
        function continueTest() {
            console.log('广告观看完成，继续测试...');
            console.log('当前问题索引:', currentQuestion);
            console.log('已回答问题数:', answers.length);
            console.log('总问题数:', questions.length);
            
            // 确保回到测试页面
            if (currentPage !== PAGE_STATES.TEST) {
                console.log('当前不在测试页面，导航到测试页面');
                navigateToPage(PAGE_STATES.TEST);
            }
            
            // 检查是否还有未回答的问题
            if (answers.length < questions.length) {
                console.log('还有未回答的问题，继续下一题');
                
                // 延迟一下确保页面切换完成
                setTimeout(() => {
                    // 强制刷新问题显示
                    console.log('强制刷新问题显示');
                    showQuestion();
                }, 500);
            } else {
                console.log('所有问题已回答，显示结果');
                // 测试完成，显示结果
                showResults();
            }
        }

        // 发送重置邮件
        function sendResetEmail() {
            const email = document.getElementById('resetEmail').value;
            if (!email) {
                alert('请输入邮箱地址');
                return;
            }
            
            // 模拟发送邮件
            alert(`重置链接已发送到 ${email}，请查收邮件并输入验证码`);
            
            // 显示第二步
            document.getElementById('forgotPasswordStep1').style.display = 'none';
            document.getElementById('forgotPasswordStep2').style.display = 'block';
            
            // 生成验证码
            const verificationCode = Math.floor(100000 + Math.random() * 900000);
            localStorage.setItem('verificationCode', verificationCode.toString());
            alert(`验证码：${verificationCode}（实际应用中会通过邮件发送）`);
        }

        // 返回第一步
        function backToStep1() {
            document.getElementById('forgotPasswordStep2').style.display = 'none';
            document.getElementById('forgotPasswordStep1').style.display = 'block';
        }

        // 重置忘记密码步骤
        function resetForgotPasswordSteps() {
            document.getElementById('forgotPasswordStep1').style.display = 'block';
            document.getElementById('forgotPasswordStep2').style.display = 'none';
            document.getElementById('resetEmail').value = '';
            document.getElementById('resetCode').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
        }

        // 重置密码
        function resetPassword() {
            const code = document.getElementById('resetCode').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (!code || !newPassword || !confirmPassword) {
                alert('请填写所有字段');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('两次输入的密码不一致');
                return;
            }
            
            const storedCode = localStorage.getItem('verificationCode');
            if (code !== storedCode) {
                alert('验证码错误');
                return;
            }
            
            // 模拟密码重置成功
            alert('密码重置成功！');
            localStorage.removeItem('verificationCode');
            
            // 关闭忘记密码页面，返回登录页面
            closeForgotPassword();
        }

        // 页脚相关功能

        // 返回顶部
        function backToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // 显示留言反馈弹窗
        function showFeedback() {
            showFeedbackModal();
        }

        // 关闭留言反馈弹窗
        function closeFeedbackModal() {
            document.getElementById('feedbackModal').classList.add('hidden');
            document.getElementById('feedbackModal').style.display = 'none';
        }

        // 显示隐私政策弹窗
        function showPrivacyPolicy() {
            document.getElementById('privacyPolicyModal').classList.remove('hidden');
            document.getElementById('privacyPolicyModal').style.display = 'flex';
        }

        // 关闭隐私政策弹窗
        function closePolicyModal() {
            document.getElementById('privacyPolicyModal').classList.add('hidden');
            document.getElementById('privacyPolicyModal').style.display = 'none';
        }

        // 知晓隐私政策并返回首页
        function acknowledgePrivacyPolicy() {
            // 记录用户已阅读隐私政策
            localStorage.setItem('privacy_policy_read', 'true');
            localStorage.setItem('privacy_policy_read_date', new Date().toISOString());
            
            // 显示确认消息
            showToast('感谢您阅读隐私政策！', 'success');
            
            // 关闭隐私政策弹窗
            closePolicyModal();
            
            // 返回首页
            navigateToPage(PAGE_STATES.HOME, false);
            
            // 记录日志
            console.log('用户已阅读隐私政策并返回首页');
        }

        // 显示服务条款弹窗
        function showTermsOfService() {
            document.getElementById('termsModal').classList.remove('hidden');
            document.getElementById('termsModal').style.display = 'flex';
        }

        // 关闭服务条款弹窗
        function closeTermsModal() {
            document.getElementById('termsModal').classList.add('hidden');
            document.getElementById('termsModal').style.display = 'none';
        }

        // 知晓并同意服务条款
        function acknowledgeTerms() {
            // 记录用户已同意服务条款
            localStorage.setItem('terms_accepted', 'true');
            localStorage.setItem('terms_accepted_date', new Date().toISOString());
            
            // 显示确认消息
            showToast('感谢您同意服务条款！', 'success');
            
            // 关闭弹窗
            closeTermsModal();
            
            // 可以在这里添加其他逻辑，比如启用某些功能
            console.log('用户已同意服务条款');
        }

        // 显示阅读提醒
        function showReadReminder() {
            // 创建提醒弹窗
            const reminderModal = document.createElement('div');
            reminderModal.className = 'reminder-modal';
            reminderModal.innerHTML = `
                <div class="reminder-modal-content">
                    <div class="reminder-modal-header">
                        <h3>⚠️ 重要提醒</h3>
                    </div>
                    <div class="reminder-modal-body">
                        <div class="reminder-icon">📖</div>
                        <h4>请仔细阅读服务条款</h4>
                        <p>为了确保您了解我们的服务规则和您的权利，请务必完整阅读以上服务条款内容。</p>
                        <p><strong>重要提示：</strong></p>
                        <ul>
                            <li>测试结果仅供娱乐和参考使用</li>
                            <li>不构成专业心理建议</li>
                            <li>请遵守用户责任条款</li>
                        </ul>
                        <div class="reminder-actions">
                            <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.parentElement.remove()">我知道了</button>
                            <button class="btn" onclick="returnToTerms()">返回继续阅读</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(reminderModal);
            
            // 点击外部关闭
            reminderModal.addEventListener('click', (e) => {
                if (e.target === reminderModal) {
                    reminderModal.remove();
                }
            });
        }

        // 返回服务条款
        function returnToTerms() {
            // 移除提醒弹窗
            const reminderModal = document.querySelector('.reminder-modal');
            if (reminderModal) {
                reminderModal.remove();
            }
            
            // 确保服务条款弹窗仍然显示
            const termsModal = document.getElementById('termsModal');
            if (termsModal) {
                termsModal.classList.remove('hidden');
                termsModal.style.display = 'flex';
            }
        }

        // 显示常见问题
        function showFAQ() {
            alert('常见问题功能正在开发中，敬请期待！');
        }

        // 显示帮助中心
        function showHelp() {
            alert('帮助中心功能正在开发中，敬请期待！');
        }

        // 显示关于我们
        function showAbout() {
            alert('关于我们功能正在开发中，敬请期待！');
        }

        // 处理页脚留言表单提交
        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('feedbackName').value;
            const email = document.getElementById('feedbackEmail').value;
            const message = document.getElementById('feedbackMessage').value;
            
            if (name && email && message) {
                // 模拟提交成功
                alert('感谢您的留言！我们会认真考虑您的建议。');
                
                // 清空表单
                document.getElementById('feedbackForm').reset();
            } else {
                alert('请填写所有必填字段');
            }
        });

        // 处理弹窗留言表单提交
        document.getElementById('feedbackFormModal').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('modalFeedbackName').value;
            const email = document.getElementById('modalFeedbackEmail').value;
            const type = document.getElementById('modalFeedbackType').value;
            const message = document.getElementById('modalFeedbackMessage').value;
            const agreePrivacy = document.getElementById('agreePrivacy').checked;
            
            if (!agreePrivacy) {
                alert('请同意隐私政策');
                return;
            }
            
            if (name && email && type && message) {
                // 模拟提交成功
                alert('感谢您的反馈！我们会认真处理您的问题。');
                
                // 清空表单并关闭弹窗
                document.getElementById('feedbackFormModal').reset();
                closeFeedbackModal();
            } else {
                alert('请填写所有必填字段');
            }
        });

        // 点击弹窗外部关闭弹窗
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('feedback-modal') || 
                e.target.classList.contains('policy-modal')) {
                e.target.classList.add('hidden');
                e.target.style.display = 'none';
            }
        });

        // 页面加载完成后初始化页脚功能
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化数字计数器动画
            initCounters();
            
            // 添加滚动监听，显示/隐藏返回顶部按钮
            window.addEventListener('scroll', function() {
                const footerControls = document.querySelector('.footer-controls');
                if (footerControls) {
                    const backToTopBtn = footerControls.querySelector('button');
                    if (backToTopBtn && backToTopBtn.textContent.includes('返回顶部')) {
                        if (window.scrollY > 300) {
                            backToTopBtn.style.opacity = '1';
                        } else {
                            backToTopBtn.style.opacity = '0.7';
                        }
                    }
                }
            });
            
            // 初始化星座+MBTI弹窗的关闭按钮事件监听器
            initZodiacModalCloseButton();
            
            // 确保zodiacTestAnswers变量被正确初始化
            initZodiacTestVariables();
            
            // 双重保险：直接在全局作用域初始化
            if (typeof window.zodiacTestAnswers === 'undefined') {
                window.zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                console.log('在全局作用域初始化zodiacTestAnswers');
            }

            // 绑定“立即体验”卡片点击事件（冗余绑定，防止inline无效）
            const experienceCard = document.getElementById('zodiacMbtiExperienceCard');
            if (experienceCard) {
                experienceCard.addEventListener('click', function(e) {
                    try {
                        console.log('“立即体验”卡片被点击（监听器）');
                        // 不阻止默认，让 inline 与监听器都能触发；如需单通道，可取消下一行注释
                        // e.stopPropagation();
                        startZodiacMBTITest();
                    } catch (err) {
                        console.error('触发startZodiacMBTITest失败:', err);
                        alert('启动体验失败: ' + err.message);
                    }
                }, { passive: true });
                console.log('已绑定“立即体验”卡片点击事件');
            } else {
                console.warn('未找到“立即体验”卡片进行事件绑定');
            }
        });

        // 初始化数字计数器动画
        function initCounters() {
            const counters = document.querySelectorAll('.stat-counter');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const counter = entry.target.querySelector('.counter');
                        const target = parseInt(entry.target.dataset.target);
                        animateCounter(counter, target);
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.5 });
            
            counters.forEach(counter => observer.observe(counter));
        }

        // 数字动画效果
        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 50; // 50步完成动画
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                
                // 处理小数点显示
                if (target % 1 !== 0) {
                    // 如果是小数，保留两位小数
                    element.textContent = current.toFixed(2);
                } else {
                    // 如果是整数，不显示小数点
                    element.textContent = Math.floor(current);
                }
            }, 30);
        }

        // 复制到剪贴板
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('已复制到剪贴板！', 'success');
                }).catch(() => {
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }

        // 备用复制方法
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('已复制到剪贴板！', 'success');
            } catch (err) {
                showToast('复制失败，请手动复制', 'error');
            }
            document.body.removeChild(textArea);
        }

        // 显示微信二维码
        function showQRCode() {
            const modal = document.createElement('div');
            modal.className = 'qr-modal';
            modal.innerHTML = `
                <div class="qr-modal-content">
                    <div class="qr-modal-header">
                        <h3>💬 微信二维码</h3>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">&times;</button>
                    </div>
                    <div class="qr-modal-body">
                        <div class="qr-placeholder">
                            <div class="qr-icon">📱</div>
                            <p>微信：MBTI_Official</p>
                            <p>扫描二维码添加好友</p>
                        </div>
                        <div class="qr-info">
                            <p><strong>客服时间：</strong>9:00-18:00</p>
                            <p><strong>响应速度：</strong>5分钟内回复</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // 点击外部关闭
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // 快速反馈功能
        function quickFeedback(type) {
            // 添加按钮点击效果
            const btn = event.target.closest('.feedback-btn');
            if (btn) {
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    btn.style.transform = '';
                }, 150);
            }
            
            // 记录反馈类型
            localStorage.setItem('feedback_type', type);
            
            // 显示反馈弹窗
            showFeedbackModal(type);
            
            // 记录反馈（实际应用中可以发送到服务器）
            console.log(`用户反馈: ${type}`);
        }

        // 显示点赞选择弹窗
        function showPraiseOptions() {
            const modal = document.createElement('div');
            modal.className = 'praise-modal';
            modal.innerHTML = `
                <div class="praise-modal-content">
                    <div class="praise-modal-header">
                        <h3>👍 为我们的服务点赞</h3>
                        <button class="close-btn" onclick="closePraiseModal()">&times;</button>
                    </div>
                    <div class="praise-modal-body">
                        <div class="praise-intro">
                            <p>请选择您对我们的MBTI测试服务的满意程度：</p>
                        </div>
                        
                        <div class="praise-options">
                            <div class="praise-option" onclick="selectPraiseLevel('excellent')">
                                <div class="praise-icon">⭐⭐⭐⭐⭐</div>
                                <div class="praise-text">
                                    <h4>非常满意</h4>
                                    <p>测试准确，体验流畅，完全超出预期</p>
                                </div>
                                <div class="praise-arrow">→</div>
                            </div>
                            
                            <div class="praise-option" onclick="selectPraiseLevel('good')">
                                <div class="praise-icon">⭐⭐⭐⭐</div>
                                <div class="praise-text">
                                    <h4>比较满意</h4>
                                    <p>测试结果合理，整体体验良好</p>
                                </div>
                                <div class="praise-arrow">→</div>
                            </div>
                            
                            <div class="praise-option" onclick="selectPraiseLevel('okay')">
                                <div class="praise-icon">⭐⭐⭐</div>
                                <div class="praise-text">
                                    <h4>基本满意</h4>
                                    <p>测试功能正常，基本满足需求</p>
                                </div>
                                <div class="praise-arrow">→</div>
                            </div>
                        </div>
                        
                        <div class="praise-actions">
                            <button class="btn btn-secondary" onclick="closePraiseModal()">取消</button>
                            <button class="btn" onclick="quickFeedback('praise')">写详细评价</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 点击外部关闭弹窗
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // 选择点赞等级
        function selectPraiseLevel(level) {
            const levelNames = {
                'excellent': '非常满意',
                'good': '比较满意',
                'okay': '基本满意'
            };
            
            const levelText = levelNames[level];
            
            // 记录点赞等级
            localStorage.setItem('praise_level', level);
            localStorage.setItem('praise_level_name', levelText);
            
            // 显示感谢消息
            showToast(`感谢您的${levelText}评价！我们会继续努力提供更好的服务。`, 'success');
            
            // 关闭点赞弹窗
            closePraiseModal();
            
            // 记录日志
            console.log(`用户点赞等级: ${level} (${levelText})`);
            
            // 可以在这里添加其他逻辑，比如发送到服务器
        }

        // 关闭点赞弹窗
        function closePraiseModal() {
            const modal = document.querySelector('.praise-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 显示反馈弹窗
        function showFeedbackModal(type = '') {
            const modal = document.getElementById('feedbackModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
                
                // 如果指定了类型，预选反馈类型
                if (type && type !== '') {
                    const typeSelect = document.getElementById('modalFeedbackType');
                    if (typeSelect) {
                        typeSelect.value = type;
                    }
                    
                    // 根据类型设置不同的占位符文本
                    const messageTextarea = document.getElementById('modalFeedbackMessage');
                    if (messageTextarea) {
                        const placeholders = {
                            'praise': '请告诉我们您喜欢这个测试的哪些方面，或者有什么特别好的体验...',
                            'improvement': '请详细描述您希望改进的功能，包括具体的改进想法和期望的效果...',
                            'bug': '请详细描述您遇到的问题，包括操作步骤、错误现象和期望的正确结果...',
                            'other': '请详细描述您的其他反馈内容...'
                        };
                        messageTextarea.placeholder = placeholders[type] || '请详细描述您的意见或建议...';
                    }
                }
                
                // 添加点击外部关闭弹窗的功能
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeFeedbackModal();
                    }
                });
            }
        }

        // 关闭反馈弹窗
        function closeFeedbackModal() {
            const modal = document.getElementById('feedbackModal');
            if (modal) {
                modal.classList.remove('show');
                modal.classList.add('hidden');
            }
        }

        // 显示功能信息
        function showFeatureInfo(featureType) {
            const featureInfo = {
                'mbti': {
                    title: '🧠 MBTI人格测试',
                    description: '基于荣格类型学理论的16种人格类型测试，帮助你了解自己的性格偏好和优势。',
                    status: '当前可用',
                    action: 'startTest()'
                },
                'zodiac': {
                    title: '♈ 星座性格测试',
                    description: '探索你的星座特质、性格倾向和潜在天赋，了解星座如何影响你的个性。',
                    status: '即将推出',
                    action: () => showToast('星座测试功能即将推出，敬请期待！', 'info')
                },
                'bazi': {
                    title: '📅 八字算命',
                    description: '传统命理学测试，通过出生年月日时解读你的命运密码和人生轨迹。',
                    status: '即将推出',
                    action: () => showToast('八字算命功能即将推出，敬请期待！', 'info')
                },
                'tarot': {
                    title: '🔮 塔罗牌测试',
                    description: '神秘的塔罗牌测试，揭示你的内心世界、潜在能力和未来发展方向。',
                    status: '当前可用',
                    action: 'location.href=\'tarot-test.html\''
                },
                'numerology': {
                    title: '🔢 数字命理',
                    description: '通过数字解读你的性格特征、天赋才能和人生使命。',
                    status: '当前可用',
                    action: 'location.href=\'test-numerology.html\''
                },
                'chinese-zodiac': {
                    title: '🐉 生肖测试',
                    description: '十二生肖性格特征深度解析，了解你的生肖特质和潜在优势。',
                    status: '当前可用',
                    action: 'location.href=\'chinese-zodiac-test.html\''
                }
            };
            
            const feature = featureInfo[featureType];
            if (feature) {
                // 显示功能详情弹窗
                const modal = document.createElement('div');
                modal.className = 'feature-modal';
                modal.innerHTML = `
                    <div class="feature-modal-content">
                        <div class="feature-modal-header">
                            <h3>${feature.title}</h3>
                            <button class="close-btn" onclick="this.closest('.feature-modal').remove()">&times;</button>
                        </div>
                        <div class="feature-modal-body">
                            <p>${feature.description}</p>
                            <div class="feature-status-badge ${feature.status === '当前可用' ? 'active' : 'coming-soon'}">
                                ${feature.status}
                            </div>
                            <div class="feature-actions">
                                <button class="btn" onclick="this.closest('.feature-modal').remove(); ${feature.status === '当前可用' ? feature.action : 'showToast(\'功能即将推出，敬请期待！\', \'info\')'}">
                                    ${feature.status === '当前可用' ? '开始测试' : '我知道了'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // 点击外部关闭弹窗
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }
        }

        // 处理反馈表单提交
        function handleFeedbackSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const feedbackData = {
                name: formData.get('name'),
                email: formData.get('email'),
                type: formData.get('type'),
                message: formData.get('message'),
                agreePrivacy: formData.get('agreePrivacy')
            };
            
            // 验证必填字段
            if (!feedbackData.name || !feedbackData.email || !feedbackData.type || !feedbackData.message || !feedbackData.agreePrivacy) {
                showToast('请填写所有必填字段', 'error');
                return;
            }
            
            // 验证邮箱格式
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(feedbackData.email)) {
                showToast('请输入有效的邮箱地址', 'error');
                return;
            }
            
            // 模拟提交成功
            console.log('反馈数据:', feedbackData);
            showToast('感谢您的反馈！我们会认真处理您的意见。', 'success');
            
            // 重置表单
            event.target.reset();
            
            // 关闭弹窗
            closeFeedbackModal();
        }

        // 切换主题
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const btn = event.target;
            if (newTheme === 'dark') {
                btn.innerHTML = '☀️ 浅色模式';
                showToast('已切换到深色模式', 'success');
            } else {
                btn.innerHTML = '🌙 深色模式';
                showToast('已切换到浅色模式', 'success');
            }
        }

        // 显示提示消息
        function showToast(message, type = 'info') {
            // 移除现有的提示
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            // 设置样式
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#667eea'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-weight: 500;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            // 显示动画
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // 自动隐藏
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 3000);
        }

        // ===== 星座+MBTI融合测试系统 =====

        // 星座数据库
        const zodiacDatabase = {
            aries: { name: '白羊座', element: 'fire', traits: ['勇敢', '热情', '冲动', '领导力'] },
            taurus: { name: '金牛座', element: 'earth', traits: ['稳重', '务实', '固执', '忠诚'] },
            gemini: { name: '双子座', element: 'air', traits: ['好奇', '灵活', '沟通', '多变'] },
            cancer: { name: '巨蟹座', element: 'water', traits: ['敏感', '保护', '家庭', '直觉'] },
            leo: { name: '狮子座', element: 'fire', traits: ['自信', '慷慨', '戏剧性', '领导力'] },
            virgo: { name: '处女座', element: 'earth', traits: ['完美主义', '分析', '服务', '谦虚'] },
            libra: { name: '天秤座', element: 'air', traits: ['平衡', '和谐', '外交', '审美'] },
            scorpio: { name: '天蝎座', element: 'water', traits: ['神秘', '深度', '洞察力', '激情'] },
            sagittarius: { name: '射手座', element: 'fire', traits: ['乐观', '冒险', '哲学', '自由'] },
            capricorn: { name: '摩羯座', element: 'earth', traits: ['野心', '责任', '耐心', '实用'] },
            aquarius: { name: '水瓶座', element: 'air', traits: ['创新', '独立', '人道主义', '叛逆'] },
            pisces: { name: '双鱼座', element: 'water', traits: ['同情心', '直觉', '艺术', '梦想'] }
        };

        // 元素系统
        const elementSystem = {
            fire: { name: '火象', traits: ['热情', '活力', '创造力', '领导力'] },
            earth: { name: '土象', traits: ['稳重', '务实', '可靠', '耐心'] },
            air: { name: '风象', traits: ['智慧', '沟通', '灵活', '创新'] },
            water: { name: '水象', traits: ['情感', '直觉', '同情心', '深度'] }
        };

        // 测试题目
        const zodiacMBTIQuestions = {
            mbti: [
                {
                    question: "在社交场合中，你通常：",
                    options: [
                        { text: "主动与他人交谈，享受成为焦点", value: 'E', category: 'EI' },
                        { text: "倾向于观察他人，在熟悉的环境中才活跃", value: 'I', category: 'EI' }
                    ]
                },
                {
                    question: "你更倾向于：",
                    options: [
                        { text: "关注具体细节和现实情况", value: 'S', category: 'SN' },
                        { text: "思考可能性和未来趋势", value: 'N', category: 'SN' }
                    ]
                },
                {
                    question: "当你需要做决定时，你更依赖：",
                    options: [
                        { text: "逻辑分析和客观事实", value: 'T', category: 'TF' },
                        { text: "个人价值观和感受", value: 'F', category: 'TF' }
                    ]
                },
                {
                    question: "你更喜欢的工作环境是：",
                    options: [
                        { text: "有明确的结构和计划", value: 'J', category: 'JP' },
                        { text: "灵活多变，可以随机应变", value: 'P', category: 'JP' }
                    ]
                }
            ],
            zodiac: [
                {
                    question: "面对挑战时，你通常会：",
                    options: [
                        { text: "像火一样直接面对，充满激情和勇气", element: 'fire' },
                        { text: "像土一样稳重分析，务实可靠地处理", element: 'earth' },
                        { text: "像风一样灵活思考，寻找创新的解决方案", element: 'air' },
                        { text: "像水一样深入感受，依靠直觉和同理心", element: 'water' }
                    ]
                },
                {
                    question: "在团队中，你更倾向于扮演：",
                    options: [
                        { text: "开创者：主动发起新项目，带领团队前进", element: 'fire' },
                        { text: "稳定者：保持项目稳定，确保质量达标", element: 'earth' },
                        { text: "协调者：平衡各方需求，促进团队和谐", element: 'air' },
                        { text: "支持者：关心团队成员，提供情感支持", element: 'water' }
                    ]
                }
            ],
            fusion: [
                {
                    question: "当你在团队中遇到冲突时，你会：",
                    options: [
                        { text: "像火象星座一样直接表达，像E型人一样主动沟通", element: 'fire', mbti: 'E' },
                        { text: "像土象星座一样冷静分析，像T型人一样理性处理", element: 'earth', mbti: 'T' },
                        { text: "像风象星座一样寻求平衡，像F型人一样考虑各方感受", element: 'air', mbti: 'F' },
                        { text: "像水象星座一样深入感受，像I型人一样内省思考", element: 'water', mbti: 'I' }
                    ]
                }
            ]
        };

        // 全局变量 - 使用var确保变量提升
        var zodiacTestAnswers = {
            basic: {},
            mbti: {},
            zodiac: {},
            fusion: {}
        };

        // 全局变量声明 - 确保在任何函数调用前就存在
        var zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
        console.log('全局zodiacTestAnswers变量已声明');
        
        // 测试弹窗功能
        function testZodiacFunction() {
            console.log('=== 测试弹窗功能 ===');
            alert('测试按钮被点击了！');
            
            // 检查弹窗元素
            const modal = document.getElementById('zodiacMBTIModal');
            if (modal) {
                console.log('弹窗元素存在:', modal);
                console.log('弹窗当前类名:', modal.className);
                console.log('弹窗是否隐藏:', modal.classList.contains('hidden'));
                
                // 尝试显示弹窗
                modal.classList.remove('hidden');
                console.log('hidden类已移除，弹窗应该显示');
                
                // 检查弹窗是否真的显示
                setTimeout(() => {
                    console.log('弹窗当前类名:', modal.className);
                    console.log('弹窗是否隐藏:', modal.classList.contains('hidden'));
                    console.log('弹窗计算样式:', window.getComputedStyle(modal).display);
                }, 100);
                
            } else {
                console.error('弹窗元素不存在！');
                alert('弹窗元素不存在！');
            }
        }

        // 测试开始测试按钮功能
        function testStartZodiacTest() {
            console.log('=== 测试开始测试按钮功能 ===');
            
            // 1. 检查弹窗是否显示
            const modal = document.getElementById('zodiacMBTIModal');
            if (!modal) {
                alert('弹窗元素不存在！');
                return;
            }
            
            if (modal.classList.contains('hidden')) {
                alert('弹窗未显示，请先点击星座卡片！');
                return;
            }
            
            // 2. 检查输入元素
            const birthDate = document.getElementById('birthDate');
            const birthTime = document.getElementById('birthTime');
            const birthPlace = document.getElementById('birthPlace');
            
            console.log('输入元素检查:', { birthDate, birthTime, birthPlace });
            
            if (!birthDate || !birthTime || !birthPlace) {
                alert('输入元素未找到！');
                return;
            }
            
            // 3. 检查输入值
            const birthDateValue = birthDate.value;
            const birthTimeValue = birthTime.value;
            const birthPlaceValue = birthPlace.value;
            
            console.log('输入值检查:', { birthDateValue, birthTimeValue, birthPlaceValue });
            
            // 4. 模拟填写信息
            if (!birthDateValue) birthDate.value = '1990-01-01';
            if (!birthTimeValue) birthTime.value = '12:00';
            if (!birthPlaceValue) birthPlace.value = '北京';
            
            // 5. 直接调用函数
            alert('准备调用startZodiacTest函数...');
            startZodiacTest();
        }

        // 测试模态框元素
        function testModalElements() {
            console.log('=== 测试模态框元素 ===');
            
            const modal = document.getElementById('zodiacMBTIModal');
            if (!modal) {
                alert('弹窗元素不存在！');
                return;
            }
            
            // 检查所有相关元素
            const elements = {
                modal: modal,
                birthDate: document.getElementById('birthDate'),
                birthTime: document.getElementById('birthTime'),
                birthPlace: document.getElementById('birthPlace'),
                startTestBtn: document.getElementById('startTestBtn'),
                mbtiSection: document.getElementById('mbtiSection'),
                zodiacSection: document.getElementById('zodiacSection'),
                fusionSection: document.getElementById('fusionSection')
            };
            
            console.log('元素检查结果:', elements);
            
            let result = '模态框元素检查结果：\n\n';
            for (const [name, element] of Object.entries(elements)) {
                if (element) {
                    result += `✅ ${name}: 存在\n`;
                } else {
                    result += `❌ ${name}: 不存在\n`;
                }
            }
            
            alert(result);
        }

        // 开始星座+MBTI融合测试
        function startZodiacMBTITest() {
            console.log('=== startZodiacMBTITest 函数被调用，模式: 立即体验 ===');
            
            try {
                // 查找弹窗元素
                const modal = document.getElementById('zodiacMBTIModal');
                if (!modal) {
                    console.error('弹窗元素未找到: zodiacMBTIModal');
                    alert('弹窗元素未找到！请检查HTML结构');
                    return;
                }
                console.log('弹窗元素找到:', modal);
                
                // 显示测试弹窗
                modal.classList.remove('hidden');
                console.log('弹窗已显示，hidden类已移除');
                
                // 隐藏首页元素，专注于测试
                document.getElementById('featuresSection').classList.add('hidden');
                document.getElementById('mainHeader').classList.add('hidden');
                
                // 设置默认日期为今天
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                
                const birthDateInput = document.getElementById('birthDate');
                if (birthDateInput) {
                    birthDateInput.value = `${year}-${month}-${day}`;
                    console.log('出生日期已设置:', birthDateInput.value);
                } else {
                    console.error('出生日期输入框未找到');
                }
                
                // 设置默认时间为当前时间
                const hours = String(today.getHours()).padStart(2, '0');
                const minutes = String(today.getMinutes()).padStart(2, '0');
                
                const birthTimeInput = document.getElementById('birthTime');
                if (birthTimeInput) {
                    birthTimeInput.value = `${hours}:${minutes}`;
                    console.log('出生时间已设置:', birthTimeInput.value);
                } else {
                    console.error('出生时间输入框未找到');
                }
                
                // 重置测试状态
                restartZodiacTest();
                console.log('测试状态已重置');
                
                // 设置为立即体验模式：显示测试题目
                const startTestBtn = document.getElementById('startTestBtn');
                if (startTestBtn) {
                    startTestBtn.textContent = '开始测试';
                    startTestBtn.onclick = function() {
                        startZodiacTestExperience();
                    };
                    console.log('设置为立即体验模式');
                }
                
            } catch (error) {
                console.error('startZodiacMBTITest 函数执行出错:', error);
                alert('函数执行出错: ' + error.message);
            }
        }

        // 初始化星座+MBTI测试相关变量
        function initZodiacTestVariables() {
            console.log('初始化星座+MBTI测试变量...');
            
            try {
                // 确保zodiacTestAnswers变量存在
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('zodiacTestAnswers未定义，正在创建...');
                    window.zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                } else {
                    console.log('zodiacTestAnswers已存在，重置为初始状态');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                }
                
                console.log('zodiacTestAnswers初始化完成:', zodiacTestAnswers);
            } catch (error) {
                console.error('初始化zodiacTestAnswers时出错:', error);
                // 如果出错，尝试在全局作用域创建
                try {
                    window.zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                    console.log('在全局作用域创建zodiacTestAnswers成功');
                } catch (e) {
                    console.error('在全局作用域创建zodiacTestAnswers失败:', e);
                }
            }
        }

        // 测试数据保存功能
        function testDataSave() {
            console.log('=== 测试数据保存功能 ===');
            
            try {
                // 模拟数据
                const testData = {
                    birthDate: '1990-01-01',
                    birthTime: '12:00',
                    birthPlace: '测试城市'
                };
                
                console.log('测试数据:', testData);
                
                // 确保变量存在 - 多重检查
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('zodiacTestAnswers未定义，正在创建...');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                }
                
                // 如果还是undefined，尝试从全局作用域获取
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('尝试从全局作用域获取zodiacTestAnswers...');
                    zodiacTestAnswers = window.zodiacTestAnswers;
                }
                
                // 如果还是undefined，强制创建
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('强制创建zodiacTestAnswers...');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                    window.zodiacTestAnswers = zodiacTestAnswers;
                }
                
                console.log('zodiacTestAnswers状态:', zodiacTestAnswers);
                
                // 保存测试数据
                zodiacTestAnswers.basic = testData;
                console.log('测试数据已保存到内存:', zodiacTestAnswers.basic);
                
                // 尝试保存到localStorage
                try {
                    localStorage.setItem('zodiacTestData', JSON.stringify(testData));
                    console.log('测试数据已保存到localStorage');
                    
                    // 验证保存
                    const savedData = localStorage.getItem('zodiacTestData');
                    console.log('从localStorage读取的数据:', savedData);
                    
                    if (savedData) {
                        alert('测试数据保存成功！\n\n保存的数据：\n' + savedData);
                    } else {
                        alert('localStorage保存失败');
                    }
                    
                } catch (localStorageError) {
                    console.error('localStorage测试失败:', localStorageError);
                    alert('localStorage测试失败: ' + localStorageError.message);
                }
                
            } catch (error) {
                console.error('测试数据保存失败:', error);
                alert('测试失败: ' + error.message);
            }
        }

        // 返回首页
        function returnToHomePage() {
            console.log('=== 返回首页函数被调用 ===');
            
            try {
                // 1. 强制关闭弹窗
                const modal = document.getElementById('zodiacMBTIModal');
                if (modal) {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                    modal.style.visibility = 'hidden';
                    modal.style.opacity = '0';
                    modal.style.zIndex = '-1';
                    console.log('弹窗已强制隐藏');
                }
                
                // 2. 强制显示首页元素
                const welcomeSection = document.getElementById('welcomeSection');
                const featuresSection = document.getElementById('featuresSection');
                const mainHeader = document.getElementById('mainHeader');
                
                if (welcomeSection) {
                    welcomeSection.classList.remove('hidden');
                    welcomeSection.style.display = 'block';
                    welcomeSection.style.visibility = 'visible';
                    welcomeSection.style.opacity = '1';
                    welcomeSection.style.zIndex = 'auto';
                    console.log('欢迎部分已强制显示');
                }
                
                if (featuresSection) {
                    featuresSection.classList.remove('hidden');
                    featuresSection.style.display = 'block';
                    featuresSection.style.visibility = 'visible';
                    featuresSection.style.opacity = '1';
                    featuresSection.style.zIndex = 'auto';
                    console.log('功能栏目已强制显示');
                }
                
                if (mainHeader) {
                    mainHeader.classList.remove('hidden');
                    mainHeader.style.display = 'block';
                    mainHeader.style.visibility = 'visible';
                    mainHeader.style.opacity = '1';
                    mainHeader.style.zIndex = 'auto';
                    console.log('主标题已强制显示');
                }
                
                // 3. 滚动到页面顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });
                console.log('页面已滚动到顶部');
                
                // 4. 显示成功消息
                console.log('=== 返回首页完成 ===');
                
            } catch (error) {
                console.error('返回首页时出错:', error);
                
                // 即使出错，也要强制操作
                try {
                    const modal = document.getElementById('zodiacMBTIModal');
                    if (modal) {
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                    }
                    
                    const welcomeSection = document.getElementById('welcomeSection');
                    const featuresSection = document.getElementById('featuresSection');
                    const mainHeader = document.getElementById('mainHeader');
                    
                    if (welcomeSection) welcomeSection.style.display = 'block';
                    if (featuresSection) featuresSection.style.display = 'block';
                    if (mainHeader) mainHeader.style.display = 'block';
                    
                } catch (e) {
                    console.error('强制操作失败:', e);
                }
            }
        }

        // 调试首页元素状态
        function debugHomePageElements() {
            console.log('=== 调试首页元素状态 ===');
            
            const welcomeSection = document.getElementById('welcomeSection');
            const featuresSection = document.getElementById('featuresSection');
            const mainHeader = document.getElementById('mainHeader');
            const modal = document.getElementById('zodiacMBTIModal');
            
            console.log('弹窗元素:', modal);
            console.log('弹窗类名:', modal ? modal.className : 'N/A');
            console.log('弹窗是否隐藏:', modal ? modal.classList.contains('hidden') : 'N/A');
            console.log('弹窗display:', modal ? modal.style.display : 'N/A');
            console.log('弹窗visibility:', modal ? modal.style.visibility : 'N/A');
            console.log('弹窗opacity:', modal ? modal.style.opacity : 'N/A');
            console.log('弹窗z-index:', modal ? modal.style.zIndex : 'N/A');
            
            console.log('欢迎部分元素:', welcomeSection);
            console.log('欢迎部分类名:', welcomeSection ? welcomeSection.className : 'N/A');
            console.log('欢迎部分是否隐藏:', welcomeSection ? welcomeSection.classList.contains('hidden') : 'N/A');
            console.log('欢迎部分display:', welcomeSection ? welcomeSection.style.display : 'N/A');
            
            console.log('功能栏目元素:', featuresSection);
            console.log('功能栏目类名:', featuresSection ? featuresSection.className : 'N/A');
            console.log('功能栏目是否隐藏:', featuresSection ? featuresSection.classList.contains('hidden') : 'N/A');
            console.log('功能栏目display:', featuresSection ? featuresSection.style.display : 'N/A');
            
            console.log('主标题元素:', mainHeader);
            console.log('主标题类名:', mainHeader ? mainHeader.className : 'N/A');
            console.log('主标题是否隐藏:', mainHeader ? mainHeader.classList.contains('hidden') : 'N/A');
            console.log('主标题display:', mainHeader ? mainHeader.style.display : 'N/A');
            
            // 尝试强制显示首页元素
            console.log('=== 尝试强制显示首页元素 ===');
            
            if (welcomeSection) {
                welcomeSection.classList.remove('hidden');
                welcomeSection.style.display = 'block';
                welcomeSection.style.visibility = 'visible';
                welcomeSection.style.opacity = '1';
                welcomeSection.style.zIndex = 'auto';
                console.log('欢迎部分强制显示完成');
            }
            
            if (featuresSection) {
                featuresSection.classList.remove('hidden');
                featuresSection.style.display = 'block';
                featuresSection.style.visibility = 'visible';
                featuresSection.style.opacity = '1';
                featuresSection.style.zIndex = 'auto';
                console.log('功能栏目强制显示完成');
            }
            
            if (mainHeader) {
                mainHeader.classList.remove('hidden');
                mainHeader.style.display = 'block';
                mainHeader.style.visibility = 'visible';
                mainHeader.style.opacity = '1';
                mainHeader.style.zIndex = 'auto';
                console.log('主标题强制显示完成');
            }
            
            // 强制隐藏弹窗
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                console.log('弹窗强制隐藏完成');
            }
            
            console.log('=== 调试操作完成 ===');
        }

        // 初始化星座+MBTI弹窗的关闭按钮事件监听器
        function initZodiacModalCloseButton() {
            console.log('初始化星座+MBTI弹窗关闭按钮...');
            
            // 等待弹窗元素加载完成
            setTimeout(() => {
                const closeBtn = document.querySelector('#zodiacMBTIModal .close-btn');
                if (closeBtn) {
                    console.log('找到关闭按钮，添加事件监听器');
                    
                    // 移除可能存在的onclick属性
                    closeBtn.removeAttribute('onclick');
                    
                    // 添加事件监听器
                    closeBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('关闭按钮被点击');
                        closeZodiacMBTIModal();
                    });
                    
                    console.log('关闭按钮事件监听器已添加');
                } else {
                    console.log('关闭按钮未找到，将在稍后重试');
                    // 如果还没找到，稍后重试
                    setTimeout(initZodiacModalCloseButton, 500);
                }
            }, 100);
        }

        // 关闭星座+MBTI融合测试弹窗
        function closeZodiacMBTIModal() {
            console.log('=== closeZodiacMBTIModal 函数被调用 ===');
            
            try {
                // 1. 强制关闭弹窗 - 使用多种方法确保弹窗关闭
                const modal = document.getElementById('zodiacMBTIModal');
                if (modal) {
                    // 方法1: 添加hidden类
                    modal.classList.add('hidden');
                    // 方法2: 直接设置display为none
                    modal.style.display = 'none';
                    // 方法3: 设置visibility为hidden
                    modal.style.visibility = 'hidden';
                    // 方法4: 设置opacity为0
                    modal.style.opacity = '0';
                    // 方法5: 设置z-index为-1
                    modal.style.zIndex = '-1';
                    
                    console.log('弹窗已强制隐藏');
                } else {
                    console.error('弹窗元素未找到');
                }
                
                // 2. 强制显示首页元素 - 使用多种方法确保元素显示
                const welcomeSection = document.getElementById('welcomeSection');
                const featuresSection = document.getElementById('featuresSection');
                const mainHeader = document.getElementById('mainHeader');
                
                if (welcomeSection) {
                    welcomeSection.classList.remove('hidden');
                    welcomeSection.style.display = 'block';
                    welcomeSection.style.visibility = 'visible';
                    welcomeSection.style.opacity = '1';
                    welcomeSection.style.zIndex = 'auto';
                    console.log('欢迎部分已强制显示');
                }
                
                if (featuresSection) {
                    featuresSection.classList.remove('hidden');
                    featuresSection.style.display = 'block';
                    featuresSection.style.visibility = 'visible';
                    featuresSection.style.opacity = '1';
                    featuresSection.style.zIndex = 'auto';
                    console.log('功能栏目已强制显示');
                }
                
                if (mainHeader) {
                    mainHeader.classList.remove('hidden');
                    mainHeader.style.display = 'block';
                    mainHeader.style.visibility = 'visible';
                    mainHeader.style.opacity = '1';
                    mainHeader.style.zIndex = 'auto';
                    console.log('主标题已强制显示');
                }
                
                // 3. 重置测试状态
                try {
                    if (typeof zodiacTestAnswers === 'undefined') {
                        zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                    } else {
                        zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                    }
                    
                    const birthDate = document.getElementById('birthDate');
                    const birthTime = document.getElementById('birthTime');
                    const birthPlace = document.getElementById('birthPlace');
                    
                    if (birthDate) birthDate.value = '';
                    if (birthTime) birthTime.value = '';
                    if (birthPlace) birthPlace.value = '';
                    
                    console.log('测试状态已重置');
                } catch (resetError) {
                    console.error('重置测试时出错:', resetError);
                }
                
                // 4. 滚动到页面顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });
                console.log('页面已滚动到顶部');
                
                // 5. 验证结果
                setTimeout(() => {
                    console.log('=== 验证关闭结果 ===');
                    console.log('弹窗是否隐藏:', modal ? modal.classList.contains('hidden') : 'N/A');
                    console.log('欢迎部分是否显示:', welcomeSection ? !welcomeSection.classList.contains('hidden') : 'N/A');
                    console.log('功能栏目是否显示:', featuresSection ? !featuresSection.classList.contains('hidden') : 'N/A');
                    console.log('主标题是否显示:', mainHeader ? !mainHeader.classList.contains('hidden') : 'N/A');
                }, 100);
                
                console.log('=== 关闭弹窗完成 ===');
                
            } catch (error) {
                console.error('关闭弹窗时出错:', error);
                
                // 即使出错，也要强制关闭弹窗
                try {
                    const modal = document.getElementById('zodiacMBTIModal');
                    if (modal) {
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        modal.style.zIndex = '-1';
                    }
                    
                    // 强制显示首页
                    const welcomeSection = document.getElementById('welcomeSection');
                    const featuresSection = document.getElementById('featuresSection');
                    const mainHeader = document.getElementById('mainHeader');
                    
                    if (welcomeSection) welcomeSection.style.display = 'block';
                    if (featuresSection) featuresSection.style.display = 'block';
                    if (mainHeader) mainHeader.style.display = 'block';
                    
                } catch (e) {
                    console.error('强制操作失败:', e);
                }
                
                alert('关闭弹窗时出错: ' + error.message);
            }
        }

        // 开始测试体验（显示测试题目）
        function startZodiacTestExperience() {
            console.log('=== 开始测试体验，显示测试题目 ===');
            
            try {
                // 检查弹窗是否存在
                const modal = document.getElementById('zodiacMBTIModal');
                if (!modal) {
                    console.error('弹窗元素未找到: zodiacMBTIModal');
                    alert('弹窗元素未找到！');
                    return;
                }
                console.log('弹窗元素找到:', modal);
                
                // 检查输入元素
                const birthDate = document.getElementById('birthDate');
                const birthTime = document.getElementById('birthTime');
                const birthPlace = document.getElementById('birthPlace');
                
                if (!birthDate || !birthTime || !birthPlace) {
                    console.error('输入元素未找到');
                    alert('输入元素未找到！');
                    return;
                }
                
                const birthDateValue = birthDate.value;
                const birthTimeValue = birthTime.value;
                const birthPlaceValue = birthPlace.value;

                console.log('获取到的值:', { birthDateValue, birthTimeValue, birthPlaceValue });

                if (!birthDateValue || !birthTimeValue || !birthPlaceValue) {
                    console.log('信息不完整，显示错误提示');
                    alert('请填写所有必填信息');
                    return;
                }

                // 存储用户输入的数据
                console.log('准备保存数据...');
                
                // 确保变量存在 - 多重检查
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('zodiacTestAnswers未定义，正在创建...');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                }
                
                // 如果还是undefined，尝试从全局作用域获取
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('尝试从全局作用域获取zodiacTestAnswers...');
                    zodiacTestAnswers = window.zodiacTestAnswers;
                }
                
                // 如果还是undefined，强制创建
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('强制创建zodiacTestAnswers...');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                    window.zodiacTestAnswers = zodiacTestAnswers;
                }
                
                console.log('zodiacTestAnswers状态:', zodiacTestAnswers);
                
                // 保存基础数据
                zodiacTestAnswers.basic = { 
                    birthDate: birthDateValue, 
                    birthTime: birthTimeValue, 
                    birthPlace: birthPlaceValue 
                };
                
                console.log('数据已保存到内存:', zodiacTestAnswers.basic);
                
                // 尝试保存到localStorage
                try {
                    localStorage.setItem('zodiacTestData', JSON.stringify(zodiacTestAnswers.basic));
                    console.log('数据已保存到localStorage');
                } catch (localStorageError) {
                    console.warn('localStorage保存失败:', localStorageError);
                    // localStorage失败不影响主要功能
                }
                
                // 显示成功提示
                alert('信息已保存！现在开始测试...');
                
                // 显示MBTI测试部分
                console.log('准备显示MBTI部分...');
                showZodiacSection('mbtiSection');
                console.log('准备渲染MBTI问题...');
                renderZodiacMBTIQuestions();
                console.log('测试流程启动完成');
                
            } catch (error) {
                console.error('startZodiacTestExperience函数执行出错:', error);
                alert('开始测试失败: ' + error.message);
            }
        }

        // 开始测试（保存数据并返回首页）
        function startZodiacTest() {
            console.log('=== 开始测试函数被调用 ===');
            
            try {
                // 检查弹窗是否存在
                const modal = document.getElementById('zodiacMBTIModal');
                if (!modal) {
                    console.error('弹窗元素未找到: zodiacMBTIModal');
                    alert('弹窗元素未找到！');
                    return;
                }
                console.log('弹窗元素找到:', modal);
                
                // 检查输入元素
                const birthDate = document.getElementById('birthDate');
                const birthTime = document.getElementById('birthTime');
                const birthPlace = document.getElementById('birthPlace');
                
                if (!birthDate || !birthTime || !birthPlace) {
                    console.error('输入元素未找到');
                    alert('输入元素未找到！');
                    return;
                }
                
                const birthDateValue = birthDate.value;
                const birthTimeValue = birthTime.value;
                const birthPlaceValue = birthPlace.value;

                console.log('获取到的值:', { birthDateValue, birthTimeValue, birthPlaceValue });

                if (!birthDateValue || !birthTimeValue || !birthPlaceValue) {
                    console.log('信息不完整，显示错误提示');
                    alert('请填写所有必填信息');
                    return;
                }

                // 存储用户输入的数据
                console.log('准备保存数据...');
                
                // 确保变量存在 - 多重检查
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('zodiacTestAnswers未定义，正在创建...');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                }
                
                // 如果还是undefined，尝试从全局作用域获取
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('尝试从全局作用域获取zodiacTestAnswers...');
                    zodiacTestAnswers = window.zodiacTestAnswers;
                }
                
                // 如果还是undefined，强制创建
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('强制创建zodiacTestAnswers...');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                    window.zodiacTestAnswers = zodiacTestAnswers;
                }
                
                console.log('zodiacTestAnswers状态:', zodiacTestAnswers);
                
                // 保存基础数据
                zodiacTestAnswers.basic = { 
                    birthDate: birthDateValue, 
                    birthTime: birthTimeValue, 
                    birthPlace: birthPlaceValue 
                };
                
                console.log('数据已保存到内存:', zodiacTestAnswers.basic);
                
                // 尝试保存到localStorage
                try {
                    localStorage.setItem('zodiacTestData', JSON.stringify(zodiacTestAnswers.basic));
                    console.log('数据已保存到localStorage');
                } catch (localStorageError) {
                    console.warn('localStorage保存失败:', localStorageError);
                    // localStorage失败不影响主要功能
                }
                
                // 显示成功提示
                alert('数据保存成功！正在返回首页...');
                
                // 延迟一下让用户看到提示，然后返回首页
                setTimeout(() => {
                    console.log('准备返回首页...');
                    returnToHomePage();
                }, 1000);
                
            } catch (error) {
                console.error('startZodiacTest函数执行出错:', error);
                alert('保存数据失败: ' + error.message);
            }
        }

        // 显示指定部分
        function showZodiacSection(sectionId) {
            console.log('显示部分:', sectionId);
            
            document.querySelectorAll('#zodiacMBTIModal .test-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                console.log('部分已显示:', sectionId);
            } else {
                console.error('找不到部分:', sectionId);
            }
        }

        // 返回上一部分
        function previousZodiacSection(sectionId) {
            showZodiacSection(sectionId);
        }

        // 下一步
        function nextZodiacSection(sectionId) {
            showZodiacSection(sectionId);
            if (sectionId === 'zodiacSection') {
                renderZodiacZodiacQuestions();
            } else if (sectionId === 'fusionSection') {
                renderZodiacFusionQuestions();
            }
        }

        // 渲染MBTI问题
        function renderZodiacMBTIQuestions() {
            const container = document.getElementById('mbtiQuestions');
            container.innerHTML = '';

            zodiacMBTIQuestions.mbti.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                questionDiv.innerHTML = `
                    <h3>问题 ${index + 1}</h3>
                    <p>${q.question}</p>
                    <ul class="options-list">
                        ${q.options.map((opt, optIndex) => `
                            <li class="option-item">
                                <input type="radio" name="mbti_${index}" value="${opt.value}" 
                                       class="option-radio" onchange="updateZodiacMBTIProgress()">
                                <label class="option-label">${opt.text}</label>
                            </li>
                        `).join('')}
                    </ul>
                `;
                container.appendChild(questionDiv);
            });
        }

        // 渲染星座问题
        function renderZodiacZodiacQuestions() {
            const container = document.getElementById('zodiacQuestions');
            container.innerHTML = '';

            zodiacMBTIQuestions.zodiac.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                questionDiv.innerHTML = `
                    <h3>问题 ${index + 1}</h3>
                    <p>${q.question}</p>
                    <ul class="options-list">
                        ${q.options.map((opt, optIndex) => `
                            <li class="option-item">
                                <input type="radio" name="zodiac_${index}" value="${opt.element}" 
                                       class="option-radio" onchange="updateZodiacZodiacProgress()">
                                <label class="option-label">${opt.text}</label>
                            </li>
                        `).join('')}
                    </ul>
                `;
                container.appendChild(questionDiv);
            });
        }

        // 渲染融合问题
        function renderZodiacFusionQuestions() {
            const container = document.getElementById('fusionQuestions');
            container.innerHTML = '';

            zodiacMBTIQuestions.fusion.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                questionDiv.innerHTML = `
                    <h3>问题 ${index + 1}</h3>
                    <p>${q.question}</p>
                    <ul class="options-list">
                        ${q.options.map((opt, optIndex) => `
                            <li class="option-item">
                                <input type="radio" name="fusion_${index}" value="${opt.element}_${opt.mbti}" 
                                       class="option-radio" onchange="updateZodiacFusionProgress()">
                                <label class="option-label">${opt.text}</label>
                            </li>
                        `).join('')}
                    </ul>
                `;
                container.appendChild(questionDiv);
            });
        }

        // 更新进度
        function updateZodiacMBTIProgress() {
            const answered = document.querySelectorAll('#mbtiQuestions input[type="radio"]:checked').length;
            const total = zodiacMBTIQuestions.mbti.length;
            const progress = (answered / total) * 100;
            
            document.getElementById('mbtiProgress').style.width = progress + '%';
            document.getElementById('mbtiNextBtn').disabled = answered < total;
        }

        function updateZodiacZodiacProgress() {
            const answered = document.querySelectorAll('#zodiacQuestions input[type="radio"]:checked').length;
            const total = zodiacMBTIQuestions.zodiac.length;
            const progress = (answered / total) * 100;
            
            document.getElementById('zodiacProgress').style.width = progress + '%';
            document.getElementById('zodiacNextBtn').disabled = answered < total;
        }

        function updateZodiacFusionProgress() {
            const answered = document.querySelectorAll('#fusionQuestions input[type="radio"]:checked').length;
            const total = zodiacMBTIQuestions.fusion.length;
            const progress = (answered / total) * 100;
            
            document.getElementById('fusionProgress').style.width = progress + '%';
            document.getElementById('fusionNextBtn').disabled = answered < total;
        }

        // 生成结果
        function generateZodiacResults() {
            collectZodiacAnswers();
            showZodiacSection('zodiacLoadingSection');
            
            setTimeout(() => {
                const results = calculateZodiacResults();
                displayZodiacResults(results);
                showZodiacSection('zodiacResultSection');
            }, 2000);
        }

        // 收集答案
        function collectZodiacAnswers() {
            // 收集MBTI答案
            zodiacMBTIQuestions.mbti.forEach((q, index) => {
                const selected = document.querySelector(`input[name="mbti_${index}"]:checked`);
                if (selected) {
                    zodiacTestAnswers.mbti[q.options[0].category] = selected.value;
                }
            });

            // 收集星座答案
            zodiacMBTIQuestions.zodiac.forEach((q, index) => {
                const selected = document.querySelector(`input[name="zodiac_${index}"]:checked`);
                if (selected) {
                    zodiacTestAnswers.zodiac[`question_${index}`] = selected.value;
                }
            });

            // 收集融合答案
            zodiacMBTIQuestions.fusion.forEach((q, index) => {
                const selected = document.querySelector(`input[name="fusion_${index}"]:checked`);
                if (selected) {
                    const [element, mbti] = selected.value.split('_');
                    zodiacTestAnswers.fusion[`question_${index}`] = { element, mbti };
                }
            });
        }

        // 计算结果
        function calculateZodiacResults() {
            const birthDate = new Date(zodiacTestAnswers.basic.birthDate);
            const month = birthDate.getMonth() + 1;
            const day = birthDate.getDate();
            
            let sunSign = '';
            if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) sunSign = 'aries';
            else if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) sunSign = 'taurus';
            else if ((month === 5 && day >= 21) || (month === 6 && day <= 21)) sunSign = 'gemini';
            else if ((month === 6 && day >= 22) || (month === 7 && day <= 22)) sunSign = 'cancer';
            else if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) sunSign = 'leo';
            else if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) sunSign = 'virgo';
            else if ((month === 9 && day >= 23) || (month === 10 && day <= 23)) sunSign = 'libra';
            else if ((month === 10 && day >= 24) || (month === 11 && day <= 22)) sunSign = 'scorpio';
            else if ((month === 11 && day >= 23) || (month === 12 && day <= 21)) sunSign = 'sagittarius';
            else if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) sunSign = 'capricorn';
            else if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) sunSign = 'aquarius';
            else if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) sunSign = 'pisces';

            const mbtiType = Object.values(zodiacTestAnswers.mbti).join('');
            
            const elementCounts = {};
            Object.values(zodiacTestAnswers.zodiac).forEach(element => {
                elementCounts[element] = (elementCounts[element] || 0) + 1;
            });
            const primaryElement = Object.keys(elementCounts).reduce((a, b) => 
                elementCounts[a] > elementCounts[b] ? a : b
            );

            const fusionType = generateZodiacFusionType(primaryElement, zodiacTestAnswers.mbti, sunSign);
            
            return {
                sunSign,
                mbtiType,
                primaryElement,
                fusionType
            };
        }

        // 生成融合类型
        function generateZodiacFusionType(element, mbtiProfile, sunSign) {
            const elementNames = {
                fire: '火象',
                earth: '土象',
                air: '风象',
                water: '水象'
            };

            const mbtiNames = {
                EI: mbtiProfile.EI === 'E' ? '外向' : '内向',
                SN: mbtiProfile.SN === 'S' ? '感觉' : '直觉',
                TF: mbtiProfile.TF === 'T' ? '思考' : '情感',
                JP: mbtiProfile.JP === 'J' ? '判断' : '感知'
            };

            const dominantDimension = Object.keys(mbtiNames)[0];
            
            return {
                name: `${elementNames[element]}${mbtiNames[dominantDimension]}型`,
                element: element,
                dominantDimension: dominantDimension,
                mbtiValue: mbtiProfile[dominantDimension]
            };
        }

        // 显示结果
        function displayZodiacResults(results) {
            const fusionResult = document.getElementById('zodiacFusionResult');
            const detailedReport = document.getElementById('zodiacDetailedReport');

            fusionResult.innerHTML = `
                <div class="fusion-type">
                    <h2>${results.fusionType.name}</h2>
                    <p>你的星座特质与MBTI偏好的完美结合</p>
                </div>
            `;

            detailedReport.innerHTML = `
                <div class="report-grid">
                    <div class="report-card">
                        <h3>🌟 基本信息</h3>
                        <ul>
                            <li><strong>太阳星座：</strong>${zodiacDatabase[results.sunSign].name}</li>
                            <li><strong>MBTI类型：</strong>${results.mbtiType}</li>
                            <li><strong>主要元素：</strong>${elementSystem[results.primaryElement].name}</li>
                            <li><strong>融合类型：</strong>${results.fusionType.name}</li>
                        </ul>
                    </div>
                    
                    <div class="report-card">
                        <h3>🔥 星座特质</h3>
                        <ul>
                            ${zodiacDatabase[results.sunSign].traits.map(trait => 
                                `<li>${trait}</li>`
                            ).join('')}
                        </ul>
                    </div>
                    
                    <div class="report-card">
                        <h3>🌪️ 元素特质</h3>
                        <ul>
                            ${elementSystem[results.primaryElement].traits.map(trait => 
                                `<li>${trait}</li>`
                            ).join('')}
                        </ul>
                    </div>
                    
                    <div class="report-card">
                        <h3>💡 发展建议</h3>
                        <ul>
                            <li>发挥${elementSystem[results.primaryElement].name}元素的优势</li>
                            <li>平衡${elementSystem[results.primaryElement].name}与其他元素特质</li>
                            <li>结合MBTI偏好发展个人能力</li>
                            <li>利用星座特质提升人际关系</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // 重新开始测试
        function restartZodiacTest() {
            try {
                // 确保变量已初始化
                if (typeof zodiacTestAnswers === 'undefined') {
                    console.log('zodiacTestAnswers未定义，正在初始化...');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                } else {
                    console.log('重置zodiacTestAnswers');
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                }
                
                // 重置表单输入
                const birthDate = document.getElementById('birthDate');
                const birthTime = document.getElementById('birthTime');
                const birthPlace = document.getElementById('birthPlace');
                
                if (birthDate) birthDate.value = '';
                if (birthTime) birthTime.value = '';
                if (birthPlace) birthPlace.value = '';
                
                // 显示基础信息部分
                showZodiacSection('basicInfoSection');
                
                console.log('测试重置完成');
            } catch (error) {
                console.error('重置测试时出错:', error);
                // 如果出错，至少尝试初始化变量
                try {
                    zodiacTestAnswers = { basic: {}, mbti: {}, zodiac: {}, fusion: {} };
                } catch (e) {
                    console.error('无法初始化zodiacTestAnswers:', e);
                }
            }
        }

        // 分享结果
        function shareZodiacResults() {
            const fusionType = document.querySelector('.fusion-type h2').textContent;
            const shareText = `我在星座+MBTI融合测试中的结果是：${fusionType}！快来测试你的融合类型吧！`;
            
            if (navigator.share) {
                navigator.share({
                    title: '星座+MBTI融合测试结果',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showToast('结果已复制到剪贴板！', 'success');
                });
            }
        }
    </script>
</body>
</html>
