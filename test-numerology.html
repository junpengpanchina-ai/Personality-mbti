<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—å‘½ç†Ã—MBTI æµ‹è¯•</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
            color: #111827;
            min-height: 100vh;
        }
        .container { max-width: 800px; margin: 0 auto; padding: 24px; }
        .header { text-align: center; color: #fff; margin: 24px 0; }
        .header h1 { margin: 0 0 8px; font-size: 30px; }
        .card { background: rgba(255,255,255,0.98); border-radius: 16px; padding: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); margin-bottom: 16px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap: 16px; }
        .btn { display:inline-block; background: linear-gradient(135deg, #0ea5e9, #6366f1); color:#fff; border:none; padding:10px 18px; border-radius:999px; cursor:pointer; font-weight:600; }
        .btn:hover { transform: translateY(-1px); }
        .muted { color:#6b7280; font-size:14px; }
        label { font-weight:600; display:block; margin:8px 0 6px; }
        input { width:100%; padding:10px; border-radius:10px; border:1px solid #e5e7eb; }
        .pill { display:inline-block; padding:6px 12px; border-radius:999px; background:#eef2ff; color:#3730a3; font-weight:700; font-size:12px; }
        .kpi { font-size: 28px; font-weight:800; color:#4f46e5; }
        .numerology { background: linear-gradient(135deg, #f3e8ff, #e9d5ff); border-left: 4px solid #9333ea; }
        .integration { background: linear-gradient(135deg, #dcfce7, #bbf7d0); border-left: 4px solid #16a34a; }
        .hidden { display: none; }
        .result { margin-top: 10px; padding: 12px 14px; border-left: 4px solid #10b981; background: #ecfdf5; color: #065f46; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ğŸ”¢ æ•°å­—å‘½ç†Ã—MBTI æµ‹è¯•</h1>
            <p class="muted">åŸºäºã€Šæ•°å­—å‘½ç†å­¦ï¼šåŸºäºæ•°å­—çš„è‡ªæˆ‘å‘ç°æŒ‡å—ã€‹ã€Šç”Ÿå‘½æ•°å­—ï¼šæ­ç¤ºä½ çš„ç”Ÿå‘½è“å›¾ã€‹ç­‰ç»å…¸è‘—ä½œ</p>
            
            <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
            <div style="margin-top: 20px;">
                <button class="btn" onclick="location.href='index.html'" style="background: #6b7280; margin-right: 10px;">ğŸ  è¿”å›é¦–é¡µ</button>
                <button class="btn" onclick="location.href='bazi-test.html'" style="background: #059669;">ğŸ“… å…«å­—æµ‹è¯•</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- åŸºç¡€ä¿¡æ¯è¾“å…¥ -->
        <div class="card">
            <h3>ğŸ”¢ æ•°å­—å‘½ç†Ã—MBTI æµ‹è¯•</h3>
            <p class="muted">åŸºäºã€Šæ•°å­—å‘½ç†å­¦ï¼šåŸºäºæ•°å­—çš„è‡ªæˆ‘å‘ç°æŒ‡å—ã€‹ã€Šç”Ÿå‘½æ•°å­—ï¼šæ­ç¤ºä½ çš„ç”Ÿå‘½è“å›¾ã€‹ç­‰ç»å…¸è‘—ä½œ</p>
            
            <div class="grid">
                <div>
                    <label for="nDate">å‡ºç”Ÿæ—¥æœŸ</label>
                    <input type="date" id="nDate" />
                    <label for="nName">å§“åï¼ˆä¸­æ–‡ï¼‰</label>
                    <input type="text" id="nName" placeholder="è¯·è¾“å…¥ä¸­æ–‡å§“å" />
                    <div style="margin-top:12px">
                        <button class="btn" type="button" onclick="analyzeNumerology()">å¼€å§‹æ•°å­—å‘½ç†åˆ†æ</button>
                    </div>
                </div>
                <div>
                    <h4>ç”Ÿå‘½æ•°å­—åŸºç¡€</h4>
                    <div class="pill">ç”Ÿå‘½æ•°å­—</div>
                    <div class="kpi mono" id="lifeNumber">â€”</div>
                    <div class="pill">å‘½è¿æ•°å­—</div>
                    <div class="kpi mono" id="destinyNumber">â€”</div>
                    <div class="pill">çµé­‚æ•°å­—</div>
                    <div class="kpi mono" id="soulNumber">â€”</div>
                </div>
            </div>
        </div>

        <!-- æ•°å­—å‘½ç†è§£æç»“æœ -->
        <div class="card hidden" id="numerologyAnalysis">
            <h3>ğŸ”¢ æ•°å­—å‘½ç†è§£æ</h3>
            <div class="grid">
                <div class="card numerology">
                    <div class="pill">ç”Ÿå‘½æ•°å­—ç‰¹è´¨</div>
                    <div id="lifeNumberTraits" class="muted"></div>
                </div>
                <div class="card numerology">
                    <div class="pill">å‘½è¿æ•°å­—æŒ‡å¼•</div>
                    <div id="destinyNumberGuidance" class="muted"></div>
                </div>
                <div class="card numerology">
                    <div class="pill">çµé­‚æ•°å­—å†…æ¶µ</div>
                    <div id="soulNumberMeaning" class="muted"></div>
                </div>
                <div class="card numerology">
                    <div class="pill">æ•°å­—ç»„åˆåˆ†æ</div>
                    <div id="numberCombination" class="muted"></div>
                </div>
            </div>
        </div>

        <!-- æ•°å­—å‘½ç†Ã—MBTI èåˆåˆ†æ -->
        <div class="card hidden" id="numerologyMBTIAnalysis">
            <h3>ğŸŒŸ æ•°å­—å‘½ç†Ã—MBTI èåˆåˆ†æ</h3>
            <div class="grid">
                <div class="card integration">
                    <div class="pill">æ•°å­—-MBTIæ˜ å°„</div>
                    <div id="numberMBTIMapping" class="muted"></div>
                </div>
                <div class="card integration">
                    <div class="pill">æ€§æ ¼ä¼˜åŠ¿</div>
                    <div id="numerologyStrengths" class="muted"></div>
                </div>
                <div class="card integration">
                    <div class="pill">å‘å±•å»ºè®®</div>
                    <div id="numerologyAdvice" class="muted"></div>
                </div>
                <div class="card integration">
                    <div class="pill">èŒä¸šé€‚é…</div>
                    <div id="numerologyCareer" class="muted"></div>
                </div>
            </div>
        </div>

        <!-- æ•°å­—å‘½ç†æµ‹è¯•é¢˜ -->
        <div class="card hidden" id="numerologyTest">
            <h3>ğŸ§© æ•°å­—å‘½ç†Ã—MBTI èåˆæµ‹è¯„</h3>
            <div id="numerologyQuiz"></div>
            <div style="margin-top:10px">
                <button class="btn" type="button" onclick="submitNumerologyTest()">æäº¤æ•°å­—å‘½ç†æµ‹è¯„</button>
                <span id="numerologyResult" class="pill" style="margin-left:10px"></span>
            </div>
        </div>

        <!-- æµ‹è¯•ç»“æœ -->
        <div class="card hidden" id="testResult">
            <h3>ğŸ¯ æµ‹è¯•ç»“æœ</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // æ•°å­—å‘½ç†æ˜ å°„
        const NUMBER_MEANINGS = {
            1: { traits: 'é¢†å¯¼åŠ›ã€ç‹¬ç«‹æ€§ã€åˆ›æ–°æ€§', mbti: 'ENTJ,ENTP,INTJ', element: 'ç«', career: 'ä¼ä¸šå®¶ã€é¢†å¯¼ã€åˆ›æ–°è€…' },
            2: { traits: 'åˆä½œæ€§ã€æ•æ„Ÿæ€§ã€å’Œè°æ€§', mbti: 'INFJ,INFP,ENFJ', element: 'æ°´', career: 'å’¨è¯¢å¸ˆã€åè°ƒè€…ã€è‰ºæœ¯å®¶' },
            3: { traits: 'è¡¨è¾¾æ€§ã€åˆ›é€ æ€§ã€ä¹è§‚æ€§', mbti: 'ENFP,ESFP,ENTP', element: 'æœ¨', career: 'åˆ›æ„å·¥ä½œè€…ã€è¡¨æ¼”è€…ã€æ•™å¸ˆ' },
            4: { traits: 'ç¨³å®šæ€§ã€å®ç”¨æ€§ã€ç»„ç»‡æ€§', mbti: 'ISTJ,ESTJ,ISFJ', element: 'åœŸ', career: 'ç®¡ç†è€…ã€å·¥ç¨‹å¸ˆã€ä¼šè®¡å¸ˆ' },
            5: { traits: 'è‡ªç”±æ€§ã€å†’é™©æ€§ã€é€‚åº”æ€§', mbti: 'ESTP,ISTP,ENFP', element: 'æ°´', career: 'æ¢é™©å®¶ã€é”€å”®å‘˜ã€è®°è€…' },
            6: { traits: 'è´£ä»»æ„Ÿã€å…³çˆ±æ€§ã€å¹³è¡¡æ€§', mbti: 'ISFJ,ESFJ,INFJ', element: 'åœŸ', career: 'æŠ¤ç†å¸ˆã€æ•™å¸ˆã€ç¤¾å·¥' },
            7: { traits: 'åˆ†ææ€§ã€ç²¾ç¥æ€§ã€ç¥ç§˜æ€§', mbti: 'INTP,INTJ,INFJ', element: 'é‡‘', career: 'ç§‘å­¦å®¶ã€å“²å­¦å®¶ã€åˆ†æå¸ˆ' },
            8: { traits: 'æƒåŠ›æ€§ã€ç‰©è´¨æ€§ã€æˆå°±æ€§', mbti: 'ENTJ,ESTJ,ISTJ', element: 'é‡‘', career: 'ä¼ä¸šå®¶ã€é«˜ç®¡ã€æ”¿æ²»å®¶' },
            9: { traits: 'äººé“æ€§ã€ç†æƒ³æ€§ã€æ™ºæ…§æ€§', mbti: 'INFJ,ENFJ,INFP', element: 'ç«', career: 'äººé“ä¸»ä¹‰è€…ã€è‰ºæœ¯å®¶ã€å¯¼å¸ˆ' }
        };

        // ä¸­æ–‡å§“åæ•°å­—æ˜ å°„
        const CHINESE_NAME_NUMBERS = {
            'ä¸€':1, 'äºŒ':2, 'ä¸‰':3, 'å››':4, 'äº”':5, 'å…­':6, 'ä¸ƒ':7, 'å…«':8, 'ä¹':9,
            'å£¹':1, 'è´°':2, 'å':3, 'è‚†':4, 'ä¼':5, 'é™†':6, 'æŸ’':7, 'æŒ':8, 'ç–':9,
            'ç”²':1, 'ä¹™':2, 'ä¸™':3, 'ä¸':4, 'æˆŠ':5, 'å·±':6, 'åºš':7, 'è¾›':8, 'å£¬':9, 'ç™¸':10,
            'å­':1, 'ä¸‘':2, 'å¯…':3, 'å¯':4, 'è¾°':5, 'å·³':6, 'åˆ':7, 'æœª':8, 'ç”³':9, 'é…‰':10, 'æˆŒ':11, 'äº¥':12,
            'æœ¨':3, 'ç«':2, 'åœŸ':5, 'é‡‘':7, 'æ°´':1,
            'ç‹':1, 'æ':2, 'å¼ ':3, 'åˆ˜':4, 'é™ˆ':5, 'æ¨':6, 'èµµ':7, 'é»„':8, 'å‘¨':9, 'å´':10
        };

        // æ•°å­—å‘½ç†åˆ†æ
        function analyzeNumerology() {
            const birthDate = document.getElementById('nDate').value;
            const name = document.getElementById('nName').value;

            if (!birthDate) {
                alert('è¯·è¾“å…¥å‡ºç”Ÿæ—¥æœŸ');
                return;
            }

            // è®¡ç®—ç”Ÿå‘½æ•°å­—
            const lifeNumber = calculateLifeNumber(birthDate);
            const destinyNumber = calculateDestinyNumber(birthDate);
            const soulNumber = calculateSoulNumber(name);

            // æ˜¾ç¤ºåŸºç¡€æ•°å­—
            document.getElementById('lifeNumber').textContent = lifeNumber;
            document.getElementById('destinyNumber').textContent = destinyNumber;
            document.getElementById('soulNumber').textContent = soulNumber;

            // åˆ†ææ•°å­—ç‰¹è´¨
            analyzeNumberTraits(lifeNumber, destinyNumber, soulNumber);

            // æ˜¾ç¤ºåˆ†æç»“æœ
            document.getElementById('numerologyAnalysis').classList.remove('hidden');
            document.getElementById('numerologyMBTIAnalysis').classList.remove('hidden');

            // ç”Ÿæˆæ•°å­—å‘½ç†æµ‹è¯•é¢˜
            generateNumerologyQuiz(lifeNumber, destinyNumber, soulNumber);
        }

        // è®¡ç®—ç”Ÿå‘½æ•°å­—
        function calculateLifeNumber(birthDate) {
            const dateStr = birthDate.replace(/-/g, '');
            let sum = 0;
            for (let i = 0; i < dateStr.length; i++) {
                sum += parseInt(dateStr[i]);
            }
            while (sum > 9) {
                sum = Math.floor(sum / 10) + (sum % 10);
            }
            return sum;
        }

        // è®¡ç®—å‘½è¿æ•°å­—
        function calculateDestinyNumber(birthDate) {
            const dateStr = birthDate.replace(/-/g, '');
            let sum = 0;
            for (let i = 0; i < dateStr.length; i++) {
                sum += parseInt(dateStr[i]);
            }
            return sum;
        }

        // è®¡ç®—çµé­‚æ•°å­—
        function calculateSoulNumber(name) {
            if (!name) return 0;
            let sum = 0;
            let found = false;
            
            for (let i = 0; i < name.length; i++) {
                const char = name[i];
                if (CHINESE_NAME_NUMBERS[char]) {
                    sum += CHINESE_NAME_NUMBERS[char];
                    found = true;
                }
            }
            
            if (!found) {
                for (let i = 0; i < name.length; i++) {
                    const charCode = name.charCodeAt(i);
                    sum += (charCode % 9) + 1;
                }
            }
            
            while (sum > 9) {
                sum = Math.floor(sum / 10) + (sum % 10);
            }
            
            return sum;
        }

        // åˆ†ææ•°å­—ç‰¹è´¨
        function analyzeNumberTraits(lifeNumber, destinyNumber, soulNumber) {
            const lifeInfo = NUMBER_MEANINGS[lifeNumber] || {};
            const destinyInfo = NUMBER_MEANINGS[destinyNumber] || {};
            const soulInfo = NUMBER_MEANINGS[soulNumber] || {};

            // ç”Ÿå‘½æ•°å­—ç‰¹è´¨
            const lifeTraits = lifeInfo.traits || 'ç‰¹è´¨ä¸æ˜æ˜¾';
            const lifeElement = lifeInfo.element || '';
            const lifeCareer = lifeInfo.career || '';
            
            document.getElementById('lifeNumberTraits').innerHTML = 
                `<strong>${lifeNumber}å·äººç‰¹è´¨ï¼š</strong>${lifeTraits}<br>
                 <small>äº”è¡Œå±æ€§ï¼š${lifeElement} | é€‚é…èŒä¸šï¼š${lifeCareer}</small>`;
            
            // å‘½è¿æ•°å­—æŒ‡å¼•
            const destinyTraits = destinyInfo.traits || 'æŒ‡å¼•ä¸æ˜æ˜¾';
            const destinyElement = destinyInfo.element || '';
            
            document.getElementById('destinyNumberGuidance').innerHTML = 
                `<strong>å‘½è¿æŒ‡å¼•ï¼š</strong>${destinyTraits}<br>
                 <small>äº”è¡Œå±æ€§ï¼š${destinyElement}</small>`;
            
            // çµé­‚æ•°å­—å†…æ¶µ
            const soulTraits = soulInfo.traits || 'å†…æ¶µä¸æ˜æ˜¾';
            const soulElement = soulInfo.element || '';
            
            document.getElementById('soulNumberMeaning').innerHTML = 
                `<strong>çµé­‚å†…æ¶µï¼š</strong>${soulTraits}<br>
                 <small>äº”è¡Œå±æ€§ï¼š${soulElement}</small>`;

            // æ•°å­—ç»„åˆåˆ†æ
            const combination = analyzeNumberCombination(lifeNumber, destinyNumber, soulNumber);
            document.getElementById('numberCombination').innerHTML = combination;

            // MBTIæ˜ å°„åˆ†æ
            const mbtiMapping = analyzeNumberMBTIMapping(lifeNumber, destinyNumber, soulNumber);
            document.getElementById('numberMBTIMapping').innerHTML = mbtiMapping;

            // æ€§æ ¼ä¼˜åŠ¿
            const strengths = analyzeNumerologyStrengths(lifeNumber, destinyNumber, soulNumber);
            document.getElementById('numerologyStrengths').innerHTML = strengths;

            // å‘å±•å»ºè®®
            const advice = analyzeNumerologyAdvice(lifeNumber, destinyNumber, soulNumber);
            document.getElementById('numerologyAdvice').innerHTML = advice;

            // èŒä¸šé€‚é…
            const career = analyzeNumerologyCareer(lifeNumber, destinyNumber, soulNumber);
            document.getElementById('numerologyCareer').innerHTML = career;
        }

        // åˆ†ææ•°å­—ç»„åˆ
        function analyzeNumberCombination(life, destiny, soul) {
            let analysis = '';
            let energyLevel = '';
            let compatibility = '';
            
            if (life === destiny && destiny === soul) {
                analysis = 'ä¸‰æ•°åˆä¸€ï¼Œèƒ½é‡é›†ä¸­ï¼Œæ€§æ ¼ç‰¹å¾éå¸¸çªå‡º';
                energyLevel = 'èƒ½é‡é›†ä¸­åº¦ï¼šæé«˜';
                compatibility = 'å…¼å®¹æ€§ï¼šæå¼ºï¼Œä½†å¯èƒ½è¿‡äºå•ä¸€';
            } else if (life === destiny || destiny === soul || life === soul) {
                analysis = 'ä¸¤æ•°ç›¸åŒï¼Œèƒ½é‡äº’è¡¥ï¼Œæ€§æ ¼ç‰¹å¾æ˜æ˜¾';
                energyLevel = 'èƒ½é‡é›†ä¸­åº¦ï¼šé«˜';
                compatibility = 'å…¼å®¹æ€§ï¼šå¼ºï¼Œä¸»è¦ç‰¹å¾çªå‡º';
            } else if (Math.abs(life - destiny) <= 2 && Math.abs(destiny - soul) <= 2) {
                analysis = 'ä¸‰æ•°ç›¸è¿‘ï¼Œèƒ½é‡å’Œè°ï¼Œæ€§æ ¼ç‰¹å¾å¹³è¡¡';
                energyLevel = 'èƒ½é‡é›†ä¸­åº¦ï¼šä¸­ç­‰';
                compatibility = 'å…¼å®¹æ€§ï¼šè‰¯å¥½ï¼Œç‰¹å¾åè°ƒ';
            } else {
                analysis = 'ä¸‰æ•°åˆ†æ•£ï¼Œèƒ½é‡å¤šå…ƒï¼Œæ€§æ ¼ç‰¹å¾ä¸°å¯Œ';
                energyLevel = 'èƒ½é‡é›†ä¸­åº¦ï¼šä½';
                compatibility = 'å¤šå…ƒï¼Œéœ€è¦æ•´åˆ';
            }

            const lifeElement = NUMBER_MEANINGS[life]?.element || '';
            const destinyElement = NUMBER_MEANINGS[destiny]?.element || '';
            const soulElement = NUMBER_MEANINGS[soul]?.element || '';
            
            let elementAnalysis = '';
            if (lifeElement && destinyElement && soulElement) {
                elementAnalysis = `<br><small>äº”è¡Œç»„åˆï¼š${lifeElement} + ${destinyElement} + ${soulElement}</small>`;
            }

            return `<strong>ç»„åˆç‰¹å¾ï¼š</strong>${analysis}<br>
                    <small>${energyLevel} | ${compatibility}${elementAnalysis}</small>`;
        }

        // åˆ†ææ•°å­—-MBTIæ˜ å°„
        function analyzeNumberMBTIMapping(life, destiny, soul) {
            const lifeMBTI = NUMBER_MEANINGS[life]?.mbti || '';
            const destinyMBTI = NUMBER_MEANINGS[destiny]?.mbti || '';
            const soulMBTI = NUMBER_MEANINGS[soul]?.mbti || '';

            let mapping = '';
            let dominantType = '';
            let compatibility = '';
            
            if (lifeMBTI) mapping += `ç”Ÿå‘½æ•°å­—ï¼š${lifeMBTI}<br>`;
            if (destinyMBTI) mapping += `å‘½è¿æ•°å­—ï¼š${destinyMBTI}<br>`;
            if (soulMBTI) mapping += `çµé­‚æ•°å­—ï¼š${soulMBTI}`;

            const allTypes = [lifeMBTI, destinyMBTI, soulMBTI].filter(Boolean);
            if (allTypes.length > 0) {
                const typeCounts = {};
                allTypes.forEach(type => {
                    const types = type.split(',');
                    types.forEach(t => {
                        typeCounts[t] = (typeCounts[t] || 0) + 1;
                    });
                });
                
                const dominantTypes = Object.entries(typeCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 2)
                    .map(([type, count]) => `${type}(${count}æ¬¡)`);
                
                dominantType = `ä¸»å¯¼ç±»å‹ï¼š${dominantTypes.join('ã€')}`;
                
                if (Object.keys(typeCounts).length <= 2) {
                    compatibility = 'å…¼å®¹æ€§ï¼šé«˜ï¼Œç±»å‹é›†ä¸­';
                } else if (Object.keys(typeCounts).length <= 4) {
                    compatibility = 'å…¼å®¹æ€§ï¼šä¸­ç­‰ï¼Œç±»å‹å¤šæ ·';
                } else {
                    compatibility = 'å…¼å®¹æ€§ï¼šä½ï¼Œç±»å‹åˆ†æ•£';
                }
            }

            return `${mapping || 'æš‚æ— MBTIæ˜ å°„ä¿¡æ¯'}<br>
                    <small><strong>${dominantType}</strong><br>
                    <strong>${compatibility}</strong></small>`;
        }

        // åˆ†ææ•°å­—å‘½ç†ä¼˜åŠ¿
        function analyzeNumerologyStrengths(life, destiny, soul) {
            const strengths = [];
            const lifeInfo = NUMBER_MEANINGS[life] || {};
            const destinyInfo = NUMBER_MEANINGS[destiny] || {};
            const soulInfo = NUMBER_MEANINGS[soul] || {};
            
            if (life <= 3) {
                strengths.push(`åˆ›æ–°æ€ç»´ï¼ˆ${life}å·ç‰¹è´¨ï¼‰`);
                strengths.push('è¡¨è¾¾èƒ½åŠ›ã€çµæ´»æ€§');
            } else if (life >= 4 && life <= 6) {
                strengths.push(`ç»„ç»‡èƒ½åŠ›ï¼ˆ${life}å·ç‰¹è´¨ï¼‰`);
                strengths.push('è´£ä»»æ„Ÿã€ç¨³å®šæ€§');
            } else if (life >= 7 && life <= 9) {
                strengths.push(`åˆ†æèƒ½åŠ›ï¼ˆ${life}å·ç‰¹è´¨ï¼‰`);
                strengths.push('é¢†å¯¼åŠ›ã€ä¸“ä¸šæ€§');
            }

            if (destiny <= 3) {
                strengths.push(`çµæ´»æ€§ï¼ˆ${destiny}å·ç‰¹è´¨ï¼‰`);
                strengths.push('é€‚åº”æ€§ã€åˆ›æ–°æ€§');
            } else if (destiny >= 4 && destiny <= 6) {
                strengths.push(`ç¨³å®šæ€§ï¼ˆ${destiny}å·ç‰¹è´¨ï¼‰`);
                strengths.push('å¯é æ€§ã€ç»„ç»‡æ€§');
            } else if (destiny >= 7 && destiny <= 9) {
                strengths.push(`æ·±åº¦æ€è€ƒï¼ˆ${destiny}å·ç‰¹è´¨ï¼‰`);
                strengths.push('ä¸“ä¸šèƒ½åŠ›ã€æ´å¯ŸåŠ›');
            }

            if (soul > 0) {
                strengths.push(`å†…åœ¨ç‰¹è´¨ï¼ˆ${soul}å·çµé­‚ï¼‰`);
                strengths.push(soulInfo.traits ? soulInfo.traits.split('ã€')[0] : 'ç‹¬ç‰¹ä¸ªæ€§');
            }

            const elements = [lifeInfo.element, destinyInfo.element, soulInfo.element].filter(Boolean);
            if (elements.length > 0) {
                const uniqueElements = [...new Set(elements)];
                if (uniqueElements.length === 1) {
                    strengths.push(`${uniqueElements[0]}è¡Œä¸“ç²¾ï¼Œèƒ½é‡é›†ä¸­`);
                } else {
                    strengths.push(`${uniqueElements.join('+')}è¡Œç»„åˆï¼Œèƒ½é‡å¤šå…ƒ`);
                }
            }

            return `<strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong>${strengths.join('ã€')}`;
        }

        // åˆ†ææ•°å­—å‘½ç†å»ºè®®
        function analyzeNumerologyAdvice(life, destiny, soul) {
            let advice = '';
            let focus = '';
            let warning = '';
            
            if (life <= 3) {
                advice = 'å‘æŒ¥åˆ›é€ åŠ›ï¼Œæ³¨æ„ç»†èŠ‚ç®¡ç†';
                focus = 'é‡ç‚¹å‘å±•ï¼šåˆ›æ–°æ€ç»´ã€è¡¨è¾¾èƒ½åŠ›ã€çµæ´»æ€§';
                warning = 'éœ€è¦æ³¨æ„ï¼šç»†èŠ‚ç®¡ç†ã€æ‰§è¡ŒåŠ›ã€ç¨³å®šæ€§';
            } else if (life >= 4 && life <= 6) {
                advice = 'ä¿æŒç¨³å®šæ€§ï¼ŒåŸ¹å…»åˆ›æ–°æ€ç»´';
                focus = 'é‡ç‚¹å‘å±•ï¼šç»„ç»‡èƒ½åŠ›ã€è´£ä»»æ„Ÿã€ç¨³å®šæ€§';
                warning = 'éœ€è¦æ³¨æ„ï¼šåˆ›æ–°æ€ç»´ã€çµæ´»æ€§ã€çªç ´æ€§';
            } else {
                advice = 'å‘æŒ¥ä¸“ä¸šèƒ½åŠ›ï¼Œæ³¨æ„å›¢é˜Ÿåˆä½œ';
                focus = 'é‡ç‚¹å‘å±•ï¼šåˆ†æèƒ½åŠ›ã€é¢†å¯¼åŠ›ã€ä¸“ä¸šæ€§';
                warning = 'éœ€è¦æ³¨æ„ï¼šå›¢é˜Ÿåˆä½œã€æ²Ÿé€šèƒ½åŠ›ã€åŒ…å®¹æ€§';
            }

            let destinyAdvice = '';
            if (destiny <= 3) {
                destinyAdvice = 'åŸ¹å…»é€‚åº”èƒ½åŠ›ï¼Œæ³¨æ„åšæŒæ€§';
            } else if (destiny >= 4 && destiny <= 6) {
                destinyAdvice = 'å‘æŒ¥ç¨³å®šä¼˜åŠ¿ï¼Œæ³¨æ„çµæ´»æ€§';
            } else {
                destinyAdvice = 'æ·±åŒ–ä¸“ä¸šèƒ½åŠ›ï¼Œæ³¨æ„å®è·µæ€§';
            }

            let soulAdvice = '';
            if (soul > 0) {
                if (soul <= 3) {
                    soulAdvice = 'å…³æ³¨å†…åœ¨æˆé•¿ï¼ŒåŸ¹å…»è‡ªæˆ‘è®¤çŸ¥';
                } else if (soul >= 4 && soul <= 6) {
                    soulAdvice = 'å¹³è¡¡å†…å¤–éœ€æ±‚ï¼ŒåŸ¹å…»è‡ªæˆ‘è°ƒèŠ‚';
                } else {
                    soulAdvice = 'æ·±åŒ–å†…åœ¨æ™ºæ…§ï¼ŒåŸ¹å…»è‡ªæˆ‘è¶…è¶Š';
                }
            }

            return `<strong>å‘å±•å»ºè®®ï¼š</strong>${advice}<br>
                    <small><strong>é‡ç‚¹å‘å±•ï¼š</strong>${focus}<br>
                    <strong>éœ€è¦æ³¨æ„ï¼š</strong>${warning}<br>
                    <strong>å‘½è¿æŒ‡å¼•ï¼š</strong>${destinyAdvice}<br>
                    <strong>çµé­‚æˆé•¿ï¼š</strong>${soulAdvice}</small>`;
        }

        // åˆ†ææ•°å­—å‘½ç†èŒä¸š
        function analyzeNumerologyCareer(life, destiny, soul) {
            const lifeCareer = NUMBER_MEANINGS[life]?.career || '';
            const destinyCareer = NUMBER_MEANINGS[destiny]?.career || '';
            const soulCareer = NUMBER_MEANINGS[soul]?.career || '';
            
            let careers = [];
            let careerTypes = [];
            let developmentPath = '';
            
            if (lifeCareer) careers.push(lifeCareer);
            if (destinyCareer && destinyCareer !== lifeCareer) careers.push(destinyCareer);
            if (soulCareer && !careers.includes(soulCareer)) careers.push(soulCareer);

            if (life <= 3 || destiny <= 3) {
                careerTypes.push('åˆ›æ–°åˆ›æ„ç±»');
            }
            if (life >= 4 && life <= 6 || destiny >= 4 && destiny <= 6) {
                careerTypes.push('ç®¡ç†ç»„ç»‡ç±»');
            }
            if (life >= 7 || destiny >= 7) {
                careerTypes.push('ä¸“ä¸šåˆ†æç±»');
            }

            if (life <= 3 && destiny <= 3) {
                developmentPath = 'é€‚åˆä»åˆ›æ„å²—ä½å¼€å§‹ï¼Œé€æ­¥åŸ¹å…»ç®¡ç†èƒ½åŠ›';
            } else if (life >= 7 && destiny >= 7) {
                developmentPath = 'é€‚åˆä»ä¸“ä¸šå²—ä½å¼€å§‹ï¼Œé€æ­¥åŸ¹å…»é¢†å¯¼èƒ½åŠ›';
            } else if (life >= 4 && life <= 6 && destiny >= 4 && destiny <= 6) {
                developmentPath = 'é€‚åˆä»ç®¡ç†å²—ä½å¼€å§‹ï¼Œé€æ­¥åŸ¹å…»åˆ›æ–°èƒ½åŠ›';
            } else {
                developmentPath = 'é€‚åˆä»ç»¼åˆå²—ä½å¼€å§‹ï¼Œé€æ­¥åŸ¹å…»ä¸“ä¸šèƒ½åŠ›';
            }

            return `<strong>é€‚é…èŒä¸šï¼š</strong>${careers.join('ã€') || 'æ ¹æ®å…´è¶£é€‰æ‹©'}<br>
                    <small><strong>èŒä¸šç±»å‹ï¼š</strong>${careerTypes.join('ã€')}<br>
                    <strong>å‘å±•è·¯å¾„ï¼š</strong>${developmentPath}</small>`;
        }

        // ç”Ÿæˆæ•°å­—å‘½ç†æµ‹è¯•é¢˜
        function generateNumerologyQuiz(life, destiny, soul) {
            const quizContainer = document.getElementById('numerologyQuiz');
            quizContainer.innerHTML = '';

            const questions = [
                {
                    id: 1,
                    question: 'é¢å¯¹æ–°æŒ‘æˆ˜æ—¶ï¼Œä½ æ›´å€¾å‘äºï¼š',
                    options: [
                        { text: 'åˆ¶å®šè¯¦ç»†è®¡åˆ’ï¼ŒæŒ‰æ­¥éª¤æ‰§è¡Œ', score: { S: 1, J: 1, number: { 4: 0.5, 6: 0.5 } } },
                        { text: 'çµæ´»åº”å¯¹ï¼Œéšæœºåº”å˜', score: { N: 1, P: 1, number: { 5: 0.5, 3: 0.5 } } }
                    ]
                },
                {
                    id: 2,
                    question: 'åœ¨å›¢é˜Ÿä¸­ï¼Œä½ æ›´æ„¿æ„æ‰®æ¼”ï¼š',
                    options: [
                        { text: 'é¢†å¯¼è€…ï¼Œåˆ¶å®šæ–¹å‘å’Œç­–ç•¥', score: { E: 1, J: 1, number: { 1: 0.5, 8: 0.5 } } },
                        { text: 'æ”¯æŒè€…ï¼ŒååŠ©ä»–äººå®Œæˆä»»åŠ¡', score: { I: 1, F: 1, number: { 2: 0.5, 6: 0.5 } } }
                    ]
                },
                {
                    id: 3,
                    question: 'è§£å†³é—®é¢˜æ—¶ï¼Œä½ æ›´ä¾èµ–ï¼š',
                    options: [
                        { text: 'é€»è¾‘åˆ†æå’Œæ•°æ®æ”¯æŒ', score: { T: 1, S: 1, number: { 7: 0.5, 4: 0.5 } } },
                        { text: 'ç›´è§‰æ„Ÿå—å’Œåˆ›æ„çµæ„Ÿ', score: { F: 1, N: 1, number: { 3: 0.5, 9: 0.5 } } }
                    ]
                },
                {
                    id: 4,
                    question: 'å¯¹äºè§„åˆ™å’Œä¼ ç»Ÿï¼Œä½ çš„æ€åº¦æ˜¯ï¼š',
                    options: [
                        { text: 'å°Šé‡å¹¶éµå¾ªï¼Œç»´æŠ¤ç§©åº', score: { S: 1, J: 1, number: { 4: 0.5, 6: 0.5 } } },
                        { text: 'çµæ´»è¿ç”¨ï¼Œå¿…è¦æ—¶æ‰“ç ´', score: { N: 1, P: 1, number: { 5: 0.5, 1: 0.5 } } }
                    ]
                },
                {
                    id: 5,
                    question: 'åœ¨ç¤¾äº¤åœºåˆï¼Œä½ æ›´ï¼š',
                    options: [
                        { text: 'ä¸»åŠ¨äº¤æµï¼Œæ‰©å¤§äººè„‰', score: { E: 1, number: { 1: 0.5, 3: 0.5 } } },
                        { text: 'è§‚å¯Ÿå€¾å¬ï¼Œæ·±åº¦äº¤æµ', score: { I: 1, number: { 2: 0.5, 7: 0.5 } } }
                    ]
                }
            ];

            window._numerologyQuestions = questions;

            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'q';
                questionDiv.style.border = '1px solid #e5e7eb';
                questionDiv.style.borderRadius = '12px';
                questionDiv.style.padding = '12px';
                questionDiv.style.marginBottom = '12px';
                questionDiv.innerHTML = `<div style="font-weight:700">${index + 1}. ${q.question}</div>`;
                
                q.options.forEach((option, optIndex) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.style.margin = '6px 0';
                    optionDiv.innerHTML = `<label><input type="radio" name="nq${q.id}" value="${optIndex}"> ${option.text}</label>`;
                    questionDiv.appendChild(optionDiv);
                });
                
                quizContainer.appendChild(questionDiv);
            });

            document.getElementById('numerologyTest').classList.remove('hidden');
        }

        // æäº¤æ•°å­—å‘½ç†æµ‹è¯•
        function submitNumerologyTest() {
            const questions = document.querySelectorAll('#numerologyQuiz .q');
            let scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            let numberScores = {};

            questions.forEach((q, index) => {
                const selected = q.querySelector('input:checked');
                if (selected) {
                    const optionIndex = parseInt(selected.value);
                    const question = window._numerologyQuestions ? window._numerologyQuestions[index] : null;
                    if (question && question.options[optionIndex]) {
                        const option = question.options[optionIndex];
                        Object.entries(option.score).forEach(([key, value]) => {
                            if (key === 'number') {
                                Object.entries(value).forEach(([num, score]) => {
                                    numberScores[num] = (numberScores[num] || 0) + score;
                                });
                            } else {
                                scores[key] = (scores[key] || 0) + value;
                            }
                        });
                    }
                }
            });

            const mbtiType = determineMBTIType(scores);
            const result = `æ•°å­—å‘½ç†MBTIç±»å‹ï¼š${mbtiType}`;
            
            const numberAnalysis = analyzeNumberEnergy(numberScores);
            const resultDiv = document.getElementById('numerologyResult');
            resultDiv.innerHTML = `
                <div style="margin-bottom: 8px;"><strong>æ•°å­—å‘½ç†MBTIç±»å‹ï¼š${mbtiType}</strong></div>
                <div style="font-size: 12px; color: #6b7280;">${numberAnalysis}</div>
            `;

            // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
            showTestResult(mbtiType, scores, numberScores);
        }

        // ç¡®å®šMBTIç±»å‹
        function determineMBTIType(scores) {
            const E = scores.E || 0;
            const I = scores.I || 0;
            const S = scores.S || 0;
            const N = scores.N || 0;
            const T = scores.T || 0;
            const F = scores.F || 0;
            const J = scores.J || 0;
            const P = scores.P || 0;

            const first = E > I ? 'E' : 'I';
            const second = S > N ? 'S' : 'N';
            const third = T > F ? 'T' : 'F';
            const fourth = J > P ? 'J' : 'P';

            return first + second + third + fourth;
        }

        // åˆ†ææ•°å­—èƒ½é‡
        function analyzeNumberEnergy(numberScores) {
            if (Object.keys(numberScores).length === 0) return 'è¯·å®Œæˆæµ‹è¯•é¢˜';
            
            const topNumbers = Object.entries(numberScores)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([num, score]) => `${num}å·èƒ½é‡(${score.toFixed(1)})`);
            
            return `æ•°å­—èƒ½é‡ï¼š${topNumbers.join('ã€')}`;
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResult(mbtiType, scores, numberScores) {
            const resultContent = document.getElementById('resultContent');
            const topNumbers = Object.entries(numberScores)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3);

            let resultHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2 style="color: #4f46e5;">ğŸ¯ ä½ çš„æµ‹è¯•ç»“æœ</h2>
                    <div class="kpi" style="font-size: 32px; margin: 10px 0;">${mbtiType}</div>
                    <p class="muted">åŸºäºæ•°å­—å‘½ç†Ã—MBTIçš„èåˆåˆ†æ</p>
                </div>
                
                <div class="grid">
                    <div class="card numerology">
                        <h4>ğŸ“Š MBTIç»´åº¦å¾—åˆ†</h4>
                        <p><strong>å¤–å‘(E):</strong> ${scores.E || 0} | <strong>å†…å‘(I):</strong> ${scores.I || 0}</p>
                        <p><strong>æ„Ÿè§‰(S):</strong> ${scores.S || 0} | <strong>ç›´è§‰(N):</strong> ${scores.N || 0}</p>
                        <p><strong>æ€è€ƒ(T):</strong> ${scores.T || 0} | <strong>æƒ…æ„Ÿ(F):</strong> ${scores.F || 0}</p>
                        <p><strong>åˆ¤æ–­(J):</strong> ${scores.J || 0} | <strong>æ„ŸçŸ¥(P):</strong> ${scores.P || 0}</p>
                    </div>
                    
                    <div class="card numerology">
                        <h4>ğŸ”¢ æ•°å­—èƒ½é‡åˆ†æ</h4>
                        ${topNumbers.map(([num, score]) => `
                            <p><strong>${num}å·èƒ½é‡:</strong> ${score.toFixed(1)}</p>
                        `).join('')}
                    </div>
                </div>
                
                <div class="card integration" style="margin-top: 20px;">
                    <h4>ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h4>
                    <p>åŸºäºä½ çš„${mbtiType}ç±»å‹å’Œæ•°å­—èƒ½é‡ï¼Œå»ºè®®ï¼š</p>
                    <ul>
                        <li>å‘æŒ¥${mbtiType}ç±»å‹çš„æ ¸å¿ƒä¼˜åŠ¿</li>
                        <li>å…³æ³¨æ•°å­—èƒ½é‡çš„å¹³è¡¡å‘å±•</li>
                        <li>ç»“åˆä¼ ç»Ÿå‘½ç†ä¸ç°ä»£å¿ƒç†å­¦</li>
                        <li>å¯»æ‰¾é€‚åˆè‡ªå·±çš„å‘å±•è·¯å¾„</li>
                    </ul>
                </div>
            `;

            resultContent.innerHTML = resultHTML;
            document.getElementById('testResult').classList.remove('hidden');
        }

        // æ˜¾ç¤ºåŠŸèƒ½ä¿¡æ¯
        function showFeatureInfo(featureType) {
            let message = '';
            let title = '';
            
            switch(featureType) {
                case 'chinese-zodiac':
                    // è·³è½¬åˆ°ç”Ÿè‚–æµ‹è¯•é¡µé¢
                    window.location.href = 'chinese-zodiac-test.html';
                    return;
                case 'numerology':
                    title = 'æ•°å­—å‘½ç†';
                    message = 'æ•°å­—å‘½ç†æµ‹è¯•åŠŸèƒ½å·²å¯ç”¨ï¼\n\né€šè¿‡åˆ†ææ‚¨çš„å‡ºç”Ÿæ—¥æœŸï¼Œç»“åˆMBTIç†è®ºï¼Œä¸ºæ‚¨æä¾›ç‹¬ç‰¹çš„æ€§æ ¼æ´å¯Ÿã€‚';
                    break;
                default:
                    title = 'åŠŸèƒ½ä¿¡æ¯';
                    message = 'è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼';
            }
            
            alert(`${title}\n\n${message}`);
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ•°å­—å‘½ç†Ã—MBTIæµ‹è¯•ç³»ç»Ÿå·²åŠ è½½å®Œæˆï¼');
            console.log('åŠŸèƒ½åŒ…æ‹¬ï¼šç”Ÿå‘½æ•°å­—è®¡ç®—ã€å‘½è¿æ•°å­—åˆ†æã€çµé­‚æ•°å­—è§£è¯»ã€MBTIèåˆåˆ†æç­‰');
        });
    </script>
</body>
</html>
