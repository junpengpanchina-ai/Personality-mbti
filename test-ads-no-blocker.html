<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šæµ‹è¯• - æ— æ‹¦æˆªå™¨ç‰ˆæœ¬</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .ad-container { margin: 20px 0; padding: 20px; border: 2px dashed #ccc; text-align: center; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å¹¿å‘Šæµ‹è¯•é¡µé¢</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•å¹¿å‘ŠåŠŸèƒ½ï¼Œç»•è¿‡å¹¿å‘Šæ‹¦æˆªå™¨ã€‚</p>
        
        <div class="status" id="status">
            <strong>çŠ¶æ€ï¼š</strong> å‡†å¤‡æµ‹è¯•...
        </div>
        
        <div class="ad-container" id="adContainer">
            <h3>å¹¿å‘Šä½æµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æµ‹è¯•å¹¿å‘ŠåŠ è½½ï¼š</p>
            <button class="btn" onclick="testAdSense()">æµ‹è¯• AdSense å¹¿å‘Š</button>
            <button class="btn" onclick="testFallback()">æµ‹è¯• Fallback å¹¿å‘Š</button>
            <button class="btn" onclick="clearAds()">æ¸…é™¤å¹¿å‘Š</button>
        </div>
        
        <div id="adDisplay"></div>
        
        <div class="status" id="log">
            <strong>æ—¥å¿—ï¼š</strong>
            <div id="logContent"></div>
        </div>
    </div>

    <!-- åŠ è½½å¹¿å‘Šè„šæœ¬ -->
    <script src="ad-config.js"></script>
    <script src="ads-manager.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.innerHTML = `<strong>çŠ¶æ€ï¼š</strong> ${message}`;
        }
        
        function testAdSense() {
            log('å¼€å§‹æµ‹è¯• AdSense å¹¿å‘Š...');
            updateStatus('æµ‹è¯• AdSense å¹¿å‘Šä¸­...', 'warning');
            
            if (!window.adManager) {
                log('é”™è¯¯ï¼šadManager æœªåˆå§‹åŒ–', 'error');
                updateStatus('adManager æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            // è®¾ç½®åŒæ„çŠ¶æ€
            localStorage.setItem('adsConsent', 'accepted');
            
            window.adManager.createVideoAd()
                .then(() => {
                    log('AdSense å¹¿å‘Šåˆ›å»ºæˆåŠŸ', 'success');
                    updateStatus('AdSense å¹¿å‘Šåˆ›å»ºæˆåŠŸ', 'success');
                })
                .catch(error => {
                    log(`AdSense å¹¿å‘Šåˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                    updateStatus('AdSense å¹¿å‘Šåˆ›å»ºå¤±è´¥ï¼Œæ˜¾ç¤º Fallback', 'warning');
                    testFallback();
                });
        }
        
        function testFallback() {
            log('æ˜¾ç¤º Fallback å¹¿å‘Š...');
            updateStatus('æ˜¾ç¤º Fallback å¹¿å‘Šä¸­...', 'warning');
            
            const adDisplay = document.getElementById('adDisplay');
            adDisplay.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; color: white;">
                    <div style="text-align: center; padding: 20px;">
                        <h2>ğŸ¯ å“ç‰Œå¹¿å‘Š</h2>
                        <p>è¿™æ˜¯ä¸€ä¸ª 30 ç§’çš„å“ç‰Œå¹¿å‘Š</p>
                        <div id="countdown" style="font-size: 48px; font-weight: bold; color: #10b981; margin: 20px 0;">30</div>
                        <p>æ„Ÿè°¢æ‚¨çš„è€å¿ƒç­‰å¾…</p>
                    </div>
                </div>
            `;
            
            let count = 30;
            const countdown = document.getElementById('countdown');
            const timer = setInterval(() => {
                count--;
                countdown.textContent = count;
                if (count <= 0) {
                    clearInterval(timer);
                    adDisplay.innerHTML = '';
                    log('Fallback å¹¿å‘Šæ’­æ”¾å®Œæˆ', 'success');
                    updateStatus('Fallback å¹¿å‘Šæ’­æ”¾å®Œæˆ', 'success');
                }
            }, 1000);
        }
        
        function clearAds() {
            document.getElementById('adDisplay').innerHTML = '';
            log('å¹¿å‘Šå·²æ¸…é™¤');
            updateStatus('å¹¿å‘Šå·²æ¸…é™¤', 'info');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            
            // ç­‰å¾… adManager åˆå§‹åŒ–
            const checkAdManager = () => {
                if (window.adManager) {
                    log('adManager åˆå§‹åŒ–æˆåŠŸ');
                    updateStatus('adManager åˆå§‹åŒ–æˆåŠŸï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'success');
                } else {
                    setTimeout(checkAdManager, 100);
                }
            };
            checkAdManager();
            
            // æ£€æŸ¥ AdSense è„šæœ¬çŠ¶æ€
            setTimeout(() => {
                if (typeof adsbygoogle !== 'undefined') {
                    log('AdSense è„šæœ¬åŠ è½½æˆåŠŸ');
                } else {
                    log('AdSense è„šæœ¬æœªåŠ è½½ï¼ˆå¯èƒ½è¢«æ‹¦æˆªï¼‰', 'warning');
                }
            }, 2000);
        });
    </script>
</body>
</html>
