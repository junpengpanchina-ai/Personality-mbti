<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿ MBTI æµ‹è¯•</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1f2937;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 24px; }
        .card {
            background: rgba(255,255,255,0.98);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .header { text-align: center; color: #fff; margin: 24px 0; }
        .header h1 { margin: 0 0 8px; font-size: 32px; }
        .header p { margin: 0; opacity: 0.9; }
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 8px 20px rgba(102,126,234,0.35);
            transition: transform 0.15s ease, box-shadow 0.2s ease;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(102,126,234,0.5); }
        .btn:disabled { opacity: .6; cursor: not-allowed; box-shadow: none; }
        .btn-secondary { background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%); box-shadow: 0 8px 20px rgba(100,116,139,0.35); }
        .center { text-align: center; }
        .hidden { display: none; }
        .progress { height: 8px; background: #e5e7eb; border-radius: 999px; overflow: hidden; margin: 12px 0 20px; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #34d399, #10b981); transition: width .25s ease; }
        .q-text { font-size: 20px; color: #111827; margin: 8px 0 12px; }
        .opt { border: 2px solid #e5e7eb; border-radius: 12px; padding: 14px; margin: 10px 0; cursor: pointer; transition: all .15s ease; background: #fff; }
        .opt:hover { border-color: #667eea; box-shadow: 0 6px 18px rgba(102,126,234,0.15); transform: translateY(-1px); }
        .opt.selected { border-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; box-shadow: 0 10px 24px rgba(102,126,234,0.4); }
        .nav { display: flex; justify-content: space-between; gap: 12px; margin-top: 16px; }
        .result-type { font-size: 40px; font-weight: 800; color: #4f46e5; margin: 8px 0 16px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px; }
        .pill { display:inline-block; padding:6px 12px; border-radius:999px; background:#eef2ff; color:#3730a3; font-weight:600; font-size:12px; }
        .muted { color: #6b7280; font-size: 14px; }
        a.link { color: #4f46e5; text-decoration: none; font-weight: 600; }
        a.link:hover { text-decoration: underline; }
        /* æ™ºèƒ½è§£æ */
        .insight { margin-top: 10px; padding: 12px 14px; border-left: 4px solid #10b981; background: #ecfdf5; color: #065f46; border-radius: 10px; box-shadow: 0 6px 16px rgba(16,185,129,0.15); transition: all .2s ease; }
        .insight.fade { opacity: 0; transform: translateY(6px); }
    </style>
    <script>
        // åŸºç¡€é¢˜åº“ï¼ˆ12é¢˜ï¼Œå‡ç­‰è¦†ç›–å››ä¸ªç»´åº¦ï¼‰
        const QUESTIONS = [
            { d: 'EI', t: 'é‡åˆ°æ–°åŒäº‹æ—¶ï¼Œä½ ä¼šï¼š', a: { text: 'ä¸»åŠ¨æ‰“æ‹›å‘¼ï¼Œè¿…é€Ÿç†Ÿç»œ', v: 'E' }, b: { text: 'å…ˆè§‚å¯Ÿä¸€é˜µï¼Œæ…¢æ…¢ç†Ÿæ‚‰', v: 'I' } },
            { d: 'SN', t: 'åšå†³ç­–æ—¶ä½ æ›´çœ‹é‡ï¼š', a: { text: 'ç°å®ç»†èŠ‚ä¸å¯è¡Œæ€§', v: 'S' }, b: { text: 'å¯èƒ½æ€§ä¸é•¿è¿œæ„¿æ™¯', v: 'N' } },
            { d: 'TF', t: 'è®¨è®ºåˆ†æ­§æ—¶ä½ æ›´å…³æ³¨ï¼š', a: { text: 'é€»è¾‘ä¸€è‡´ä¸å®¢è§‚å¯¹é”™', v: 'T' }, b: { text: 'ä»–äººæ„Ÿå—ä¸å…³ç³»å’Œè°', v: 'F' } },
            { d: 'JP', t: 'å¤„ç†äº‹åŠ¡æ—¶ä½ å€¾å‘ï¼š', a: { text: 'æœ‰è®¡åˆ’æœ‰æ¡ç†åœ°æ¨è¿›', v: 'J' }, b: { text: 'å¼¹æ€§å®‰æ’éšæ—¶è°ƒæ•´', v: 'P' } },
            { d: 'EI', t: 'å‘¨æœ«èšä¼šå¯¹ä½ æ¥è¯´ï¼š', a: { text: 'è®©æˆ‘å……ç”µï¼Œè¶Šçƒ­é—¹è¶Šå¥½', v: 'E' }, b: { text: 'éœ€è¦æ¢å¤ï¼Œå®é™æ›´èˆ’æœ', v: 'I' } },
            { d: 'SN', t: 'å­¦ä¹ æ–°æŠ€èƒ½æ—¶ä½ ï¼š', a: { text: 'å…ˆä»æ­¥éª¤/æ•™ç¨‹å¼€å§‹', v: 'S' }, b: { text: 'å…ˆç†è§£åŸç†å†ä¸Šæ‰‹', v: 'N' } },
            { d: 'TF', t: 'è¯„ä¼°æ–¹æ¡ˆä¼˜åŠ£æ—¶ä½ ï¼š', a: { text: 'åˆ—æ ‡å‡†ç®—åˆ©å¼Š', v: 'T' }, b: { text: 'ä½“ä¼šå½±å“ä¸ä»·å€¼è§‚', v: 'F' } },
            { d: 'JP', t: 'æ—…è¡Œå‰çš„å‡†å¤‡ï¼š', a: { text: 'å®Œæ•´è¡Œç¨‹æ¸…å•', v: 'J' }, b: { text: 'æœºåŠ¨éšèµ°éšçœ‹', v: 'P' } },
            { d: 'EI', t: 'å¼€ä¼šæ—¶ä½ æ›´å¸¸ï¼š', a: { text: 'å‘è¨€æ¨åŠ¨æ°”æ°›', v: 'E' }, b: { text: 'å€¾å¬å‡ç»ƒè§‚ç‚¹', v: 'I' } },
            { d: 'SN', t: 'é‡åˆ°é—®é¢˜ä½ å…ˆï¼š', a: { text: 'æŸ¥è¯äº‹å®é€é¡¹æ’æŸ¥', v: 'S' }, b: { text: 'ç›´è§‰åˆ¤æ–­å®šä½å…³é”®', v: 'N' } },
            { d: 'TF', t: 'æ”¶åˆ°åé¦ˆä½ å¸Œæœ›ï¼š', a: { text: 'ç›´æ¥å…·ä½“ã€å¯æ‰§è¡Œ', v: 'T' }, b: { text: 'å§”å©‰é¼“åŠ±ã€é¡¾æƒ…ç»ª', v: 'F' } },
            { d: 'JP', t: 'é¢å¯¹æˆªæ­¢æœŸä½ é€šå¸¸ï¼š', a: { text: 'æå‰å®Œæˆç•™ä½™åœ°', v: 'J' }, b: { text: 'ä¸´è¿‘æˆªç‚¹æ•ˆç‡æ›´é«˜', v: 'P' } }
        ];

        let currentIndex = -1;
        let selections = Array(QUESTIONS.length).fill(null);

        const scores = { E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0 };
        let autoAdvanceTimer = null;

        // ç»´åº¦æ™ºèƒ½è§£æ
        const INSIGHT = {
            EI: {
                E: 'ä½ åå‘å¤–å‘(E)ï¼šä»äº’åŠ¨ä¸­è·å¾—èƒ½é‡ï¼Œä¸»åŠ¨è¡¨è¾¾æœ‰åŠ©äºæ¨åŠ¨åä½œã€‚',
                I: 'ä½ åå‘å†…å‘(I)ï¼šç‹¬ç«‹æ€è€ƒæ›´é«˜æ•ˆï¼Œæ²‰æ·€åè¡¨è¾¾å¸¸æ›´æœ‰è´¨é‡ã€‚'
            },
            SN: {
                S: 'ä½ åå‘æ„Ÿè§‰(S)ï¼šé‡è§†äº‹å®ä¸ç»†èŠ‚ï¼Œæ‰§è¡Œä¸è½åœ°ä¼˜åŠ¿æ˜æ˜¾ã€‚',
                N: 'ä½ åå‘ç›´è§‰(N)ï¼šå–„äºæŠ½è±¡ä¸è”æƒ³ï¼Œæ“…é•¿æ´å¯Ÿè¶‹åŠ¿ä¸å¯èƒ½æ€§ã€‚'
            },
            TF: {
                T: 'ä½ åå‘æ€è€ƒ(T)ï¼šè®²æ±‚é€»è¾‘ä¸æ ‡å‡†ï¼Œå†³ç­–æ¸…æ™°è€Œä¸€è‡´ã€‚',
                F: 'ä½ åå‘æƒ…æ„Ÿ(F)ï¼šå…³æ³¨äººå’Œå…³ç³»ï¼Œæ“…é•¿è¥é€ ä¿¡ä»»ä¸å‡èšåŠ›ã€‚'
            },
            JP: {
                J: 'ä½ åå‘åˆ¤æ–­(J)ï¼šè®¡åˆ’æ˜ç¡®ã€æ¡ç†åˆ†æ˜ï¼Œè¿›åº¦å¯æ§ã€‚',
                P: 'ä½ åå‘æ„ŸçŸ¥(P)ï¼šçµæ´»æœºåŠ¨ã€é€‚åº”å˜åŒ–ï¼Œä¿ç•™æ¢ç´¢ç©ºé—´ã€‚'
            }
        };

        // æ˜Ÿåº§çŸ¥è¯†åº“ï¼ˆåŸºäºå¸¸è§æ€§æ ¼ç”»åƒï¼Œä½œä¸ºå¾®å¼±åç½®å‚ä¸è®¡ç®—ï¼‰
        // è¯´æ˜ï¼šä»¥ä¸‹å€¾å‘ä»…ä½œè¶£å‘³æ€§å¢å¼ºï¼Œéä¸¥æ ¼ç§‘å­¦ç»“è®ºã€‚
        const ZODIAC_KB = {
            aries: { key: 'aries', cn: 'ç™½ç¾Šåº§', weights: { E: 0.8, I: 0.0, S: 0.0, N: 0.6, T: 0.4, F: 0.0, J: 0.0, P: 0.6 }, traits: 'è¡ŒåŠ¨åŠ›å¼ºã€ç›´æ¥ç›´å¾€ã€åå‘ç›´è§‰ä¸æ¢ç´¢ã€‚' },
            taurus: { key: 'taurus', cn: 'é‡‘ç‰›åº§', weights: { E: 0.0, I: 0.4, S: 0.8, N: 0.0, T: 0.4, F: 0.2, J: 0.8, P: 0.0 }, traits: 'åŠ¡å®ç¨³å®šã€é‡è§†ç»†èŠ‚ä¸ç§©åºï¼Œè¡ŒåŠ¨ç¨³å¥ã€‚' },
            gemini: { key: 'gemini', cn: 'åŒå­åº§', weights: { E: 0.6, I: 0.0, S: 0.0, N: 0.8, T: 0.3, F: 0.0, J: 0.0, P: 0.8 }, traits: 'å¥½å¥‡å¤šå˜ã€æ²Ÿé€šæ¬²å¼ºã€åå‘å¼€æ”¾å’Œçµæ´»ã€‚' },
            cancer: { key: 'cancer', cn: 'å·¨èŸ¹åº§', weights: { E: 0.0, I: 0.6, S: 0.4, N: 0.0, T: 0.0, F: 0.9, J: 0.5, P: 0.0 }, traits: 'å…±æƒ…ç»†è…»ã€é‡è§†å®‰å…¨ä¸å…³ç³»ï¼Œåæƒ…æ„Ÿä¸å†…æ•›ã€‚' },
            leo: { key: 'leo', cn: 'ç‹®å­åº§', weights: { E: 0.9, I: 0.0, S: 0.0, N: 0.6, T: 0.2, F: 0.4, J: 0.5, P: 0.0 }, traits: 'è‡ªä¿¡å¤–æ”¾ã€æ„¿æ„æ‹…å½“ï¼Œé‡è§†æ„¿æ™¯ä¸å½±å“åŠ›ã€‚' },
            virgo: { key: 'virgo', cn: 'å¤„å¥³åº§', weights: { E: 0.0, I: 0.5, S: 0.8, N: 0.0, T: 0.7, F: 0.0, J: 0.9, P: 0.0 }, traits: 'ä¸¥è°¨æŒ‘å‰”ã€æ³¨é‡æ ‡å‡†ä¸ç»†èŠ‚ï¼Œè¿½æ±‚ç§©åºã€‚' },
            libra: { key: 'libra', cn: 'å¤©ç§¤åº§', weights: { E: 0.4, I: 0.0, S: 0.0, N: 0.5, T: 0.0, F: 0.7, J: 0.0, P: 0.4 }, traits: 'æ“…é•¿åè°ƒã€è¿½æ±‚å¹³è¡¡ï¼Œåäººé™…ä¸ç¾æ„Ÿã€‚' },
            scorpio: { key: 'scorpio', cn: 'å¤©èåº§', weights: { E: 0.0, I: 0.7, S: 0.0, N: 0.8, T: 0.7, F: 0.0, J: 0.6, P: 0.0 }, traits: 'æ´å¯Ÿæ·±å…¥ã€ç›®æ ‡ä¸“æ³¨ï¼Œé‡é€»è¾‘ä¸æŒæ§æ„Ÿã€‚' },
            sagittarius: { key: 'sagittarius', cn: 'å°„æ‰‹åº§', weights: { E: 0.7, I: 0.0, S: 0.0, N: 0.9, T: 0.4, F: 0.0, J: 0.0, P: 0.9 }, traits: 'çƒ­çˆ±è‡ªç”±ã€è¿œè§ä¹è§‚ï¼Œåæ¢ç´¢ä¸å¼€æ”¾ã€‚' },
            capricorn: { key: 'capricorn', cn: 'æ‘©ç¾¯åº§', weights: { E: 0.0, I: 0.6, S: 0.7, N: 0.0, T: 0.8, F: 0.0, J: 0.9, P: 0.0 }, traits: 'åŠ¡å®è‡ªå¾‹ã€ç»“æœå¯¼å‘ï¼Œåç†æ€§ä¸ç»“æ„ã€‚' },
            aquarius: { key: 'aquarius', cn: 'æ°´ç“¶åº§', weights: { E: 0.0, I: 0.5, S: 0.0, N: 0.9, T: 0.8, F: 0.0, J: 0.0, P: 0.6 }, traits: 'ç‹¬ç«‹åˆ›æ–°ã€å‰ç»åå›ï¼Œåç†å¿µä¸è‡ªç”±ã€‚' },
            pisces: { key: 'pisces', cn: 'åŒé±¼åº§', weights: { E: 0.0, I: 0.6, S: 0.0, N: 0.7, T: 0.0, F: 0.9, J: 0.0, P: 0.7 }, traits: 'æµªæ¼«å…±æƒ…ã€æƒ³è±¡ä¸°å¯Œï¼Œåç›´è§‰ä¸æ„Ÿå—ã€‚' }
        };

        // å æ˜Ÿæ‰©å±•çŸ¥è¯†åº“ï¼ˆå…ƒç´ ã€æ¨¡å¼ã€å®ˆæŠ¤æ˜Ÿã€åŸå‹ï¼‰ï¼Œç”¨äºæ˜Ÿåº§Ã—MBTIè§£è¯»
        const ZODIAC_META = {
            aries:      { element:'ç«', modality:'æœ¬ä½', rulers:['ç«æ˜Ÿ'], archetype:'æˆ˜å£«/å¼€æ‹“è€…', keywords:['å†²åŠ²','ç›´ç‡','é¢†å¯¼','å†’é™©'] },
            taurus:     { element:'åœŸ', modality:'å›ºå®š', rulers:['é‡‘æ˜Ÿ'], archetype:'å»ºé€ è€…/æ„Ÿå®˜äº«å—', keywords:['ç¨³å®š','åŠ¡å®','ä»·å€¼','è€å¿ƒ'] },
            gemini:     { element:'é£', modality:'å˜åŠ¨', rulers:['æ°´æ˜Ÿ'], archetype:'ä¿¡ä½¿/å­¦ä¹ è€…', keywords:['ä¿¡æ¯','è¿æ¥','æœºæ™º','å¤šå˜'] },
            cancer:     { element:'æ°´', modality:'æœ¬ä½', rulers:['æœˆäº®'], archetype:'å®ˆæŠ¤è€…/æ»‹å…»è€…', keywords:['æƒ…æ„Ÿ','å®‰å…¨','å®¶åº­','è®°å¿†'] },
            leo:        { element:'ç«', modality:'å›ºå®š', rulers:['å¤ªé˜³'], archetype:'åˆ›é€ è€…/ç‹è€…', keywords:['è‡ªæˆ‘è¡¨è¾¾','è£èª‰','èˆå°','æ…·æ…¨'] },
            virgo:      { element:'åœŸ', modality:'å˜åŠ¨', rulers:['æ°´æ˜Ÿ'], archetype:'åŒ äºº/åˆ†æè€…', keywords:['ç»†èŠ‚','ä¿®æ­£','æœåŠ¡','æ•ˆç‡'] },
            libra:      { element:'é£', modality:'æœ¬ä½', rulers:['é‡‘æ˜Ÿ'], archetype:'è°ƒå’Œè€…/å®¡ç¾è€…', keywords:['å…³ç³»','å¹³è¡¡','å…¬æ­£','å®¡ç¾'] },
            scorpio:    { element:'æ°´', modality:'å›ºå®š', rulers:['ç«æ˜Ÿ','å†¥ç‹æ˜Ÿ'], archetype:'è½¬åŒ–è€…/ä¾¦æ¢', keywords:['æ·±åº¦','æ§åˆ¶','æ²‰æ½œ','é‡ç”Ÿ'] },
            sagittarius:{ element:'ç«', modality:'å˜åŠ¨', rulers:['æœ¨æ˜Ÿ'], archetype:'æ¢æ±‚è€…/å“²äºº', keywords:['è¿œè§','è‡ªç”±','çœŸç†','æ—…è¡Œ'] },
            capricorn:  { element:'åœŸ', modality:'æœ¬ä½', rulers:['åœŸæ˜Ÿ'], archetype:'æ”€ç™»è€…/ç®¡ç†è€…', keywords:['ç»“æ„','è´£ä»»','é•¿æœŸ','æƒå¨'] },
            aquarius:   { element:'é£', modality:'å›ºå®š', rulers:['åœŸæ˜Ÿ','å¤©ç‹æ˜Ÿ'], archetype:'é©æ–°è€…/å¼‚ç±»', keywords:['ç†å¿µ','å¹³ç­‰','æœªæ¥','ç‹¬ç«‹'] },
            pisces:     { element:'æ°´', modality:'å˜åŠ¨', rulers:['æœ¨æ˜Ÿ','æµ·ç‹æ˜Ÿ'], archetype:'è¯—äºº/ç¥ç§˜è€…', keywords:['æƒ³è±¡','å…±æƒ…','çµæ€§','èåˆ'] }
        };

        function getTemperament(mbti){
            const s = mbti || '';
            const hasS = s[1] === 'S';
            const hasN = s[1] === 'N';
            const hasT = s[2] === 'T';
            const hasF = s[2] === 'F';
            if (hasS && s[3] === 'J') return 'SJ';
            if (hasS && s[3] === 'P') return 'SP';
            if (hasN && hasF) return 'NF';
            if (hasN && hasT) return 'NT';
            return 'Mixed';
        }

        function buildZodiacMbtiInsight(mbtiType, signKey){
            const meta = ZODIAC_META[signKey];
            if (!meta) return '';
            const temper = getTemperament(mbtiType);
            const e = meta.element; // ç«åœŸé£æ°´
            const m = meta.modality; // æœ¬ä½å›ºå®šå˜åŠ¨

            // å…ƒç´ Ã—æ°”è´¨ç®€è¯„
            const elementFitMap = {
                'ç«': { fit: ['E','N','P'], tip: 'è¡ŒåŠ¨/æ„¿æ™¯/å°æ–°' },
                'åœŸ': { fit: ['S','J','T'], tip: 'ç»“æ„/åŠ¡å®/å¯æŒç»­' },
                'é£': { fit: ['E','N','T','P'], tip: 'äº¤æµ/ç†å¿µ/çµæ´»' },
                'æ°´': { fit: ['I','N','F'], tip: 'æƒ…æ„Ÿ/å…±é¸£/æƒ³è±¡' }
            };
            const modalityFitMap = {
                'æœ¬ä½': { fit: ['J','E'], tip: 'å¯åŠ¨/å¸¦å¤´/å®šç›®æ ‡' },
                'å›ºå®š': { fit: ['J','T','I'], tip: 'ä¸“æ³¨/ç¨³å›º/æŠ—å¹²æ‰°' },
                'å˜åŠ¨': { fit: ['P','N'], tip: 'é€‚åº”/å¤šå˜/æ¢ç´¢' }
            };
            const ef = elementFitMap[e] || { fit: [], tip: '' };
            const mf = modalityFitMap[m] || { fit: [], tip: '' };

            const matches = (need) => need.filter(ch => mbtiType.includes(ch));
            const eMatch = matches(ef.fit);
            const mMatch = matches(mf.fit);

            // æ°”è´¨æè¿°
            const temperDesc = {
                SJ: 'ç§©åºä¸è´£ä»»ï¼ˆå®ˆæŠ¤è€…ï¼‰',
                SP: 'ä½“éªŒä¸å®æ“ï¼ˆå·¥åŒ /ç©å®¶ï¼‰',
                NF: 'æ„ä¹‰ä¸å…³ç³»ï¼ˆç†æƒ³ä¸»ä¹‰è€…ï¼‰',
                NT: 'é€»è¾‘ä¸ç³»ç»Ÿï¼ˆç†æ€§ä¸»ä¹‰è€…ï¼‰',
                Mixed: 'å¤šå…ƒå–å‘ï¼ˆæ··åˆå€¾å‘ï¼‰'
            }[temper];

            const ruler = (ZODIAC_META[signKey].rulers || []).join('ã€');
            const keywords = (ZODIAC_META[signKey].keywords || []).join('ã€');

            return `
                <div class="card">
                    <div class="pill">æ˜Ÿåº§Ã—MBTI äº¤å‰æ´å¯Ÿ</div>
                    <p class="muted" style="margin-top:6px">å…ƒç´ ï¼š${e}ï½œæ¨¡å¼ï¼š${m}ï½œå®ˆæŠ¤æ˜Ÿï¼š${ruler}</p>
                    <div class="grid">
                        <div class="card">
                            <div class="pill">å…ƒç´ ååŒ</div>
                            <p class="muted">ä¸ä½ çš„ç±»å‹(${mbtiType})çš„åŒ¹é…ç‚¹ï¼š${eMatch.join('ã€') || 'â€”'}ã€‚å€¾å‘ï¼š${ef.tip}</p>
                        </div>
                        <div class="card">
                            <div class="pill">æ¨¡å¼ååŒ</div>
                            <p class="muted">ä¸ä½ çš„ç±»å‹(${mbtiType})çš„åŒ¹é…ç‚¹ï¼š${mMatch.join('ã€') || 'â€”'}ã€‚å€¾å‘ï¼š${mf.tip}</p>
                        </div>
                        <div class="card">
                            <div class="pill">æ°”è´¨æ˜ å°„</div>
                            <p class="muted">ä½ çš„MBTIæ°”è´¨ï¼š${temperDesc}ï¼›æ˜Ÿåº§å…³é”®è¯ï¼š${keywords || 'â€”'}</p>
                        </div>
                    </div>
                    <p class="muted" style="margin-top:6px">æç¤ºï¼šè¯¥è§£è¯»åŸºäºå æ˜Ÿï¼ˆå…ƒç´ /æ¨¡å¼/å®ˆæŠ¤æ˜Ÿï¼‰ä¸MBTIæ°”è´¨çš„å¯å‘å¼æ˜ å°„ï¼Œä¾›è‡ªæˆ‘æ¢ç´¢å‚è€ƒã€‚</p>
                </div>
            `;
        }

        let selectedSign = null;

        function $(sel){ return document.querySelector(sel); }

        function show(section){
            ['#welcome','#testing','#result'].forEach(id=>$(id).classList.add('hidden'));
            $(section).classList.remove('hidden');
        }

        function startTest(){
            const sel = document.getElementById('signSelect');
            selectedSign = sel ? sel.value : null;
            if (!selectedSign) {
                alert('è¯·å…ˆé€‰æ‹©ä½ çš„æ˜Ÿåº§');
                return;
            }
            currentIndex = 0;
            selections.fill(null);
            Object.keys(scores).forEach(k => scores[k] = 0);
            renderQuestion();
            show('#testing');
        }

        function renderQuestion(){
            // æ¸…ç†è‡ªåŠ¨å‰è¿›
            if (autoAdvanceTimer) { clearTimeout(autoAdvanceTimer); autoAdvanceTimer = null; }
            const q = QUESTIONS[currentIndex];
            $('#qText').textContent = `${currentIndex+1}. ${q.t}`;
            const opts = $('#opts');
            opts.innerHTML = '';
            [q.a, q.b].forEach((opt, idx) => {
                const div = document.createElement('div');
                div.className = 'opt' + (selections[currentIndex] === opt.v ? ' selected' : '');
                div.setAttribute('role','button');
                div.tabIndex = 0;
                div.innerHTML = `${opt.text}`;
                div.onclick = () => selectOption(opt.v, q.d);
                div.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectOption(opt.v); } };
                opts.appendChild(div);
            });
            $('#prevBtn').disabled = currentIndex === 0;
            $('#nextBtn').textContent = currentIndex === QUESTIONS.length - 1 ? 'æäº¤' : 'ä¸‹ä¸€é¢˜';
            $('#nextBtn').disabled = selections[currentIndex] == null;
            const pct = Math.round(((currentIndex) / QUESTIONS.length) * 100);
            $('#pbar').style.width = `${pct}%`;
            $('#ptext').textContent = `${currentIndex}/${QUESTIONS.length}`;
            // éšè—è§£æ
            const ins = $('#insight');
            if (ins) { ins.classList.add('hidden'); ins.textContent=''; }
        }

        function selectOption(val, dim){
            selections[currentIndex] = val;
            // é«˜äº®é€‰é¡¹
            const opts = $('#opts').children;
            Array.from(opts).forEach(el => el.classList.remove('selected'));
            const chosen = Array.from(opts).find(el => el.textContent.trim());
            // å±•ç¤ºæ™ºèƒ½è§£æ
            showInsight(dim || QUESTIONS[currentIndex].d, val);
            // å¯ç”¨ä¸‹ä¸€é¢˜æŒ‰é’®
            $('#nextBtn').disabled = false;
            // è‡ªåŠ¨å‰è¿›ï¼ˆå»¶è¿Ÿ 600msï¼‰
            if (autoAdvanceTimer) clearTimeout(autoAdvanceTimer);
            autoAdvanceTimer = setTimeout(() => { next(); }, 600);
        }

        function showInsight(dim, v){
            const ins = $('#insight');
            if (!ins) return;
            const explain = INSIGHT[dim]?.[v] || '';
            // å½“å‰ç»´åº¦å®æ—¶å¯¹æ¯”
            const mapDim = { EI:['E','I'], SN:['S','N'], TF:['T','F'], JP:['J','P'] };
            const [a,b] = mapDim[dim] || [];
            let aCnt = 0, bCnt = 0, aTot=0;
            QUESTIONS.forEach((q, i) => {
                if (q.d !== dim) return;
                aTot++;
                const sel = selections[i];
                if (sel === a) aCnt++;
                else if (sel === b) bCnt++;
            });
            const aPct = aTot? Math.round(100*aCnt/aTot):0;
            const bPct = aTot? Math.round(100*bCnt/aTot):0;
            const label = {
                EI: ['å¤–å‘ E','å†…å‘ I'],
                SN: ['æ„Ÿè§‰ S','ç›´è§‰ N'],
                TF: ['æ€è€ƒ T','æƒ…æ„Ÿ F'],
                JP: ['åˆ¤æ–­ J','æ„ŸçŸ¥ P']
            }[dim] || [a,b];

            ins.innerHTML = `${explain}<br><span class="muted">å½“å‰ç»´åº¦å€¾å‘ï¼š${label[0]} ${aPct}% Â· ${label[1]} ${bPct}%</span>`;
            ins.classList.remove('hidden','fade');
            // æ¸éšæ•ˆæœï¼ˆä¸é˜»ç¢å‰è¿›ï¼‰
            setTimeout(()=> ins.classList.add('fade'), 1200);
            setTimeout(()=> { ins.classList.add('hidden'); ins.classList.remove('fade'); }, 1700);
        }

        function next(){
            if (selections[currentIndex] == null) return;
            if (currentIndex === QUESTIONS.length - 1) { submit(); return; }
            if (autoAdvanceTimer) { clearTimeout(autoAdvanceTimer); autoAdvanceTimer = null; }
            currentIndex += 1;
            renderQuestion();
        }

        function prev(){
            if (currentIndex === 0) return;
            if (autoAdvanceTimer) { clearTimeout(autoAdvanceTimer); autoAdvanceTimer = null; }
            currentIndex -= 1;
            renderQuestion();
        }

        function submit(){
            // ç´¯è®¡åˆ†æ•°
            Object.keys(scores).forEach(k => scores[k] = 0);
            selections.forEach((val, i) => { if (val) scores[val] += 1; });
            const getPair = (a,b) => scores[a] >= scores[b] ? a : b;
            const type = [ getPair('E','I'), getPair('S','N'), getPair('T','F'), getPair('J','P') ].join('');

            // ç™¾åˆ†æ¯”ï¼ˆç›¸å¯¹äºè¯¥ç»´åº¦é¢˜ç›®æ•°é‡ï¼‰
            const countByDim = { EI:0, SN:0, TF:0, JP:0 };
            QUESTIONS.forEach(q => countByDim[q.d] += 1);
            const pct = {
                E: Math.round(100 * scores.E / countByDim.EI),
                I: Math.round(100 * scores.I / countByDim.EI),
                S: Math.round(100 * scores.S / countByDim.SN),
                N: Math.round(100 * scores.N / countByDim.SN),
                T: Math.round(100 * scores.T / countByDim.TF),
                F: Math.round(100 * scores.F / countByDim.TF),
                J: Math.round(100 * scores.J / countByDim.JP),
                P: Math.round(100 * scores.P / countByDim.JP)
            };

            // æ˜Ÿåº§å¢å¼ºï¼šå°†æ˜Ÿåº§å€¾å‘ä½œä¸ºå¾®å¼±æƒé‡å‚ä¸å››ä¸ªç»´åº¦çš„æœ€ç»ˆåˆ¤å®š
            const sign = ZODIAC_KB[selectedSign];
            const zw = sign ? sign.weights : { E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0 };
            const weightedWinner = (a, b, dimCount) => {
                const aScore = scores[a] + (zw[a] || 0);
                const bScore = scores[b] + (zw[b] || 0);
                if (aScore === bScore) {
                    // å¹³åˆ†æ—¶ä»¥æ˜Ÿåº§æƒé‡å ä¼˜ä¸ºå‡†ï¼›ä»ç›¸ç­‰åˆ™å›è½åˆ°åŸå§‹å¾—åˆ†ï¼Œå†ä»ç›¸ç­‰é»˜è®¤å‰è€…
                    if ((zw[a] || 0) !== (zw[b] || 0)) return (zw[a] || 0) > (zw[b] || 0) ? a : b;
                    return scores[a] >= scores[b] ? a : b;
                }
                return aScore > bScore ? a : b;
            };
            const zType = [
                weightedWinner('E','I', countByDim.EI),
                weightedWinner('S','N', countByDim.SN),
                weightedWinner('T','F', countByDim.TF),
                weightedWinner('J','P', countByDim.JP)
            ].join('');

            // æ¸²æŸ“ç»“æœ
            $('#type').textContent = type;
            $('#ztype').textContent = zType;
            $('#zsummary').innerHTML = sign ? `${sign.cn} Â· ${sign.traits}` : '';
            // æ˜Ÿåº§Ã—MBTIäº¤å‰æ´å¯Ÿ
            const zmbtiHtml = selectedSign ? buildZodiacMbtiInsight(zType || type, selectedSign) : '';
            const zBias = sign ? `
                <div class="grid">
                    <div class="card"><div class="pill">æ˜Ÿåº§å€¾å‘ Â· å¤–å‘ E / å†…å‘ I</div><p class="muted">E +${(zw.E||0).toFixed(1)} Â· I +${(zw.I||0).toFixed(1)}</p></div>
                    <div class="card"><div class="pill">æ˜Ÿåº§å€¾å‘ Â· æ„Ÿè§‰ S / ç›´è§‰ N</div><p class="muted">S +${(zw.S||0).toFixed(1)} Â· N +${(zw.N||0).toFixed(1)}</p></div>
                    <div class="card"><div class="pill">æ˜Ÿåº§å€¾å‘ Â· æ€è€ƒ T / æƒ…æ„Ÿ F</div><p class="muted">T +${(zw.T||0).toFixed(1)} Â· F +${(zw.F||0).toFixed(1)}</p></div>
                    <div class="card"><div class="pill">æ˜Ÿåº§å€¾å‘ Â· åˆ¤æ–­ J / æ„ŸçŸ¥ P</div><p class="muted">J +${(zw.J||0).toFixed(1)} Â· P +${(zw.P||0).toFixed(1)}</p></div>
                </div>` : '';

            $('#breakdown').innerHTML = `
                <div class="grid">
                    <div class="card"><div class="pill">å¤–å‘ E / å†…å‘ I</div><p class="muted">E ${pct.E}% Â· I ${pct.I}%</p></div>
                    <div class="card"><div class="pill">æ„Ÿè§‰ S / ç›´è§‰ N</div><p class="muted">S ${pct.S}% Â· N ${pct.N}%</p></div>
                    <div class="card"><div class="pill">æ€è€ƒ T / æƒ…æ„Ÿ F</div><p class="muted">T ${pct.T}% Â· F ${pct.F}%</p></div>
                    <div class="card"><div class="pill">åˆ¤æ–­ J / æ„ŸçŸ¥ P</div><p class="muted">J ${pct.J}% Â· P ${pct.P}%</p></div>
                </div>
                <div style="margin-top:12px"></div>
                ${zBias}
                <div style="margin-top:12px"></div>
                ${zmbtiHtml}
            `;

            show('#result');
        }

        function restart(){
            currentIndex = -1;
            selections.fill(null);
            Object.keys(scores).forEach(k => scores[k] = 0);
            show('#welcome');
        }
    </script>
    <link rel="icon" href="data:,">
    <meta name="color-scheme" content="light dark">
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ğŸ§  å¿«é€Ÿ MBTI æµ‹è¯•</h1>
            <p>çº¦ 3-5 åˆ†é’Ÿ Â· 12 é¢˜ Â· æœ¬åœ°è®¡ç®—ï¼Œä¸ä¸Šä¼ ä»»ä½•æ•°æ®</p>
        </div>
    </div>

    <div class="container">
        <!-- æ¬¢è¿é¡µ -->
        <div id="welcome" class="card">
            <h2 class="center" style="margin-top:0">å¼€å§‹ä¹‹å‰</h2>
            <p class="muted">
                æ ¹æ®ä½ çš„åå¥½åœ¨ä¸¤é¡¹ä¸­æ‹©ä¸€ã€‚è¯·å‡­ç¬¬ä¸€ååº”ä½œç­”ï¼Œæ²¡æœ‰æ­£ç¡®æˆ–é”™è¯¯çš„é€‰é¡¹ã€‚
            </p>
            <div style="margin-top:12px">
                <label for="signSelect" class="muted">é€‰æ‹©ä½ çš„æ˜Ÿåº§ï¼ˆç”¨äºæ˜Ÿåº§å¢å¼ºç‰ˆ MBTIï¼‰ï¼š</label>
                <div>
                    <select id="signSelect" style="margin-top:6px; width:100%; padding:10px; border-radius:10px; border:1px solid #e5e7eb;">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="aries">ç™½ç¾Šåº§</option>
                        <option value="taurus">é‡‘ç‰›åº§</option>
                        <option value="gemini">åŒå­åº§</option>
                        <option value="cancer">å·¨èŸ¹åº§</option>
                        <option value="leo">ç‹®å­åº§</option>
                        <option value="virgo">å¤„å¥³åº§</option>
                        <option value="libra">å¤©ç§¤åº§</option>
                        <option value="scorpio">å¤©èåº§</option>
                        <option value="sagittarius">å°„æ‰‹åº§</option>
                        <option value="capricorn">æ‘©ç¾¯åº§</option>
                        <option value="aquarius">æ°´ç“¶åº§</option>
                        <option value="pisces">åŒé±¼åº§</option>
                    </select>
                </div>
                <p class="muted" style="margin-top:6px">è¯´æ˜ï¼šæ˜Ÿåº§åªä½œä¸ºè½»æƒé‡å‚ä¸åˆ¤å®šï¼Œç”¨äºåœ¨åˆ†æ•°æ¥è¿‘æ—¶æä¾›åå‘ä¸è§£é‡Šã€‚</p>
            </div>
            <div class="center" style="margin-top:16px">
                <button class="btn" type="button" onclick="startTest()">å¼€å§‹æµ‹è¯•</button>
                <a class="link" href="index.html" style="margin-left:12px">è¿”å›é¦–é¡µ</a>
            </div>
        </div>

        <!-- æµ‹è¯•é¡µ -->
        <div id="testing" class="card hidden">
            <div class="progress"><div id="pbar" class="progress-bar"></div></div>
            <div class="muted" id="ptext">0/12</div>
            <div id="qText" class="q-text">é¢˜å¹²</div>
            <div id="insight" class="insight hidden"></div>
            <div id="opts"></div>
            <div class="nav">
                <button id="prevBtn" class="btn btn-secondary" type="button" onclick="prev()">ä¸Šä¸€é¢˜</button>
                <button id="nextBtn" class="btn" type="button" onclick="next()">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <!-- ç»“æœé¡µ -->
        <div id="result" class="card hidden">
            <div class="center">
                <div class="pill">ä½ çš„ MBTI ç±»å‹</div>
                <div id="type" class="result-type">XXXX</div>
                <p class="muted">ä¸‹é¢æ˜¯å››ä¸ªç»´åº¦çš„åˆ†å¸ƒæƒ…å†µï¼š</p>
                <div style="margin-top:8px"></div>
                <div class="pill">æ˜Ÿåº§å¢å¼ºç±»å‹</div>
                <div id="ztype" class="result-type" style="font-size:28px; color:#10b981">XXXX</div>
                <div id="zsummary" class="muted" style="margin-top:6px"></div>
            </div>
            <div id="breakdown" style="margin-top:12px"></div>
            <div class="center" style="margin-top:16px">
                <button class="btn" type="button" onclick="restart()">é‡æ–°æµ‹è¯•</button>
                <a class="link" href="index.html" style="margin-left:12px">è¿”å›é¦–é¡µ</a>
            </div>
        </div>
    </div>
</body>
</html>


