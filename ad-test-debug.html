<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdSense 广告测试调试页面</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .console-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 AdSense 广告测试调试页面</h1>
        
        <div id="status" class="status info">准备测试广告功能...</div>
        
        <h2>测试步骤</h2>
        <ol>
            <li>点击"检查配置"验证广告配置</li>
            <li>点击"测试同意条"显示同意弹窗</li>
            <li>点击"测试视频广告"显示视频广告</li>
            <li>点击"测试fallback"显示fallback插屏</li>
        </ol>
        
        <div>
            <button class="btn" onclick="checkConfig()">检查配置</button>
            <button class="btn" onclick="testConsent()">测试同意条</button>
            <button class="btn" onclick="testVideoAd()">测试视频广告</button>
            <button class="btn" onclick="testFallback()">测试Fallback</button>
            <button class="btn" onclick="clearConsole()">清空控制台</button>
        </div>
        
        <div id="console-output" class="console-output">
            <div>AdSense 广告测试调试页面已加载</div>
            <div>点击上面的按钮开始测试</div>
        </div>
    </div>

    <!-- 加载广告配置和脚本 -->
    <script src="ad-config.js"></script>
    <script src="ads-manager.js"></script>
    
    <script>
        // 重写 console.log 以显示在页面上
        const originalLog = console.log;
        const consoleOutput = document.getElementById('console-output');
        const statusElement = document.getElementById('status');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.innerHTML += `<div>${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        function updateStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function checkConfig() {
            console.log('🔍 检查广告配置...');
            
            // 检查 AdSense 脚本
            const adsenseLoaded = typeof adsbygoogle !== 'undefined';
            console.log('AdSense 脚本加载:', adsenseLoaded ? '✅' : '❌');
            
            // 检查配置对象
            const adConfigExists = typeof window.AD_CONFIG !== 'undefined';
            console.log('AD_CONFIG 存在:', adConfigExists ? '✅' : '❌');
            
            const adManagerExists = typeof window.adManager !== 'undefined';
            console.log('adManager 存在:', adManagerExists ? '✅' : '❌');
            
            if (adConfigExists) {
                console.log('广告配置:', window.AD_CONFIG);
                console.log('广告启用状态:', window.AD_CONFIG.googleAdsense?.enabled);
                console.log('发布商ID:', window.AD_CONFIG.googleAdsense?.publisherId);
                console.log('视频广告Slot ID:', window.AD_CONFIG.googleAdsense?.adSlots?.video?.slotId);
            }
            
            if (adManagerExists) {
                console.log('广告管理器状态:', window.adManager);
            }
            
            // 检查同意状态
            const consentStatus = localStorage.getItem('adsConsent');
            console.log('同意状态:', consentStatus || '未设置');
            
            if (adsenseLoaded && adConfigExists && adManagerExists) {
                updateStatus('配置检查通过！', 'success');
            } else {
                updateStatus('配置检查失败，请检查脚本加载', 'error');
            }
        }

        function testConsent() {
            console.log('🧪 测试同意条...');
            
            // 清除现有同意状态
            localStorage.removeItem('adsConsent');
            
            // 重新初始化同意条
            if (window.adManager) {
                window.adManager.setupConsent(() => {
                    console.log('同意条显示完成');
                });
                updateStatus('同意条已显示', 'info');
            } else {
                console.log('❌ adManager 不存在');
                updateStatus('adManager 不存在', 'error');
            }
        }

        async function testVideoAd() {
            console.log('🎬 测试视频广告...');
            
            if (!window.adManager) {
                console.log('❌ adManager 不存在');
                updateStatus('adManager 不存在', 'error');
                return;
            }
            
            try {
                updateStatus('正在加载视频广告...', 'info');
                await window.adManager.createVideoAd();
                console.log('✅ 视频广告测试完成');
                updateStatus('视频广告测试完成', 'success');
            } catch (error) {
                console.log('❌ 视频广告测试失败:', error);
                updateStatus('视频广告测试失败: ' + error.message, 'error');
            }
        }

        function testFallback() {
            console.log('🔄 测试 Fallback 插屏...');
            
            if (!window.adManager) {
                console.log('❌ adManager 不存在');
                updateStatus('adManager 不存在', 'error');
                return;
            }
            
            try {
                window.adManager.showFallbackInterstitial(() => {
                    console.log('✅ Fallback 插屏测试完成');
                    updateStatus('Fallback 插屏测试完成', 'success');
                });
            } catch (error) {
                console.log('❌ Fallback 测试失败:', error);
                updateStatus('Fallback 测试失败: ' + error.message, 'error');
            }
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
            updateStatus('控制台已清空', 'info');
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ 广告测试调试页面已加载');
            console.log('📋 使用说明:');
            console.log('1. 点击"检查配置"验证广告配置');
            console.log('2. 点击"测试同意条"显示同意弹窗');
            console.log('3. 点击"测试视频广告"显示视频广告');
            console.log('4. 点击"测试fallback"显示fallback插屏');
            
            // 自动检查配置
            setTimeout(checkConfig, 1000);
        });
    </script>
</body>
</html>
