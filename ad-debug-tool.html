<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šè¯Šæ–­å·¥å…· - Personality MBTI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .ad-container {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ccc;
            text-align: center;
            background: #f8f9fa;
        }
        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .config-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¹¿å‘Šè¯Šæ–­å·¥å…·</h1>
        <p>è¿™ä¸ªå·¥å…·ç”¨äºè¯Šæ–­å¹¿å‘Šæ˜¾ç¤ºé—®é¢˜ï¼Œå¸®åŠ©æ‰¾å‡ºä¸ºä»€ä¹ˆå¹¿å‘Šæ²¡æœ‰æ˜¾ç¤ºã€‚</p>
        
        <div class="test-section">
            <h3>ğŸ“‹ ç³»ç»Ÿæ£€æŸ¥</h3>
            <button onclick="checkSystemStatus()">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
            <button onclick="checkAdConfig()">æ£€æŸ¥å¹¿å‘Šé…ç½®</button>
            <button onclick="checkConsentStatus()">æ£€æŸ¥åŒæ„çŠ¶æ€</button>
            <button onclick="checkAdSenseScript()">æ£€æŸ¥ AdSense è„šæœ¬</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª å¹¿å‘Šæµ‹è¯•</h3>
            <button onclick="testVideoAd()">æµ‹è¯•è§†é¢‘å¹¿å‘Š</button>
            <button onclick="testFallbackAd()">æµ‹è¯•å›é€€å¹¿å‘Š</button>
            <button onclick="testConsentBanner()">æµ‹è¯•åŒæ„æ¨ªå¹…</button>
            <button onclick="clearAllAds()">æ¸…é™¤æ‰€æœ‰å¹¿å‘Š</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š é…ç½®ä¿¡æ¯</h3>
            <div id="configInfo" class="config-display">ç‚¹å‡»"æ£€æŸ¥å¹¿å‘Šé…ç½®"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“± å¹¿å‘Šæ˜¾ç¤ºåŒºåŸŸ</h3>
            <div id="adDisplayArea" class="ad-container">
                <p>å¹¿å‘Šå°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
            </div>
        </div>
        
        <div id="log"></div>
    </div>

    <!-- å¹¿å‘Šè„šæœ¬ -->
    <script src="ad-config.js"></script>
    <script src="ads-manager.js"></script>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.style.color = type === 'error' ? '#dc3545' : 
                                 type === 'success' ? '#28a745' : 
                                 type === 'warning' ? '#ffc107' : '#6c757d';
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        async function checkSystemStatus() {
            clearLog();
            log('ğŸ” å¼€å§‹ç³»ç»ŸçŠ¶æ€æ£€æŸ¥...', 'info');
            
            // æ£€æŸ¥åŸºæœ¬å¯¹è±¡
            log(`window.AD_CONFIG: ${typeof window.AD_CONFIG}`, 
                window.AD_CONFIG ? 'success' : 'error');
            log(`window.adManager: ${typeof window.adManager}`, 
                window.adManager ? 'success' : 'error');
            log(`window.adsbygoogle: ${typeof window.adsbygoogle}`, 
                window.adsbygoogle ? 'success' : 'error');
            
            // æ£€æŸ¥å¹¿å‘Šæ‹¦æˆªå™¨
            if (window.adsbygoogle) {
                log('âœ… AdSense è„šæœ¬å·²åŠ è½½', 'success');
            } else {
                log('âŒ AdSense è„šæœ¬æœªåŠ è½½ - å¯èƒ½è¢«å¹¿å‘Šæ‹¦æˆªå™¨é˜»æ­¢', 'error');
            }
            
            // æ£€æŸ¥é…ç½®
            if (window.AD_CONFIG) {
                log(`âœ… å¹¿å‘Šé…ç½®å·²åŠ è½½ - å¯ç”¨çŠ¶æ€: ${window.AD_CONFIG.googleAdsense.enabled}`, 'success');
                log(`âœ… å‘å¸ƒå•†ID: ${window.AD_CONFIG.googleAdsense.publisherId}`, 'success');
            } else {
                log('âŒ å¹¿å‘Šé…ç½®æœªåŠ è½½', 'error');
            }
        }
        
        async function checkAdConfig() {
            log('ğŸ” æ£€æŸ¥å¹¿å‘Šé…ç½®...', 'info');
            
            if (!window.AD_CONFIG) {
                log('âŒ AD_CONFIG æœªå®šä¹‰', 'error');
                return;
            }
            
            const config = window.AD_CONFIG;
            const configInfo = document.getElementById('configInfo');
            
            let configText = `å¹¿å‘Šé…ç½®ä¿¡æ¯:\n`;
            configText += `å¯ç”¨çŠ¶æ€: ${config.googleAdsense.enabled}\n`;
            configText += `å‘å¸ƒå•†ID: ${config.googleAdsense.publisherId}\n`;
            configText += `å¹¿å‘Šç­–ç•¥:\n`;
            configText += `  - å…è®¸è·³è¿‡: ${config.adStrategy.allowSkip}\n`;
            configText += `  - è§†é¢‘æ—¶é•¿: ${config.adStrategy.videoAdDuration}ç§’\n`;
            configText += `  - æœ€å°é—´éš”: ${config.adStrategy.minInterval}ç§’\n`;
            configText += `å¹¿å‘Šä½é…ç½®:\n`;
            
            Object.entries(config.googleAdsense.adSlots).forEach(([key, slot]) => {
                configText += `  - ${key}: ${slot.slotId} (${slot.format})\n`;
            });
            
            configInfo.textContent = configText;
            log('âœ… å¹¿å‘Šé…ç½®æ£€æŸ¥å®Œæˆ', 'success');
        }
        
        async function checkConsentStatus() {
            log('ğŸ” æ£€æŸ¥ç”¨æˆ·åŒæ„çŠ¶æ€...', 'info');
            
            const consent = localStorage.getItem('adsConsent');
            log(`åŒæ„çŠ¶æ€: ${consent || 'æœªè®¾ç½®'}`, consent === 'accepted' ? 'success' : 'warning');
            
            if (consent !== 'accepted') {
                log('âš ï¸ ç”¨æˆ·æœªåŒæ„å¹¿å‘Šï¼Œéœ€è¦æ˜¾ç¤ºåŒæ„æ¨ªå¹…', 'warning');
            } else {
                log('âœ… ç”¨æˆ·å·²åŒæ„å¹¿å‘Š', 'success');
            }
        }
        
        async function checkAdSenseScript() {
            log('ğŸ” æ£€æŸ¥ AdSense è„šæœ¬åŠ è½½...', 'info');
            
            // æ£€æŸ¥è„šæœ¬æ˜¯å¦åœ¨ DOM ä¸­
            const scripts = document.querySelectorAll('script[src*="adsbygoogle"]');
            log(`æ‰¾åˆ° ${scripts.length} ä¸ª AdSense è„šæœ¬æ ‡ç­¾`, scripts.length > 0 ? 'success' : 'error');
            
            scripts.forEach((script, index) => {
                log(`è„šæœ¬ ${index + 1}: ${script.src}`, 'info');
            });
            
            // æ£€æŸ¥ adsbygoogle å¯¹è±¡
            if (window.adsbygoogle) {
                log('âœ… adsbygoogle å¯¹è±¡å¯ç”¨', 'success');
                log(`adsbygoogle.push æ–¹æ³•: ${typeof window.adsbygoogle.push}`, 'info');
            } else {
                log('âŒ adsbygoogle å¯¹è±¡ä¸å¯ç”¨', 'error');
            }
        }
        
        async function testVideoAd() {
            log('ğŸ§ª æµ‹è¯•è§†é¢‘å¹¿å‘Š...', 'info');
            
            if (!window.adManager) {
                log('âŒ adManager æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                log('å¼€å§‹åˆ›å»ºè§†é¢‘å¹¿å‘Š...', 'info');
                await window.adManager.createVideoAd();
                log('âœ… è§†é¢‘å¹¿å‘Šåˆ›å»ºæˆåŠŸ', 'success');
            } catch (error) {
                log(`âŒ è§†é¢‘å¹¿å‘Šåˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testFallbackAd() {
            log('ğŸ§ª æµ‹è¯•å›é€€å¹¿å‘Š...', 'info');
            
            if (!window.adManager) {
                log('âŒ adManager æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                log('å¼€å§‹åˆ›å»ºå›é€€å¹¿å‘Š...', 'info');
                window.adManager.showFallbackInterstitial(() => {
                    log('âœ… å›é€€å¹¿å‘Šæ˜¾ç¤ºæˆåŠŸ', 'success');
                });
            } catch (error) {
                log(`âŒ å›é€€å¹¿å‘Šåˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testConsentBanner() {
            log('ğŸ§ª æµ‹è¯•åŒæ„æ¨ªå¹…...', 'info');
            
            if (!window.adManager) {
                log('âŒ adManager æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                log('å¼€å§‹åˆ›å»ºåŒæ„æ¨ªå¹…...', 'info');
                window.adManager.setupConsent();
                log('âœ… åŒæ„æ¨ªå¹…åˆ›å»ºæˆåŠŸ', 'success');
            } catch (error) {
                log(`âŒ åŒæ„æ¨ªå¹…åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearAllAds() {
            log('ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰å¹¿å‘Š...', 'info');
            
            // æ¸…é™¤æ‰€æœ‰å¹¿å‘Šè¦†ç›–å±‚
            const overlays = document.querySelectorAll('[id*="ad"], [id*="overlay"]');
            overlays.forEach(overlay => {
                if (overlay.id !== 'adDisplayArea') {
                    overlay.remove();
                    log(`å·²æ¸…é™¤: ${overlay.id}`, 'info');
                }
            });
            
            // æ¸…é™¤åŒæ„æ¨ªå¹…
            const consentBanner = document.getElementById('consent-banner');
            if (consentBanner) {
                consentBanner.remove();
                log('å·²æ¸…é™¤åŒæ„æ¨ªå¹…', 'info');
            }
            
            log('âœ… æ‰€æœ‰å¹¿å‘Šå·²æ¸…é™¤', 'success');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æ£€æŸ¥...', 'info');
            setTimeout(() => {
                checkSystemStatus();
            }, 1000);
        });
    </script>
</body>
</html>
